using System;
using System.Collections.Generic;
using System.Drawing;
using System.Globalization;
using System.IO;
using System.Linq;
using System.Text.RegularExpressions;
using GBA.Common.Extensions;
using GBA.Common.ResourceNames;
using GBA.Domain.DocumentsManagement.Contracts;
using GBA.Domain.Entities;
using GBA.Domain.Entities.Products;
using GBA.Domain.Entities.Sales;
using OfficeOpenXml;
using OfficeOpenXml.Style;

namespace GBA.Domain.DocumentsManagement;

public sealed class SalesXlsManager : BaseXlsManager, ISalesXlsManager {
    private readonly Regex _literals = new(@"[A-zА-я]+", RegexOptions.Compiled);

    public (string xlsxFile, string pdfFile) ExportPlInvoiceToXlsx(string path, Sale sale) {
        string fileName = Path.Combine(path, $"{sale.SaleInvoiceNumber.Number}_{DateTime.Now.ToString("MM.yyyy")}_{Guid.NewGuid().ToString()}.xlsx");

        using (ExcelPackage package = NewExcelPackage(fileName)) {
            ExcelWorksheet worksheet = package.Workbook.Worksheets.Add("Invoice");

            worksheet.ApplyPrinterSettings(0.75m, 0.75m, 0.5m, 0.5m, 0.3m, 0.3m, true);

            int row = 1;

            //Adding default invoice headers
            using (ExcelRange range = worksheet.Cells[row, 1, row, 5]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;

                range.Value = "Oryginał / Kopia";
            }

            using (ExcelRange range = worksheet.Cells[row, 6, row, 9]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
            }

            using (ExcelRange range = worksheet.Cells[row, 10, row, 13]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 9;

                range.Value = $"{sale.SaleInvoiceDocument.City}, {DateTime.Now.ToString("dd.MM.yyyy")}";
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, 1, row + 2, 4]) {
                range.Merge = true;

                range.Style.Border.Left.Style = ExcelBorderStyle.Thin;
                range.Style.Border.Top.Style = ExcelBorderStyle.Thin;
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Thin;
            }

            using (ExcelRange range = worksheet.Cells[row, 5, row + 2, 12]) {
                range.Merge = true;

                range.Style.Border.Top.Style = ExcelBorderStyle.Thin;
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Thin;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 12;
                range.Style.Font.Bold = true;

                range.Value = $"FAKTURA VAT NR F{sale.SaleInvoiceNumber.Number}/{DateTime.Now.ToString("MM/yyyy")}";
            }

            using (ExcelRange range = worksheet.Cells[row, 13, row + 2, 13]) {
                range.Merge = true;

                range.Style.Border.Right.Style = ExcelBorderStyle.Thin;
                range.Style.Border.Top.Style = ExcelBorderStyle.Thin;
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Thin;
            }

            row += 3;

            using (ExcelRange range = worksheet.Cells[row, 1, row, 5]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;

                range.Value = "Sprzedawca:";
            }

            using (ExcelRange range = worksheet.Cells[row, 6, row, 13]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;

                range.Value = "Nabywca:";
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, 1, row + 3, 5]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 10;
                range.Style.WrapText = true;

                range.Value = @"CONCORD.PL Sp z o.o.,
37-700, Przemyśl, ul. Gen.Jakuba Jasińskiego 58,
NIP 8133680920,
12193013182740072619290001 Bank BPS S.A.";
            }

            using (ExcelRange range = worksheet.Cells[row, 6, row + 3, 13]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 10;
                range.Style.WrapText = true;

                string name = !string.IsNullOrEmpty(sale.ClientAgreement.Client.FullName) ? sale.ClientAgreement.Client.FullName : sale.ClientAgreement.Client.Name;

                range.Value = $@"{name},
{sale.ClientAgreement.Client.ActualAddress},
NIP {sale.ClientAgreement.Client.TIN}";
            }

            row += 4;

            using (ExcelRange range = worksheet.Cells[row, 1, row + 1, 1]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;

                range.Value = "Lp.";
            }

            using (ExcelRange range = worksheet.Cells[row, 2, row + 1, 4]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;

                range.Value = "Nazwa towaru lub usługi";
            }

            using (ExcelRange range = worksheet.Cells[row, 5, row + 1, 5]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 9;
                range.Style.WrapText = true;
                range.Style.Font.Bold = true;

                range.Value = "Jedno stka miary";
            }

            using (ExcelRange range = worksheet.Cells[row, 6, row + 1, 6]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;

                range.Value = "Ilość";
            }

            using (ExcelRange range = worksheet.Cells[row, 7, row + 1, 8]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Style.WrapText = true;

                range.Value = "Cena jedn. netto (zł)";
            }

            using (ExcelRange range = worksheet.Cells[row, 9, row + 1, 10]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Style.WrapText = true;

                range.Value = "Wartość netto (zł)";
            }

            using (ExcelRange range = worksheet.Cells[row, 11, row, 12]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;

                range.Value = "Podatek";
            }

            using (ExcelRange range = worksheet.Cells[row + 1, 11, row + 1, 11]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Style.WrapText = true;

                range.Value = "Stawka %";
            }

            using (ExcelRange range = worksheet.Cells[row + 1, 12, row + 1, 12]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;

                range.Value = "Kwota";
            }

            using (ExcelRange range = worksheet.Cells[row, 13, row + 1, 13]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Style.WrapText = true;

                range.Value = "Wartość brutto";
            }

            worksheet.Row(row++).Height = 12;
            worksheet.Row(row++).Height = 25;

            int tableRowIndex = 1;

            decimal totalVatAmount = decimal.Zero;
            decimal totalGrossAmount = decimal.Zero;

            //If total net price of invoice less than 1000 we add transportation price as first row of the table
            if (sale.SaleInvoiceDocument.ShippingAmount > 0) {
                worksheet.Cells[row, 1].Style.Border.BorderAround(ExcelBorderStyle.Thin);
                worksheet.Cells[row, 1].Style.Border.BorderAround(ExcelBorderStyle.Thin);
                worksheet.Cells[row, 1].Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                worksheet.Cells[row, 1].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                worksheet.Cells[row, 1].Style.Font.Name = "Arial";
                worksheet.Cells[row, 1].Style.Font.Size = 9;

                worksheet.Cells[row, 1].Value = tableRowIndex++;

                using (ExcelRange range = worksheet.Cells[row, 2, row, 4]) {
                    range.Merge = true;

                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    range.Style.Font.Name = "Arial";
                    range.Style.Font.Size = 9;
                    range.Style.WrapText = true;

                    range.Value = "T1111 Usługi transportowe";
                }

                worksheet.Cells[row, 5].Style.Border.BorderAround(ExcelBorderStyle.Thin);
                worksheet.Cells[row, 5].Style.Border.BorderAround(ExcelBorderStyle.Thin);
                worksheet.Cells[row, 5].Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                worksheet.Cells[row, 5].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                worksheet.Cells[row, 5].Style.Font.Name = "Arial";
                worksheet.Cells[row, 5].Style.Font.Size = 9;

                worksheet.Cells[row, 5].Value = "szt";

                worksheet.Cells[row, 6].Style.Border.BorderAround(ExcelBorderStyle.Thin);
                worksheet.Cells[row, 6].Style.Border.BorderAround(ExcelBorderStyle.Thin);
                worksheet.Cells[row, 6].Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                worksheet.Cells[row, 6].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                worksheet.Cells[row, 6].Style.Font.Name = "Arial";
                worksheet.Cells[row, 6].Style.Font.Size = 9;
                worksheet.Cells[row, 6].Style.Numberformat.Format = "0.00";

                worksheet.Cells[row, 6].Value = 1.00;

                using (ExcelRange range = worksheet.Cells[row, 7, row, 8]) {
                    range.Merge = true;

                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    range.Style.Font.Name = "Arial";
                    range.Style.Font.Size = 9;
                    range.Style.Numberformat.Format = "0.00";

                    range.Value = sale.SaleInvoiceDocument.ShippingAmountWithoutVat;
                }

                using (ExcelRange range = worksheet.Cells[row, 9, row, 10]) {
                    range.Merge = true;

                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    range.Style.Font.Name = "Arial";
                    range.Style.Font.Size = 9;
                    range.Style.Numberformat.Format = "0.00";

                    range.Value = sale.SaleInvoiceDocument.ShippingAmountWithoutVat;
                }

                worksheet.Cells[row, 11].Style.Border.BorderAround(ExcelBorderStyle.Thin);
                worksheet.Cells[row, 11].Style.Border.BorderAround(ExcelBorderStyle.Thin);
                worksheet.Cells[row, 11].Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                worksheet.Cells[row, 11].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                worksheet.Cells[row, 11].Style.Font.Name = "Arial";
                worksheet.Cells[row, 11].Style.Font.Size = 9;

                worksheet.Cells[row, 11].Value = $"{decimal.Round(sale.SaleInvoiceDocument.Vat, 0, MidpointRounding.AwayFromZero)}%";

                decimal currentVatAmount = decimal.Round(sale.SaleInvoiceDocument.ShippingAmount - sale.SaleInvoiceDocument.ShippingAmountWithoutVat, 2,
                    MidpointRounding.AwayFromZero);

                totalVatAmount = decimal.Round(totalVatAmount + currentVatAmount, 2, MidpointRounding.AwayFromZero);

                totalGrossAmount = decimal.Round(sale.SaleInvoiceDocument.ShippingAmount, 2, MidpointRounding.AwayFromZero);

                worksheet.Cells[row, 12].Style.Border.BorderAround(ExcelBorderStyle.Thin);
                worksheet.Cells[row, 12].Style.Border.BorderAround(ExcelBorderStyle.Thin);
                worksheet.Cells[row, 12].Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                worksheet.Cells[row, 12].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                worksheet.Cells[row, 12].Style.Font.Name = "Arial";
                worksheet.Cells[row, 12].Style.Font.Size = 9;
                worksheet.Cells[row, 12].Style.Numberformat.Format = "0.00";

                worksheet.Cells[row, 12].Value = currentVatAmount;

                worksheet.Cells[row, 13].Style.Border.BorderAround(ExcelBorderStyle.Thin);
                worksheet.Cells[row, 13].Style.Border.BorderAround(ExcelBorderStyle.Thin);
                worksheet.Cells[row, 13].Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                worksheet.Cells[row, 13].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                worksheet.Cells[row, 13].Style.Font.Name = "Arial";
                worksheet.Cells[row, 13].Style.Font.Size = 9;
                worksheet.Cells[row, 13].Style.Numberformat.Format = "0.00";

                worksheet.Cells[row, 13].Value = totalGrossAmount;

                row++;
            }

            //Filling table
            foreach (OrderItem orderItem in sale.Order.OrderItems)
                if ($"{orderItem.Product.VendorCode} {orderItem.Product.Name}".Length > 43) {
                    int rowsCount = $"{orderItem.Product.VendorCode} {orderItem.Product.Name} {orderItem.AssignedSpecification?.SpecificationCode}".Length / 43;

                    using (ExcelRange range = worksheet.Cells[row, 1, row + rowsCount, 1]) {
                        range.Merge = true;

                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Font.Name = "Arial";
                        range.Style.Font.Size = 9;

                        range.Value = tableRowIndex++;
                    }

                    using (ExcelRange range = worksheet.Cells[row, 2, row + rowsCount, 4]) {
                        range.Merge = true;

                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Font.Name = "Arial";
                        range.Style.Font.Size = 9;
                        range.Style.WrapText = true;

                        range.Value = $"{orderItem.Product.VendorCode} {orderItem.Product.Name} {orderItem.AssignedSpecification?.SpecificationCode}";
                    }

                    using (ExcelRange range = worksheet.Cells[row, 5, row + rowsCount, 5]) {
                        range.Merge = true;

                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Font.Name = "Arial";
                        range.Style.Font.Size = 9;

                        range.Value = orderItem.Product.MeasureUnit.Name;
                    }

                    using (ExcelRange range = worksheet.Cells[row, 6, row + rowsCount, 6]) {
                        range.Merge = true;

                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Font.Name = "Arial";
                        range.Style.Font.Size = 9;

                        range.Value = orderItem.Qty;
                    }

                    using (ExcelRange range = worksheet.Cells[row, 7, row + rowsCount, 8]) {
                        range.Merge = true;

                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Font.Name = "Arial";
                        range.Style.Font.Size = 9;
                        range.Style.Numberformat.Format = "0.00";

                        range.Value = decimal.Round(orderItem.PricePerItemWithoutVat * orderItem.ExchangeRateAmount, 2, MidpointRounding.AwayFromZero);
                    }

                    orderItem.TotalAmountLocal =
                        decimal.Round(
                            decimal.Round(orderItem.PricePerItemWithoutVat * Convert.ToDecimal(orderItem.Qty), 2, MidpointRounding.AwayFromZero)
                            * orderItem.ExchangeRateAmount,
                            2,
                            MidpointRounding.AwayFromZero
                        );

                    using (ExcelRange range = worksheet.Cells[row, 9, row + rowsCount, 10]) {
                        range.Merge = true;

                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Font.Name = "Arial";
                        range.Style.Font.Size = 9;
                        range.Style.Numberformat.Format = "0.00";

                        range.Value = orderItem.TotalAmountLocal;
                    }

                    using (ExcelRange range = worksheet.Cells[row, 11, row + rowsCount, 11]) {
                        range.Merge = true;

                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Font.Name = "Arial";
                        range.Style.Font.Size = 9;

                        range.Value = $"{decimal.Round(sale.SaleInvoiceDocument.Vat, 0, MidpointRounding.AwayFromZero)}%";
                    }

                    decimal currentVatAmount =
                        decimal.Round(
                            orderItem.TotalAmountLocal * sale.SaleInvoiceDocument.Vat / 100,
                            2,
                            MidpointRounding.AwayFromZero
                        );

                    totalVatAmount = decimal.Round(totalVatAmount + currentVatAmount, 2, MidpointRounding.AwayFromZero);

                    totalGrossAmount = decimal.Round(totalGrossAmount + orderItem.TotalAmountLocal + currentVatAmount, 2, MidpointRounding.AwayFromZero);

                    using (ExcelRange range = worksheet.Cells[row, 12, row + rowsCount, 12]) {
                        range.Merge = true;

                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Font.Name = "Arial";
                        range.Style.Font.Size = 9;
                        range.Style.Numberformat.Format = "0.00";

                        range.Value = currentVatAmount;
                    }

                    decimal currentGrossAmount =
                        decimal.Round(
                            orderItem.TotalAmountLocal + currentVatAmount,
                            2,
                            MidpointRounding.AwayFromZero
                        );

                    using (ExcelRange range = worksheet.Cells[row, 13, row + rowsCount, 13]) {
                        range.Merge = true;

                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Font.Name = "Arial";
                        range.Style.Font.Size = 9;
                        range.Style.Numberformat.Format = "0.00";

                        range.Value = currentGrossAmount;
                    }

                    row += rowsCount + 1;
                } else {
                    worksheet.Cells[row, 1].Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    worksheet.Cells[row, 1].Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    worksheet.Cells[row, 1].Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                    worksheet.Cells[row, 1].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    worksheet.Cells[row, 1].Style.Font.Name = "Arial";
                    worksheet.Cells[row, 1].Style.Font.Size = 9;

                    worksheet.Cells[row, 1].Value = tableRowIndex++;

                    using (ExcelRange range = worksheet.Cells[row, 2, row, 4]) {
                        range.Merge = true;

                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Font.Name = "Arial";
                        range.Style.Font.Size = 9;
                        range.Style.WrapText = true;

                        range.Value = $"{orderItem.Product.VendorCode} {orderItem.Product.Name} {orderItem.AssignedSpecification?.SpecificationCode}";
                    }

                    worksheet.Cells[row, 5].Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    worksheet.Cells[row, 5].Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    worksheet.Cells[row, 5].Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                    worksheet.Cells[row, 5].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    worksheet.Cells[row, 5].Style.Font.Name = "Arial";
                    worksheet.Cells[row, 5].Style.Font.Size = 9;

                    worksheet.Cells[row, 5].Value = orderItem.Product.MeasureUnit.Name;

                    worksheet.Cells[row, 6].Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    worksheet.Cells[row, 6].Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    worksheet.Cells[row, 6].Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                    worksheet.Cells[row, 6].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    worksheet.Cells[row, 6].Style.Font.Name = "Arial";
                    worksheet.Cells[row, 6].Style.Font.Size = 9;

                    worksheet.Cells[row, 6].Value = orderItem.Qty;

                    using (ExcelRange range = worksheet.Cells[row, 7, row, 8]) {
                        range.Merge = true;

                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Font.Name = "Arial";
                        range.Style.Font.Size = 9;
                        range.Style.Numberformat.Format = "0.00";

                        range.Value = decimal.Round(orderItem.PricePerItemWithoutVat * orderItem.ExchangeRateAmount, 2, MidpointRounding.AwayFromZero);
                    }

                    orderItem.TotalAmountLocal =
                        decimal.Round(
                            decimal.Round(orderItem.PricePerItemWithoutVat * Convert.ToDecimal(orderItem.Qty), 2, MidpointRounding.AwayFromZero)
                            * orderItem.ExchangeRateAmount,
                            2,
                            MidpointRounding.AwayFromZero
                        );

                    using (ExcelRange range = worksheet.Cells[row, 9, row, 10]) {
                        range.Merge = true;

                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Font.Name = "Arial";
                        range.Style.Font.Size = 9;
                        range.Style.Numberformat.Format = "0.00";

                        range.Value = orderItem.TotalAmountLocal;
                    }

                    worksheet.Cells[row, 11].Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    worksheet.Cells[row, 11].Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    worksheet.Cells[row, 11].Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                    worksheet.Cells[row, 11].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    worksheet.Cells[row, 11].Style.Font.Name = "Arial";
                    worksheet.Cells[row, 11].Style.Font.Size = 9;

                    worksheet.Cells[row, 11].Value = $"{Math.Round(sale.SaleInvoiceDocument.Vat, 0)}%";

                    decimal withVatAmount =
                        decimal.Round(
                            decimal.Round(orderItem.PricePerItem * Convert.ToDecimal(orderItem.Qty), 2, MidpointRounding.AwayFromZero)
                            * orderItem.ExchangeRateAmount,
                            2,
                            MidpointRounding.AwayFromZero
                        );

                    decimal currentVatAmount =
                        decimal.Round(
                            withVatAmount - orderItem.TotalAmountLocal,
                            2,
                            MidpointRounding.AwayFromZero
                        );

                    totalVatAmount = decimal.Round(totalVatAmount + currentVatAmount, 2, MidpointRounding.AwayFromZero);

                    totalGrossAmount = decimal.Round(totalGrossAmount + orderItem.TotalAmountLocal + currentVatAmount, 2, MidpointRounding.AwayFromZero);

                    worksheet.Cells[row, 12].Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    worksheet.Cells[row, 12].Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    worksheet.Cells[row, 12].Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                    worksheet.Cells[row, 12].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    worksheet.Cells[row, 12].Style.Font.Name = "Arial";
                    worksheet.Cells[row, 12].Style.Font.Size = 9;
                    worksheet.Cells[row, 12].Style.Numberformat.Format = "0.00";

                    worksheet.Cells[row, 12].Value = currentVatAmount;

                    worksheet.Cells[row, 13].Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    worksheet.Cells[row, 13].Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    worksheet.Cells[row, 13].Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                    worksheet.Cells[row, 13].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    worksheet.Cells[row, 13].Style.Font.Name = "Arial";
                    worksheet.Cells[row, 13].Style.Font.Size = 9;
                    worksheet.Cells[row, 13].Style.Numberformat.Format = "0.00";

                    decimal currentGrossAmount =
                        decimal.Round(
                            orderItem.TotalAmountLocal + currentVatAmount,
                            2,
                            MidpointRounding.AwayFromZero
                        );

                    worksheet.Cells[row, 13].Style.Numberformat.Format = "0.00";
                    worksheet.Cells[row, 13].Value = currentGrossAmount;

                    row++;
                }

            using (ExcelRange range = worksheet.Cells[row, 1, row + 1, 6]) {
                range.Merge = true;

                range.Style.Border.Left.Style = ExcelBorderStyle.Thin;
            }

            using (ExcelRange range = worksheet.Cells[row, 7, row, 8]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;

                range.Value = "Razem";
            }

            using (ExcelRange range = worksheet.Cells[row + 1, 7, row + 1, 8]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 9;
                range.Style.WrapText = true;
                range.Style.Font.Bold = true;

                range.Value = "W tym VAT";
            }

            decimal totalAmount = sale.Order.OrderItems.Sum(x => x.Product.CurrentLocalPrice * Convert.ToDecimal(x.Qty));

            using (ExcelRange range = worksheet.Cells[row, 9, row, 10]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 9;
                range.Style.Numberformat.Format = "0.00";

                range.Value = decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero);
            }

            using (ExcelRange range = worksheet.Cells[row + 1, 9, row + 1, 10]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 9;
                range.Style.Numberformat.Format = "0.00";

                range.Value = decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero);
            }

            worksheet.Cells[row, 11].Style.Border.BorderAround(ExcelBorderStyle.Thin);
            worksheet.Cells[row, 11].Style.Border.BorderAround(ExcelBorderStyle.Thin);
            worksheet.Cells[row, 11].Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
            worksheet.Cells[row, 11].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            worksheet.Cells[row, 11].Style.Font.Name = "Arial";
            worksheet.Cells[row, 11].Style.Font.Size = 9;

            worksheet.Cells[row, 11].Value = "X";

            worksheet.Cells[row, 12].Style.Border.BorderAround(ExcelBorderStyle.Thin);
            worksheet.Cells[row, 12].Style.Border.BorderAround(ExcelBorderStyle.Thin);
            worksheet.Cells[row, 12].Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
            worksheet.Cells[row, 12].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            worksheet.Cells[row, 12].Style.Font.Name = "Arial";
            worksheet.Cells[row, 12].Style.Font.Size = 9;
            worksheet.Cells[row, 12].Style.Numberformat.Format = "0.00";

            worksheet.Cells[row, 12].Value = totalVatAmount;

            worksheet.Cells[row, 13].Style.Border.BorderAround(ExcelBorderStyle.Thin);
            worksheet.Cells[row, 13].Style.Border.BorderAround(ExcelBorderStyle.Thin);
            worksheet.Cells[row, 13].Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
            worksheet.Cells[row, 13].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            worksheet.Cells[row, 13].Style.Font.Name = "Arial";
            worksheet.Cells[row, 13].Style.Font.Size = 9;
            worksheet.Cells[row, 13].Style.Numberformat.Format = "0.00";

            worksheet.Cells[row, 13].Value = totalGrossAmount;

            row++;

            worksheet.Cells[row, 11].Style.Border.BorderAround(ExcelBorderStyle.Thin);
            worksheet.Cells[row, 11].Style.Border.BorderAround(ExcelBorderStyle.Thin);
            worksheet.Cells[row, 11].Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
            worksheet.Cells[row, 11].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            worksheet.Cells[row, 11].Style.Font.Name = "Arial";
            worksheet.Cells[row, 11].Style.Font.Size = 9;

            worksheet.Cells[row, 11].Value = $"{Math.Round(sale.SaleInvoiceDocument.Vat, 0)}%";

            worksheet.Cells[row, 12].Style.Border.BorderAround(ExcelBorderStyle.Thin);
            worksheet.Cells[row, 12].Style.Border.BorderAround(ExcelBorderStyle.Thin);
            worksheet.Cells[row, 12].Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
            worksheet.Cells[row, 12].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            worksheet.Cells[row, 12].Style.Font.Name = "Arial";
            worksheet.Cells[row, 12].Style.Font.Size = 9;
            worksheet.Cells[row, 12].Style.Numberformat.Format = "0.00";

            worksheet.Cells[row, 12].Value = totalVatAmount;

            worksheet.Cells[row, 13].Style.Border.BorderAround(ExcelBorderStyle.Thin);
            worksheet.Cells[row, 13].Style.Border.BorderAround(ExcelBorderStyle.Thin);
            worksheet.Cells[row, 13].Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
            worksheet.Cells[row, 13].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            worksheet.Cells[row, 13].Style.Font.Name = "Arial";
            worksheet.Cells[row, 13].Style.Font.Size = 9;
            worksheet.Cells[row, 13].Style.Numberformat.Format = "0.00";

            worksheet.Cells[row, 13].Value = totalGrossAmount;

            worksheet.Row(row++).Height = 25;

            using (ExcelRange range = worksheet.Cells[row, 1, row, 13]) {
                range.Merge = true;

                range.Style.Border.Left.Style = ExcelBorderStyle.Thin;
                range.Style.Border.Right.Style = ExcelBorderStyle.Thin;
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Thin;
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, 1, row, 2]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;

                range.Value = "Razem do zapłaty:";
            }

            using (ExcelRange range = worksheet.Cells[row, 3, row, 4]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Style.Numberformat.Format = "0.00";

                range.Value = $"{totalGrossAmount} zł";
            }

            using (ExcelRange range = worksheet.Cells[row, 5, row, 7]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;

                range.Value = "Data sprzedaży:";
            }

            using (ExcelRange range = worksheet.Cells[row, 8, row, 13]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;

                range.Value = DateTime.Now.ToString("dd.MM.yyyy");
            }

            row++;

            string verbalAmountRepresentation = $"{totalGrossAmount.ToText(true, false)} zł. {(Math.Round(totalGrossAmount % 1, 2) * 100).ToText(false, false)} gr.";

            if (verbalAmountRepresentation.Length > 49) {
                int rowsCount = verbalAmountRepresentation.Length / 49;

                using (ExcelRange range = worksheet.Cells[row, 1, row + rowsCount, 2]) {
                    range.Merge = true;

                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    range.Style.Font.Name = "Arial";
                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;

                    range.Value = "Słownie:";
                }

                using (ExcelRange range = worksheet.Cells[row, 3, row + rowsCount, 7]) {
                    range.Merge = true;

                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    range.Style.Font.Name = "Arial";
                    range.Style.Font.Size = 9;
                    range.Style.WrapText = true;

                    range.Value = verbalAmountRepresentation;
                }

                using (ExcelRange range = worksheet.Cells[row, 8, row + rowsCount, 13]) {
                    range.Merge = true;

                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                }

                row += rowsCount + 1;
            } else {
                using (ExcelRange range = worksheet.Cells[row, 1, row, 2]) {
                    range.Merge = true;

                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    range.Style.Font.Name = "Arial";
                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;

                    range.Value = "Słownie:";
                }

                using (ExcelRange range = worksheet.Cells[row, 3, row, 7]) {
                    range.Merge = true;

                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    range.Style.Font.Name = "Arial";
                    range.Style.Font.Size = 9;
                    range.Style.WrapText = true;

                    range.Value = verbalAmountRepresentation;
                }

                using (ExcelRange range = worksheet.Cells[row, 8, row, 13]) {
                    range.Merge = true;

                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                }

                row++;
            }

            using (ExcelRange range = worksheet.Cells[row, 1, row, 13]) {
                range.Merge = true;

                range.Style.Border.Left.Style = ExcelBorderStyle.Thin;
                range.Style.Border.Right.Style = ExcelBorderStyle.Thin;
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, 1, row, 2]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;

                range.Value = "Zapłacono:";
            }

            using (ExcelRange range = worksheet.Cells[row, 3, row, 4]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;

                range.Value = "0,00 zł";
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, 1, row, 13]) {
                range.Merge = true;

                range.Style.Border.Left.Style = ExcelBorderStyle.Thin;
                range.Style.Border.Right.Style = ExcelBorderStyle.Thin;
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, 1, row, 2]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;

                range.Value = "Pozostalo do zapłaty:";
            }

            using (ExcelRange range = worksheet.Cells[row, 3, row, 4]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;

                range.Value = $"{totalGrossAmount} zł";
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, 1, row, 13]) {
                range.Merge = true;

                range.Style.Border.Left.Style = ExcelBorderStyle.Thin;
                range.Style.Border.Right.Style = ExcelBorderStyle.Thin;
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, 1, row, 2]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;

                range.Value = "Forma płatności:";
            }

            using (ExcelRange range = worksheet.Cells[row, 3, row, 4]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;

                range.Value = "przelew";
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, 1, row, 13]) {
                range.Merge = true;

                range.Style.Border.Left.Style = ExcelBorderStyle.Thin;
                range.Style.Border.Right.Style = ExcelBorderStyle.Thin;
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, 1, row, 2]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;

                range.Value = "Termin zapłaty:";
            }

            using (ExcelRange range = worksheet.Cells[row, 3, row, 4]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;

                range.Value =
                    $"{sale.ClientAgreement.Agreement.NumberDaysDebt} dni, tj. do: {DateTime.Now.AddDays(sale.ClientAgreement.Agreement.NumberDaysDebt).ToString("dd.MM.yyyy")}";
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, 1, row, 13]) {
                range.Merge = true;

                range.Style.Border.Left.Style = ExcelBorderStyle.Thin;
                range.Style.Border.Right.Style = ExcelBorderStyle.Thin;
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, 2, row, 3]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 9;

                range.Value = "  otrzymujący fakturę";
            }

            using (ExcelRange range = worksheet.Cells[row, 7, row, 12]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 9;

                range.Value = "wystawiający fakturę Kwasnicki Wiktor";
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, 2, row + 3, 3]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 8;

                range.Value = "podpis";
            }

            using (ExcelRange range = worksheet.Cells[row, 7, row + 3, 12]) {
                range.Merge = true;

                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                range.Style.Font.Name = "Arial";
                range.Style.Font.Size = 8;

                range.Value = "podpis";
            }

            row += 4;

            using (ExcelRange range = worksheet.Cells[row, 1, row, 13]) {
                range.Merge = true;

                range.Style.Border.Left.Style = ExcelBorderStyle.Thin;
                range.Style.Border.Right.Style = ExcelBorderStyle.Thin;
            }

            row++;

            using (ExcelRange range = worksheet.Cells[1, 1, row, 13]) {
                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
            }

            //Setting default rows height
            worksheet.Row(1).Height = 12;

            //Setting default columns width
            worksheet.Column(1).Width = 3.9;
            worksheet.Column(2).Width = 16.00;
            worksheet.Column(3).Width = 9.2;
            worksheet.Column(4).Width = 12.6;
            worksheet.Column(5).Width = 6;
            worksheet.Column(6).Width = 7.00;
            worksheet.Column(7).Width = 3.3;
            worksheet.Column(8).Width = 3.9;
            worksheet.Column(9).Width = 5.7;
            worksheet.Column(10).Width = 4;
            worksheet.Column(11).Width = 8;
            worksheet.Column(12).Width = 6.7;
            worksheet.Column(13).Width = 9.5;

            //Setting document properties.
            package.Workbook.Properties.Title = "Complete invoice";
            package.Workbook.Properties.Author = "Concord CRM";
            package.Workbook.Properties.Comments = "Auto-generated xlsx by Concord CRM";

            //Saving the file.
            package.Save();
        }

        return SaveFiles(fileName);
    }

    public (string xlsxFile, string pdfFile) ExportPlInvoicePzToXlsx(string path, Sale sale) {
        string fileName = Path.Combine(path, $"PZ_{sale.SaleNumber.Value}_{DateTime.Now.ToString("MM.yyyy")}_{Guid.NewGuid().ToString()}.xlsx");

        using (ExcelPackage package = NewExcelPackage(fileName)) {
            ExcelWorksheet worksheet = package.Workbook.Worksheets.Add("PZ");

            //Set printer settings
            worksheet.ApplyPrinterSettings(0.3m, 0.3m, 0.1m, 0.1m, 0.3m, 0.3m, true);

            //Set column's width
            worksheet.SetColumnWidth(1.78, 1);
            worksheet.SetColumnWidth(3.27, 2);
            worksheet.SetColumnWidth(3.27, 3);
            worksheet.SetColumnWidth(3.27, 4);
            worksheet.SetColumnWidth(3.27, 5);
            worksheet.SetColumnWidth(3.87, 6);
            worksheet.SetColumnWidth(7.21, 7);
            worksheet.SetColumnWidth(7.21, 8);
            worksheet.SetColumnWidth(7.21, 9);
            worksheet.SetColumnWidth(7.21, 10);
            worksheet.SetColumnWidth(7.21, 11);
            worksheet.SetColumnWidth(10.91, 12);
            worksheet.SetColumnWidth(5.11, 13);
            worksheet.SetColumnWidth(7.21, 14);
            worksheet.SetColumnWidth(13.27, 15);
            worksheet.SetColumnWidth(8.47, 16);
            worksheet.SetColumnWidth(8.51, 17);
            worksheet.SetColumnWidth(13.01, 18);
            worksheet.SetColumnWidth(16.99, 19);

            worksheet.SetRowHeight(12.71, new[] { 1, 5, 6, 8, 9, 10 });
            worksheet.SetRowHeight(6.21, new[] { 2, 3 });
            worksheet.SetRowHeight(5.11, new[] { 4 });
            worksheet.SetRowHeight(25.62, new[] { 7 });

            using (ExcelRange range = worksheet.Cells[1, 2, 6, 11]) {
                range.Merge = true;
                range.Value = "(pieczęć)";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[1, 12, 5, 15]) {
                range.Merge = true;
                range.Value = "\"TOCAR\" MARCIN TOKARSKI";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Font.Bold = true;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[6, 12, 6, 15]) {
                range.Merge = true;
                range.Value = "Dostawca";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[1, 16, 2, 17]) {
                range.Merge = true;
                range.Value = "PZ";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Font.Bold = true;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[3, 16, 6, 17]) {
                range.Merge = true;
                range.Value = "przyjęcie zewnętrzne";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[1, 18, 1, 18]) {
                range.Merge = true;
                range.Value = "Nr Bieżący";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Font.Bold = true;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[2, 18, 3, 18]) {
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[4, 18, 5, 18]) {
                range.Merge = true;
                range.Value = "Nr  magazynowy";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[6, 18, 6, 18]) {
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[1, 19, 1, 19]) {
                range.Merge = true;
                range.Value = "Egz.";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Font.Bold = true;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[2, 19, 3, 19]) {
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[4, 19, 5, 19]) {
                range.Merge = true;
                range.Value = "Data wystawienia";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[6, 19, 6, 19]) {
                range.Merge = true;
                range.Value = "06.12.2018";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[7, 2, 7, 6]) {
                range.Merge = true;
                range.Value = "Środek transportu";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[7, 7, 7, 11]) {
                range.Merge = true;
                range.Value = "Zamówienie";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[7, 12, 7, 12]) {
                range.Merge = true;
                range.Value = "Przeznaczenie";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[7, 13, 7, 14]) {
                range.Merge = true;
                range.Value = "Data wysyłki";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[7, 15, 7, 15]) {
                range.Merge = true;
                range.Value = "Data otrzymania";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[7, 16, 7, 19]) {
                range.Merge = true;
                range.Value = "Numer i data faktury - specyfikacji";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[8, 2, 8, 6]) {
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[8, 7, 8, 11]) {
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[8, 12, 8, 12]) {
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[8, 13, 8, 14]) {
                range.Merge = true;
                range.Value = "29.11.2018";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[8, 15, 8, 15]) {
                range.Merge = true;
                range.Value = "06.12.2018";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[8, 16, 8, 19]) {
                range.Merge = true;
                range.Value = @"Faktura VAT Korekta 01/12/2018 od 06.12.2018";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            //Table header
            using (ExcelRange range = worksheet.Cells[9, 2, 9, 6]) {
                range.Merge = true;
                range.Value = @"Kod towaru/ materiału";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[9, 7, 9, 11]) {
                range.Merge = true;
                range.Value = @"Nazwa towaru/materiału/opakowania";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[9, 12, 9, 14]) {
                range.Merge = true;
                range.Value = "Ilość";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[9, 15, 9, 15]) {
                range.Merge = true;
                range.Value = "Cena";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[9, 16, 9, 17]) {
                range.Merge = true;
                range.Value = "Wartość";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[9, 18, 9, 18]) {
                range.Merge = true;
                range.Value = "Konto syntet.";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[9, 19, 9, 19]) {
                range.Merge = true;
                range.Value = "Zapas";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[10, 2, 10, 6]) {
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[10, 7, 10, 11]) {
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[10, 12, 10, 12]) {
                range.Merge = true;
                range.Value = "Dostarczona";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[10, 13, 10, 13]) {
                range.Merge = true;
                range.Value = "j.m.";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[10, 14, 10, 14]) {
                range.Merge = true;
                range.Value = "Przyjęta";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[10, 15, 10, 15]) {
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[10, 16, 10, 17]) {
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[10, 18, 10, 18]) {
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[10, 19, 10, 19]) {
                range.Merge = true;
                range.Value = "Ilość";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            int row = 11;

            //Table body
            decimal totalAmountLocal = 0m;

            foreach (OrderItem orderItem in sale.Order.OrderItems) {
                using (ExcelRange range = worksheet.Cells[row, 2, row, 6]) {
                    range.Merge = true;
                    range.Value = orderItem.Product.VendorCode;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    range.Style.Font.Size = 10;
                    range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
                }

                using (ExcelRange range = worksheet.Cells[row, 7, row, 11]) {
                    range.Merge = true;
                    range.Value = $"{orderItem.Product.Name} {orderItem.AssignedSpecification?.SpecificationCode}";
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    range.Style.Font.Size = 10;
                    range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
                }

                using (ExcelRange range = worksheet.Cells[row, 12, row, 12]) {
                    range.Merge = true;
                    range.Value = orderItem.Qty;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    range.Style.Font.Size = 10;
                    range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
                }

                using (ExcelRange range = worksheet.Cells[row, 13, row, 13]) {
                    range.Merge = true;
                    range.Value = orderItem.Product.MeasureUnit.Name;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    range.Style.Font.Size = 10;
                    range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
                }

                using (ExcelRange range = worksheet.Cells[row, 14, row, 14]) {
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    range.Style.Font.Size = 10;
                    range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
                }

                using (ExcelRange range = worksheet.Cells[row, 15, row, 15]) {
                    range.Merge = true;
                    range.Value = decimal.Round(orderItem.PricePerItem * orderItem.ExchangeRateAmount, 2, MidpointRounding.AwayFromZero);
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    range.Style.Font.Size = 10;
                    range.Style.Numberformat.Format = "0.00";
                    range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
                }

                using (ExcelRange range = worksheet.Cells[row, 16, row, 17]) {
                    range.Merge = true;
                    range.Value = orderItem.TotalAmountLocal;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    range.Style.Font.Size = 10;
                    range.Style.Numberformat.Format = "0.00";
                    range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
                }

                using (ExcelRange range = worksheet.Cells[row, 18, row, 18]) {
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    range.Style.Font.Size = 10;
                    range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
                }

                using (ExcelRange range = worksheet.Cells[row, 19, row, 19]) {
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    range.Style.Font.Size = 10;
                    range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
                }

                worksheet.SetRowHeight(12.71, row);
                row++;

                totalAmountLocal = decimal.Round(totalAmountLocal + orderItem.TotalAmountLocal, 2, MidpointRounding.AwayFromZero);
            }

            //Totals
            using (ExcelRange range = worksheet.Cells[row, 2, row, 6]) {
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[row, 7, row, 11]) {
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[row, 12, row, 12]) {
                range.Merge = true;
                range.Value = sale.Order.OrderItems.Sum(i => i.Qty);
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[row, 13, row, 13]) {
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[row, 14, row, 14]) {
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[row, 15, row, 15]) {
                range.Merge = true;
                range.Value = "Razem: ";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[row, 16, row, 16]) {
                range.Merge = true;
                range.Value = totalAmountLocal;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Font.Bold = true;
                range.Style.Numberformat.Format = "0.00";
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[row, 17, row, 17]) {
                range.Merge = true;
                range.Value = "PLN";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Font.Bold = true;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[row, 18, row, 18]) {
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[row, 19, row, 19]) {
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            worksheet.SetRowHeight(12.71, row);
            row++;

            using (ExcelRange range = worksheet.Cells[row, 2, row, 6]) {
                range.Merge = true;
                range.Value = "Wystawił";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[row, 7, row, 11]) {
                range.Merge = true;
                range.Value = "Zatwierdził";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[row, 12, row, 19]) {
                range.Merge = true;
                range.Value = "Wymienione ilości";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            worksheet.SetRowHeight(12.71, row);
            row++;

            using (ExcelRange range = worksheet.Cells[row, 2, row, 6]) {
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[row, 7, row, 11]) {
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[row, 12, row, 13]) {
                range.Merge = true;
                range.Value = "Dostarczył";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[row, 14, row, 14]) {
                range.Merge = true;
                range.Value = "Data";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[row, 15, row, 17]) {
                range.Merge = true;
                range.Value = "Przyjął";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[row, 18, row, 19]) {
                range.Merge = true;
                range.Value = "Ewidencja ilościowo - wartościowa";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            worksheet.SetRowHeight(12.71, row);
            row++;

            using (ExcelRange range = worksheet.Cells[row, 2, row, 6]) {
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[row, 7, row, 11]) {
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[row, 12, row, 13]) {
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[row, 14, row, 14]) {
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[row, 15, row, 17]) {
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            using (ExcelRange range = worksheet.Cells[row, 18, row, 19]) {
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.Border.BorderAround(ExcelBorderStyle.Hair);
            }

            worksheet.SetRowHeight(12.71, row);

            //Setting default font options
            using (ExcelRange range = worksheet.Cells[1, 1, worksheet.Dimension.End.Row, worksheet.Dimension.End.Column]) {
                range.Style.Font.Name = "Times New Roman";
            }

            package.Workbook.Properties.Title = "PZ Document";
            package.Workbook.Properties.Author = "Concord CRM";
            package.Workbook.Properties.Comments = "Auto-generated xlsx by Concord CRM";

            //Saving the file.
            package.Save();
        }

        return SaveFiles(fileName);
    }

    public (string xlsxFile, string pdfFile) ExportUkInvoiceToXlsx(string path, Sale sale, IEnumerable<DocumentMonth> months) {
        string fileName = Path.Combine(path, $"{sale.SaleInvoiceNumber.Number}_{DateTime.Now.ToString("MM.yyyy")}_{Guid.NewGuid().ToString()}.xlsx");

        DateTime current = DateTime.Now;

        using (ExcelPackage package = NewExcelPackage(fileName)) {
            ExcelWorksheet worksheet = package.Workbook.Worksheets.Add("Накладна");

            worksheet.ApplyPrinterSettings(0.5m, 0.5m, 0.1m, 0.1m, 0.25m, 0.25m, true);

            worksheet.Cells.Style.Font.Name = "Arial";
            worksheet.Cells.Style.Font.Size = 8;
            worksheet.DefaultColWidth = 9.83;
            worksheet.DefaultRowHeight = 11.25;

            //Set Rows
            worksheet.SetRowHeight(3.75, new[] { 1, 4, 5, 6 });
            worksheet.SetRowHeight(3.95, new[] { 11, 14, 17 });
            worksheet.SetRowHeight(12.75, new[] { 9, 10, 12, 13, 15, 16 });
            worksheet.SetRowHeight(31, new[] { 7, 3 });
            worksheet.SetRowHeight(45, new[] { 2 });

            //Set Columns
            worksheet.SetColumnWidth(0.83, new[] { 1, 34, 37 });
            worksheet.SetColumnWidth(2.33, new[] { 3, 9, 11, 13, 15 });
            worksheet.SetColumnWidth(3, new[] { 8, 10 });
            worksheet.SetColumnWidth(2.5, new[] { 12, 67 });
            worksheet.SetColumnWidth(1, new[] { 16, 28, 31 });
            worksheet.SetColumnWidth(0.33, new[] { 18, 23, 58, 60, 62, 64, 66, 68, 70, 72, 74, 76, 78 });
            worksheet.SetColumnWidth(1, new[] { 20, 22, 43 });
            worksheet.SetColumnWidth(0.16, new[] { 24, 27, 30, 33, 36, 39, 42, 45, 48 });
            worksheet.SetColumnWidth(1, new[] { 25, 57, 35, 41, 44, 47, 50, 51 });
            worksheet.SetColumnWidth(1.5, new[] { 26, 29, 32, 38, 41, 52, 54, 576, 61 });
            worksheet.SetColumnWidth(1.33, new[] { 40, 55 });
            worksheet.SetColumnWidth(1.83, new[] { 46, 71, 77 });
            worksheet.SetColumnWidth(2.16, new[] { 49, 59 });
            worksheet.SetColumnWidth(2, new[] { 14, 21, 53, 56, 63, 65 });
            worksheet.SetColumnWidth(3, new[] { 69, 73, 75 });
            worksheet.SetColumnWidth(1.7, 17);
            worksheet.SetColumnWidth(2.42, 19);
            worksheet.SetColumnWidth(2.34, 4);
            worksheet.SetColumnWidth(3, 5);
            worksheet.SetColumnWidth(3, 6);
            worksheet.SetColumnWidth(3.5, 7);
            worksheet.SetColumnWidth(2.9, 2);

            int row = 2;
            int column = 2;

            //Document header
            using (ExcelRange range = worksheet.Cells[row, column, row, column + 10]) {
                range.Merge = true;
                range.Value = "Перевізник:";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.UnderLine = true;
                range.Style.Font.Size = 14;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 11, row, column + 75]) {
                range.Merge = true;
                string value = sale.Transporter.Name;

                if (!string.IsNullOrEmpty(sale.DeliveryRecipientAddress.City))
                    value += ", " + sale.DeliveryRecipientAddress.City;
                if (!string.IsNullOrEmpty(sale.DeliveryRecipientAddress.Value))
                    value += ", " + sale.DeliveryRecipientAddress.Value;
                if (!string.IsNullOrEmpty(sale.DeliveryRecipientAddress.Department))
                    value += ", " + sale.DeliveryRecipientAddress.Department;
                if (!string.IsNullOrEmpty(sale.DeliveryRecipient.FullName))
                    value += ", " + sale.DeliveryRecipient.FullName;
                if (!string.IsNullOrEmpty(sale.DeliveryRecipient.MobilePhone))
                    value += ", " + sale.DeliveryRecipient.MobilePhone;

                range.Value = value;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Bold = true;

                if (value.Length < 50)
                    range.Style.Font.Size = 14;
                else
                    range.Style.Font.Size = 10;
                range.Style.WrapText = true;
                range.Merge = true;
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column, row, column + 6]) {
                range.Value = "Примітка:";
                range.Merge = true;
                range.Style.Font.UnderLine = true;
                range.Style.Font.Size = 14;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 7, row, column + 75]) {
                string value = string.Empty;

                if (sale.IsCashOnDelivery) value += $" накладний платіж: {decimal.Round(sale.CashOnDeliveryAmount, 2, MidpointRounding.AwayFromZero)}. ";

                if (sale.CustomersOwnTtn != null) value += $" власне ТТН: {sale.CustomersOwnTtn.Number}. ";

                if (!string.IsNullOrEmpty(sale.Comment)) value += $" коментар: {sale.Comment}. ";

                range.Value = value;
                range.Merge = true;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 10;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column - 1, row, column + 75]) {
                range.Style.Border.Bottom.Style = ExcelBorderStyle.MediumDashed;
            }

            row += 3;

            using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                range.Merge = true;
                string invoice = "Видаткова накладна № {0} від {1} р.";
                if (sale.HistoryInvoiceEdit.Any() && !sale.IsVatSale) invoice += "                Змінено";
                range.Value = string.Format(
                    invoice,
                    sale.SaleNumber.Value,
                    $"{sale.ChangedToInvoice.Value.Day} {months.FirstOrDefault(m => m.Number.Equals(sale.ChangedToInvoice.Value.Month))?.Name.ToLower()} {sale.ChangedToInvoice.Value.Year}"
                );
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Medium;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 14;
            }

            row += 2;

            using (ExcelRange range = worksheet.Cells[row, column, row, column + 4]) {
                range.Merge = true;
                range.Value = "Постачальник:";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.UnderLine = true;
                range.Style.Font.Size = 9;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 6, row, column + 75]) {
                range.Merge = true;
                range.Value = sale.ClientAgreement.Agreement.Organization.Name;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 11;
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column + 7, row, column + 75]) {
                range.Merge = true;
                string val = string.Empty;

                switch (sale.ClientAgreement.Agreement.Organization.TypeTaxation) {
                    case TypeTaxation.SingleTax:
                        val = "Є платником єдиного податку";
                        break;
                    case TypeTaxation.SingleTaxAndVat:
                        val = "Є платником єдиного податку та ПДВ";
                        break;
                    case TypeTaxation.IncomeTax:
                        val = "Є платником податку на прибуток";
                        break;
                    case TypeTaxation.IncomeTaxAndVat:
                        val = "Є платником податку на прибуток на загальних підставах";
                        break;
                    case TypeTaxation.NotPaying:
                        val = "Не є платником податку на прибуток на загальних підставах";
                        break;
                }

                range.Value = val;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
            }

            row += 2;
            using (ExcelRange range = worksheet.Cells[row, column, row, column + 4]) {
                range.Merge = true;
                range.Value = "Покупець:";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.UnderLine = true;
                range.Style.Font.Size = 9;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 6, row, column + 75]) {
                range.Merge = true;
                range.Value =
                    string.Format(
                        "{0} - {1}",
                        !string.IsNullOrEmpty(sale.ClientAgreement.Client.FullName) ? sale.ClientAgreement.Client.FullName : sale.ClientAgreement.Client.Name,
                        sale.ClientAgreement.Client.RegionCode?.Value ?? ""
                    );
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 11;
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column + 7, row, column + 75]) {
                string clientInfo = string.Empty;

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.RegionCode?.City)) clientInfo += $"{sale.ClientAgreement.Client.RegionCode.City}, ";

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.RegionCode?.District)) clientInfo += $"{sale.ClientAgreement.Client.RegionCode.District}, ";

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.ActualAddress)) clientInfo += $"{sale.ClientAgreement.Client.ActualAddress}, ";

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.MobileNumber) && sale.RetailClientId.HasValue)
                    clientInfo += $"тел.: {sale.ClientAgreement.Client.MobileNumber}";

                range.Style.WrapText = true;
                range.Merge = true;
                range.Value = clientInfo;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;

                if (string.IsNullOrEmpty(clientInfo))
                    worksheet.SetRowHeight(1, row);

                if (clientInfo.Length > 80)
                    worksheet.SetRowHeight(24, row);
            }

            row += 2;
            //Table header
            row += 2;

            int tableStartRow = row;

            using (ExcelRange range = worksheet.Cells[row, column, row + 1, column + 1]) {
                range.Value = "№";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 2, row + 1, column + 13]) {
                range.Value = "Артикул";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 14, row + 1, column + 20]) {
                range.Value = "Розм.";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 21, row + 1, column + 48]) {
                range.Value = "Товар";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 49, row + 1, column + 60]) {
                range.Value = "Кількість";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 61, row + 1, column + 68]) {
                range.Value = "Ціна";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 69, row + 1, column + 76]) {
                range.Value = "Сума";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            worksheet.SetRowHeight(20, row + 2);

            using (ExcelRange range = worksheet.Cells[row + 2, column, row + 2, column + 10]) {
                range.Value = "Примітка:";
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Medium;
                range.Style.Font.Italic = true;
                range.Style.Font.Size = 12;
                range.Style.Border.Right.Style = ExcelBorderStyle.Thin;
                range.Style.Font.UnderLine = true;
            }

            using (ExcelRange range = worksheet.Cells[row + 2, column + 11, row + 2, column + 76]) {
                range.Value = sale.Comment;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Medium;
                range.Style.Font.Size = 12;
            }

            row += 3;

            //Table body

            int tableRowNumber = 1;

            foreach (OrderItem item in sale.Order.OrderItems) {
                bool specialItem =
                    item.Product.IsForSale || item.Product.IsForZeroSale || item.Product.Top.ToUpper().Equals("X9") || item.Product.Top.ToUpper().Equals("Х9");
                if (item.TotalAmountLocal == 0) continue;
                decimal currentPrice = decimal.Round(item.TotalAmountLocal / Convert.ToDecimal(item.Qty), 2, MidpointRounding.AwayFromZero);
                decimal currentTotalPrice = decimal.Round(item.TotalAmountLocal, 2, MidpointRounding.AwayFromZero);

                if (specialItem) {
                    if (item.ProductLocations.Any() || item.ProductLocationsHistory.Any()) {
                        foreach (ProductLocation location in item.ProductLocations) {
                            foreach (ProductLocationHistory locationHistory in item.ProductLocationsHistory.Where(x => x.TypeOfMovement == TypeOfMovement.Return))
                                if (location.ProductPlacementId == locationHistory.ProductPlacementId) {
                                    location.Qty += locationHistory.Qty;
                                    locationHistory.Qty = 0;
                                }

                            //Special OrderItem
                            using (ExcelRange range = worksheet.Cells[row, column]) {
                                range.Value = tableRowNumber;
                                range.Style.Font.Size = 9;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            //Special mark * 
                            using (ExcelRange range = worksheet.Cells[row, column + 1]) {
                                range.Value = "*";
                                range.Style.Font.Size = 22;
                                range.Style.Font.Bold = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 13]) {
                                range.Value = item.Product.VendorCode;
                                range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 16;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 14, row, column + 20]) {
                                string locationAddress =
                                    location.ProductPlacement.StorageNumber +
                                    "-" +
                                    (
                                        string.IsNullOrEmpty(location.ProductPlacement.RowNumber)
                                            ? string.Empty
                                            : $"{location.ProductPlacement.RowNumber}-"
                                    ) +
                                    location.ProductPlacement.CellNumber;

                                range.Value = locationAddress;
                                range.Style.Font.Size = 10;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 21, row, column + 48]) {
                                range.Value = item.Product.Name;
                                range.Merge = true;
                                range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                range.Style.WrapText = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                range.Value = location.Qty;
                                range.Style.Font.Size = 16;
                                range.Style.Font.Bold = true;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                range.Value = item.Product.MeasureUnit.Name;
                                range.Style.Font.Size = 11;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                //ToDo: local price
                                range.Value = currentPrice;
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                //ToDo: local price
                                range.Value = decimal.Round(currentPrice * Convert.ToDecimal(location.Qty), 2, MidpointRounding.AwayFromZero);
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            if (item.Product.Name.Length > 18) {
                                if (item.Product.Name.Length < 35)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);
                            }

                            if (item.Product.VendorCode.Length > 15)
                                worksheet.SetRowHeight(28, row);
                            else
                                worksheet.SetRowHeight(35, row);

                            row++;
                        }

                        if (item.ProductLocationsHistory.Any())
                            foreach (ProductLocationHistory location in item.ProductLocationsHistory.Where(x => x.Qty != 0)) {
                                //Special OrderItem
                                using (ExcelRange range = worksheet.Cells[row, column]) {
                                    range.Value = tableRowNumber;
                                    range.Style.Font.Size = 9;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                //Special mark * 
                                using (ExcelRange range = worksheet.Cells[row, column + 1]) {
                                    range.Value = "*";
                                    range.Style.Font.Size = 22;
                                    range.Style.Font.Bold = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 13]) {
                                    range.Value = item.Product.VendorCode;
                                    range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 16;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 14, row, column + 20]) {
                                    string locationAddress =
                                        location.ProductPlacement.StorageNumber +
                                        "-" +
                                        (
                                            string.IsNullOrEmpty(location.ProductPlacement.RowNumber)
                                                ? string.Empty
                                                : $"{location.ProductPlacement.RowNumber}-"
                                        ) +
                                        location.ProductPlacement.CellNumber;

                                    range.Value = locationAddress;
                                    range.Style.Font.Size = 10;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 21, row, column + 48]) {
                                    range.Value = item.Product.Name;
                                    range.Merge = true;
                                    range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                    range.Style.WrapText = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                    range.Value = location.Qty;
                                    range.Style.Font.Size = 16;
                                    range.Style.Font.Bold = true;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                    range.Value = item.Product.MeasureUnit.Name;
                                    range.Style.Font.Size = 11;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                    //ToDo: local price
                                    range.Value = currentPrice;
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                    //ToDo: local price
                                    range.Value = decimal.Round(currentPrice * Convert.ToDecimal(location.Qty), 2, MidpointRounding.AwayFromZero);
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                if (item.Product.Name.Length > 18) {
                                    if (item.Product.Name.Length < 35)
                                        worksheet.SetRowHeight(28, row);
                                    else
                                        worksheet.SetRowHeight(35, row);
                                }

                                if (item.Product.VendorCode.Length > 15)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);

                                row++;
                            }

                        if (item.ProductLocations.Sum(l => l.Qty) + item.ProductLocationsHistory.Sum(g => g.Qty) < item.Qty) {
                            //Special OrderItem
                            using (ExcelRange range = worksheet.Cells[row, column]) {
                                range.Value = tableRowNumber;
                                range.Style.Font.Size = 9;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            //Special mark * 
                            using (ExcelRange range = worksheet.Cells[row, column + 1]) {
                                range.Value = "*";
                                range.Style.Font.Size = 22;
                                range.Style.Font.Bold = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 13]) {
                                range.Value = item.Product.VendorCode;
                                range.Style.Font.Size = 16;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 14, row, column + 20]) {
                                range.Value = string.Empty;
                                range.Style.Font.Size = 10;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 21, row, column + 48]) {
                                range.Value = item.Product.Name;
                                range.Merge = true;
                                range.Style.WrapText = true;
                                range.Style.Font.Size = 11;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            double totalQty = item.Qty - (item.ProductLocations.Sum(l => l.Qty) + item.ProductLocationsHistory.Sum(g => g.Qty));
                            using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                range.Value = totalQty;
                                range.Style.Font.Size = 16;
                                range.Style.Font.Bold = true;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                range.Value = item.Product.MeasureUnit.Name;
                                range.Style.Font.Size = 11;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                //ToDo: local price
                                range.Value = currentPrice;
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                //ToDo: local price
                                range.Value = decimal.Round(currentPrice * Convert.ToDecimal(totalQty), 2, MidpointRounding.AwayFromZero);
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            if (item.Product.Name.Length > 18) {
                                if (item.Product.Name.Length < 35)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);
                            }

                            row++;
                        }
                    } else {
                        //Special OrderItem
                        using (ExcelRange range = worksheet.Cells[row, column]) {
                            range.Value = tableRowNumber;
                            range.Style.Font.Size = 9;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        //Special mark * 
                        using (ExcelRange range = worksheet.Cells[row, column + 1]) {
                            range.Value = "*";
                            range.Style.Font.Size = 22;
                            range.Style.Font.Bold = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 13]) {
                            range.Value = item.Product.VendorCode;
                            range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 16;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 14, row, column + 20]) {
                            range.Value = string.Empty;
                            range.Style.Font.Size = 10;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 21, row, column + 48]) {
                            range.Value = item.Product.Name;
                            range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                            range.Merge = true;
                            range.Style.WrapText = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                            range.Value = item.Qty;
                            range.Style.Font.Size = 16;
                            range.Style.Font.Bold = true;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                            range.Value = item.Product.MeasureUnit.Name;
                            range.Style.Font.Size = 11;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                            //ToDo: local price
                            range.Value = currentPrice;
                            range.Style.Font.Size = 11;
                            range.Style.Numberformat.Format = "0.00";
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                            //ToDo: local price
                            range.Value = currentTotalPrice;
                            range.Style.Font.Size = 11;
                            range.Style.Numberformat.Format = "0.00";
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        if (item.Product.Name.Length > 18) {
                            if (item.Product.Name.Length < 35)
                                worksheet.SetRowHeight(28, row);
                            else
                                worksheet.SetRowHeight(35, row);
                        }

                        if (item.Product.VendorCode.Length > 15)
                            worksheet.SetRowHeight(28, row);
                        else
                            worksheet.SetRowHeight(35, row);

                        row++;
                    }
                } else {
                    if (item.ProductLocations.Any()) {
                        foreach (ProductLocation location in item.ProductLocations) {
                            foreach (ProductLocationHistory locationHistory in item.ProductLocationsHistory.Where(x => x.TypeOfMovement == TypeOfMovement.Return))
                                if (location.ProductPlacementId == locationHistory.ProductPlacementId) {
                                    location.Qty += locationHistory.Qty;
                                    locationHistory.Qty = 0;
                                }

                            if (item.ProductLocations.Count.Equals(1)) {
                                //Simple  OrderItem
                                using (ExcelRange range = worksheet.Cells[row, column, row, column + 1]) {
                                    range.Value = tableRowNumber;
                                    range.Style.Font.Size = 9;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 13]) {
                                    range.Value = item.Product.VendorCode;
                                    range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 16;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 14, row, column + 20]) {
                                    string locationAddress =
                                        location.ProductPlacement.StorageNumber +
                                        "-" +
                                        (
                                            string.IsNullOrEmpty(location.ProductPlacement.RowNumber)
                                                ? string.Empty
                                                : $"{location.ProductPlacement.RowNumber}-"
                                        ) +
                                        location.ProductPlacement.CellNumber;

                                    range.Value = locationAddress;
                                    range.Style.Font.Size = 10;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 21, row, column + 48]) {
                                    range.Value = item.Product.Name;
                                    range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                    range.Merge = true;
                                    range.Style.WrapText = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                    range.Value = location.Qty;
                                    range.Style.Font.Size = 16;
                                    range.Style.Font.Bold = true;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                    range.Value = item.Product.MeasureUnit.Name;
                                    range.Style.Font.Size = 11;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                    //ToDo: local price
                                    range.Value = item.Product.CurrentLocalPrice;
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                    //ToDo: local price
                                    range.Value =
                                        decimal.Round(
                                            item.Product.CurrentLocalPrice * Convert.ToDecimal(location.Qty),
                                            2,
                                            MidpointRounding.AwayFromZero
                                        );
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                if (item.Product.Name.Length > 18) {
                                    if (item.Product.Name.Length < 35)
                                        worksheet.SetRowHeight(28, row);
                                    else
                                        worksheet.SetRowHeight(35, row);
                                }

                                if (item.Product.VendorCode.Length > 15)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);

                                row++;
                            } else {
                                //Simple  OrderItem
                                using (ExcelRange range = worksheet.Cells[row, column, row, column + 1]) {
                                    range.Value = tableRowNumber;
                                    range.Style.Font.Size = 9;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 13]) {
                                    range.Value = item.Product.VendorCode;
                                    range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 16;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 14, row, column + 20]) {
                                    string locationAddress =
                                        location.ProductPlacement.StorageNumber +
                                        "-" +
                                        (
                                            string.IsNullOrEmpty(location.ProductPlacement.RowNumber)
                                                ? string.Empty
                                                : $"{location.ProductPlacement.RowNumber}-"
                                        ) +
                                        location.ProductPlacement.CellNumber;

                                    range.Value = locationAddress;
                                    range.Style.Font.Size = 10;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 21, row, column + 48]) {
                                    range.Value = item.Product.Name;
                                    range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                    range.Merge = true;
                                    range.Style.WrapText = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                    range.Value = location.Qty;
                                    range.Style.Font.Size = 16;
                                    range.Style.Font.Bold = true;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                    range.Value = item.Product.MeasureUnit.Name;
                                    range.Style.Font.Size = 11;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                    //ToDo: local price
                                    range.Value = currentPrice;
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                    //ToDo: local price
                                    range.Value = decimal.Round(currentPrice * Convert.ToDecimal(location.Qty), 2, MidpointRounding.AwayFromZero);
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                if (item.Product.Name.Length > 18) {
                                    if (item.Product.Name.Length < 35)
                                        worksheet.SetRowHeight(28, row);
                                    else
                                        worksheet.SetRowHeight(35, row);
                                }

                                if (item.Product.VendorCode.Length > 15)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);

                                row++;
                            }
                        }

                        if (item.ProductLocationsHistory.Any())
                            foreach (ProductLocationHistory location in item.ProductLocationsHistory.Where(x => x.Qty != 0)) {
                                //Special OrderItem
                                using (ExcelRange range = worksheet.Cells[row, column, row, column + 1]) {
                                    range.Value = tableRowNumber;
                                    range.Style.Font.Size = 9;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 13]) {
                                    range.Value = item.Product.VendorCode;
                                    range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 16;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 14, row, column + 20]) {
                                    string locationAddress =
                                        location.ProductPlacement.StorageNumber +
                                        "-" +
                                        (
                                            string.IsNullOrEmpty(location.ProductPlacement.RowNumber)
                                                ? string.Empty
                                                : $"{location.ProductPlacement.RowNumber}-"
                                        ) +
                                        location.ProductPlacement.CellNumber;

                                    range.Value = locationAddress;
                                    range.Style.Font.Size = 10;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 21, row, column + 48]) {
                                    range.Value = item.Product.Name;
                                    range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                    range.Merge = true;
                                    range.Style.WrapText = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                    range.Value = location.Qty;
                                    range.Style.Font.Size = 16;
                                    range.Style.Font.Bold = true;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                    range.Value = item.Product.MeasureUnit.Name;
                                    range.Style.Font.Size = 11;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                    //ToDo: local price
                                    range.Value = currentPrice;
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                    //ToDo: local price
                                    range.Value = decimal.Round(currentPrice * Convert.ToDecimal(location.Qty), 2, MidpointRounding.AwayFromZero);
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                if (item.Product.Name.Length > 18) {
                                    if (item.Product.Name.Length < 35)
                                        worksheet.SetRowHeight(28, row);
                                    else
                                        worksheet.SetRowHeight(35, row);
                                }

                                if (item.Product.VendorCode.Length > 15)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);

                                row++;
                            }

                        if (item.ProductLocations.Sum(l => l.Qty) + item.ProductLocationsHistory.Sum(g => g.Qty) < item.Qty) {
                            //Simple  OrderItem
                            using (ExcelRange range = worksheet.Cells[row, column, row, column + 1]) {
                                range.Value = tableRowNumber;
                                range.Style.Font.Size = 9;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 13]) {
                                range.Value = item.Product.VendorCode;
                                range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 16;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 14, row, column + 20]) {
                                range.Value = string.Empty;
                                range.Style.Font.Size = 10;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 21, row, column + 48]) {
                                range.Value = item.Product.Name;
                                range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                range.Merge = true;
                                range.Style.WrapText = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            double totalQty = item.Qty - (item.ProductLocations.Sum(l => l.Qty) + item.ProductLocationsHistory.Sum(g => g.Qty));
                            using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                range.Value = totalQty;
                                range.Style.Font.Size = 16;
                                range.Style.Font.Bold = true;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                range.Value = item.Product.MeasureUnit.Name;
                                range.Style.Font.Size = 11;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                //ToDo: local price
                                range.Value = currentPrice;
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                //ToDo: local price
                                range.Value = decimal.Round(currentPrice * Convert.ToDecimal(totalQty), 2, MidpointRounding.AwayFromZero);
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            if (item.Product.Name.Length > 18) {
                                if (item.Product.Name.Length < 35)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);
                            }

                            if (item.Product.VendorCode.Length > 15)
                                worksheet.SetRowHeight(28, row);
                            else
                                worksheet.SetRowHeight(35, row);

                            row++;
                        }
                    } else {
                        if (item.ProductLocationsHistory.Any())
                            foreach (ProductLocationHistory location in item.ProductLocationsHistory.Where(x => x.Qty != 0)) {
                                //Special OrderItem
                                using (ExcelRange range = worksheet.Cells[row, column, row, column + 1]) {
                                    range.Value = tableRowNumber;
                                    range.Style.Font.Size = 9;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 13]) {
                                    range.Value = item.Product.VendorCode;
                                    range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 16;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 14, row, column + 20]) {
                                    string locationAddress =
                                        location.ProductPlacement.StorageNumber +
                                        "-" +
                                        (
                                            string.IsNullOrEmpty(location.ProductPlacement.RowNumber)
                                                ? string.Empty
                                                : $"{location.ProductPlacement.RowNumber}-"
                                        ) +
                                        location.ProductPlacement.CellNumber;

                                    range.Value = locationAddress;
                                    range.Style.Font.Size = 10;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 21, row, column + 48]) {
                                    range.Value = item.Product.Name;
                                    range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                    range.Merge = true;
                                    range.Style.WrapText = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                    range.Value = location.Qty;
                                    range.Style.Font.Size = 16;
                                    range.Style.Font.Bold = true;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                    range.Value = item.Product.MeasureUnit.Name;
                                    range.Style.Font.Size = 11;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                    //ToDo: local price
                                    range.Value = currentPrice;
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                    //ToDo: local price
                                    range.Value = decimal.Round(currentPrice * Convert.ToDecimal(location.Qty), 2, MidpointRounding.AwayFromZero);
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                if (item.Product.Name.Length > 18) {
                                    if (item.Product.Name.Length < 35)
                                        worksheet.SetRowHeight(28, row);
                                    else
                                        worksheet.SetRowHeight(35, row);
                                }

                                if (item.Product.VendorCode.Length > 15)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);

                                row++;
                            }

                        if (item.ProductLocations.Sum(l => l.Qty) + item.ProductLocationsHistory.Sum(g => g.Qty) < item.Qty) {
                            //Simple  OrderItem
                            using (ExcelRange range = worksheet.Cells[row, column, row, column + 1]) {
                                range.Value = tableRowNumber;
                                range.Style.Font.Size = 9;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 13]) {
                                range.Value = item.Product.VendorCode;
                                range.Style.Font.Size = 16;
                                range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 16;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 14, row, column + 20]) {
                                range.Value = string.Empty;
                                range.Style.Font.Size = 10;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 21, row, column + 48]) {
                                range.Value = $"{item.Product.Name} {item.AssignedSpecification?.SpecificationCode}";
                                range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                range.Merge = true;
                                range.Style.WrapText = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            double totalQty = item.Qty - (item.ProductLocations.Sum(l => l.Qty) + item.ProductLocationsHistory.Sum(g => g.Qty));
                            using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                range.Value = totalQty;
                                range.Style.Font.Size = 16;
                                range.Style.Font.Bold = true;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                range.Value = item.Product.MeasureUnit.Name;
                                range.Style.Font.Size = 11;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                //ToDo: local price
                                range.Value = currentPrice;
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                //ToDo: local price
                                range.Value = decimal.Round(currentPrice * Convert.ToDecimal(totalQty), 2, MidpointRounding.AwayFromZero);
                                ;
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            if (item.Product.Name.Length > 18) {
                                if (item.Product.Name.Length < 35)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);
                            }

                            if (item.Product.VendorCode.Length > 15)
                                worksheet.SetRowHeight(28, row);
                            else
                                worksheet.SetRowHeight(35, row);

                            row++;
                        }
                        //Simple  OrderItem
                    }
                }

                tableRowNumber++;
            }

            int tableEndRow = row - 1;

            using (ExcelRange range = worksheet.Cells[tableStartRow, column, tableEndRow, column + 76]) {
                range.Style.Border.BorderAround(ExcelBorderStyle.Medium);
            }

            worksheet.SetRowHeight(6.95, row);
            worksheet.SetRowHeight(15, ++row);

            using (ExcelRange range = worksheet.Cells[row, column, row, column + 12]) {
                range.Value = DateTime.Now.ToString("dd.MM.yyyy HH:mm:ss");
                range.Style.Font.Size = 6;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 60, row, column + 66]) {
                range.Value = "Разом:";
                range.Style.Font.Size = 10;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            decimal totalAmount = sale.Order.OrderItems.Sum(x => x.TotalAmountLocal);

            using (ExcelRange range = worksheet.Cells[row, column + 68, row, column + 75]) {
                range.Value = decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero);
                range.Style.Font.Size = 11;
                range.Style.Numberformat.Format = "0.00";
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            worksheet.SetRowHeight(6.95, ++row);
            worksheet.SetRowHeight(11.25, ++row);

            if (sale.ClientAgreement.Agreement.Currency.Code.ToLower().Equals("eur")) {
                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero)} EUR.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheet.SetRowHeight(12.75, ++row);

                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                    int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                    string endKeyWord;

                    if (fullNumber > 10 && fullNumber < 20)
                        endKeyWord = "центів";
                    else
                        switch (endNumber) {
                            case 1:
                                endKeyWord = "цент";
                                break;
                            case 2:
                            case 3:
                            case 4:
                                endKeyWord = "цента";
                                break;
                            default:
                                endKeyWord = "центів";
                                break;
                        }

                    range.Value =
                        $"{totalAmount.ToText(true, true)} євро {(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100).ToText(false, true)} {endKeyWord}";
                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            } else if (sale.ClientAgreement.Agreement.Currency.Code.ToLower().Equals("usd")) {
                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero)} USD.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheet.SetRowHeight(12.75, ++row);

                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                    int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                    string endKeyWord;

                    if (fullNumber > 10 && fullNumber < 20)
                        endKeyWord = "центів";
                    else
                        switch (endNumber) {
                            case 1:
                                endKeyWord = "цент";
                                break;
                            case 2:
                            case 3:
                            case 4:
                                endKeyWord = "цента";
                                break;
                            default:
                                endKeyWord = "центів";
                                break;
                        }

                    range.Value =
                        $"{decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero).ToText(true, true)} доларів {(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100).ToText(false, true)} {endKeyWord}";
                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            } else if (sale.ClientAgreement.Agreement.Currency.Code.ToLower().Equals("pln")) {
                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero)} PLN.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheet.SetRowHeight(12.75, ++row);

                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                    int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                    string endKeyWord;

                    if (fullNumber > 10 && fullNumber < 20)
                        endKeyWord = "грошів";
                    else
                        switch (endNumber) {
                            case 1:
                                endKeyWord = "грош";
                                break;
                            case 2:
                            case 3:
                            case 4:
                                endKeyWord = "гроша";
                                break;
                            default:
                                endKeyWord = "грошів";
                                break;
                        }

                    range.Value =
                        $"{decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero).ToText(true, true)} злотих {(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100).ToText(false, true)} {endKeyWord}";
                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            } else {
                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero)} ГРН.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheet.SetRowHeight(12.75, ++row);

                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                    int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                    string endKeyWord;

                    if (fullNumber > 10 && fullNumber < 20)
                        endKeyWord = "копійок";
                    else
                        switch (endNumber) {
                            case 1:
                                endKeyWord = "копійка";
                                break;
                            case 2:
                            case 3:
                            case 4:
                                endKeyWord = "копійки";
                                break;
                            default:
                                endKeyWord = "копійок";
                                break;
                        }

                    range.Value =
                        $"{decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero).ToText(true, true)} гривень {(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100).ToText(false, true)} {endKeyWord}";
                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            }

            worksheet.SetRowHeight(6.95, ++row);
            using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Medium;
            }

            row++;

            worksheet.SetRowHeight(12.75, ++row);

            using (ExcelRange range = worksheet.Cells[row, column, row, column + 5]) {
                range.Value = "Відвантажив(ла): ";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 7, row, column + 29]) {
                range.Merge = true;
                range.Value = "директор " + sale.ClientAgreement.Agreement.Organization.Manager;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            using (ExcelRange range = worksheet.Cells[row + 1, column + 7, row + 1, column + 29]) {
                range.Style.Border.Top.Style = ExcelBorderStyle.Thin;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 36, row, column + 51]) {
                range.Value = "Отримав(ла):";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 52, row, column + 73]) {
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Thin;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            row++;
            worksheet.SetRowHeight(6.95, ++row);
            worksheet.SetRowHeight(12.75, ++row);

            using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                range.Value = $"Термін оплати до {DateTime.Now.AddDays(sale.ClientAgreement.Agreement.NumberDaysDebt).ToString("dd.MM.yyyy")}";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Style.Font.UnderLine = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            worksheet.SetRowHeight(6.95, ++row);

            //Remark
            worksheet.SetRowHeight(10, ++row);

            row++;
            worksheet.SetRowHeight(12.75, ++row);

            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 75]) {
                range.Value = "Вимоги до повернень";
                range.Style.Font.Size = 10;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            }

            row++;
            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 75]) {
                range.Value = "1)Товар має бути запакований";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            row++;
            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 75]) {
                range.Value = "2)Коробка даного товару і сам товар мають бути без пошкоджень";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            row++;
            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 75]) {
                range.Value = "3)Повинні бути документи на повернення: від кого і причина повернення в письмовому вигляді";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            row++;
            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 75]) {
                range.Value = "4)Товар не буде прийматися, якщо вказане не буде виконано, і в цьому випадку товар буде відправлено назад покупцеві.";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            package.Save();
        }

        return SaveFiles(fileName);
    }

    public (string xlsxFile, string pdfFile) ExportUkInvoiceFromStorageToXlsxFromSale(string path, Sale sale, IEnumerable<DocumentMonth> months) {
        string fileName = Path.Combine(path, $"{sale.SaleInvoiceNumber.Number}_{DateTime.Now.ToString("MM.yyyy")}_{Guid.NewGuid().ToString()}.xlsx");

        DateTime current = DateTime.Now;

        using (ExcelPackage package = NewExcelPackage(fileName)) {
            ExcelWorksheet worksheet = package.Workbook.Worksheets.Add("Накладна");

            worksheet.ApplyPrinterSettings(0.5m, 0.5m, 0.1m, 0.1m, 0.25m, 0.25m, true);

            worksheet.Cells.Style.Font.Name = "Arial";
            worksheet.Cells.Style.Font.Size = 8;
            worksheet.DefaultColWidth = 9.83;
            worksheet.DefaultRowHeight = 11.25;

            //Set Rows
            worksheet.SetRowHeight(3.75, new[] { 1, 4, 5, 6 });
            worksheet.SetRowHeight(3.95, new[] { 11, 14, 17 });
            worksheet.SetRowHeight(12.75, new[] { 9, 10, 12, 13, 15, 16 });
            worksheet.SetRowHeight(31, new[] { 7, 3 });
            worksheet.SetRowHeight(45, new[] { 2 });

            //Set Columns
            worksheet.SetColumnWidth(0.83, new[] { 1, 34, 37 });
            worksheet.SetColumnWidth(2.33, new[] { 3, 9, 11, 13, 15 });
            worksheet.SetColumnWidth(3, new[] { 8, 10 });
            worksheet.SetColumnWidth(2.5, new[] { 12, 67 });
            worksheet.SetColumnWidth(0.66, new[] { 16, 28, 31 });
            worksheet.SetColumnWidth(0.33, new[] { 18, 23, 58, 60, 62, 64, 66, 68, 70, 72, 74, 76, 78 });
            worksheet.SetColumnWidth(0.5, new[] { 20, 22, 43 });
            worksheet.SetColumnWidth(0.16, new[] { 24, 27, 30, 33, 36, 39, 42, 45, 48 });
            worksheet.SetColumnWidth(1, new[] { 25, 57, 35, 41, 44, 47, 50, 51 });
            worksheet.SetColumnWidth(1.5, new[] { 26, 29, 32, 38, 41, 52, 54, 576, 61 });
            worksheet.SetColumnWidth(1.33, new[] { 40, 55 });
            worksheet.SetColumnWidth(1.83, new[] { 46, 71, 77 });
            worksheet.SetColumnWidth(2.16, new[] { 49, 59 });
            worksheet.SetColumnWidth(2, new[] { 14, 17, 21, 53, 56, 63, 65 });
            worksheet.SetColumnWidth(3, new[] { 69, 73, 75 });
            worksheet.SetColumnWidth(2.42, 19);
            worksheet.SetColumnWidth(2.75, 4);
            worksheet.SetColumnWidth(3, 5);
            worksheet.SetColumnWidth(3, 6);
            worksheet.SetColumnWidth(3.5, 7);
            worksheet.SetColumnWidth(2.9, 2);

            int row = 2;
            int column = 2;

            //Document header
            using (ExcelRange range = worksheet.Cells[row, column, row, column + 10]) {
                range.Merge = true;
                range.Value = "Перевізник:";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.UnderLine = true;
                range.Style.Font.Size = 14;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 11, row, column + 75]) {
                range.Merge = true;
                string value = sale.Transporter.Name;

                if (!string.IsNullOrEmpty(sale.DeliveryRecipientAddress.City))
                    value += ", " + sale.DeliveryRecipientAddress.City;
                if (!string.IsNullOrEmpty(sale.DeliveryRecipientAddress.Value))
                    value += ", " + sale.DeliveryRecipientAddress.Value;
                if (!string.IsNullOrEmpty(sale.DeliveryRecipientAddress.Department))
                    value += ", " + sale.DeliveryRecipientAddress.Department;
                if (!string.IsNullOrEmpty(sale.DeliveryRecipient.FullName))
                    value += ", " + sale.DeliveryRecipient.FullName;
                if (!string.IsNullOrEmpty(sale.DeliveryRecipient.MobilePhone))
                    value += ", " + sale.DeliveryRecipient.MobilePhone;

                range.Value = value;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Bold = true;

                if (value.Length < 50)
                    range.Style.Font.Size = 14;
                else
                    range.Style.Font.Size = 10;
                range.Style.WrapText = true;
                range.Merge = true;
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column, row, column + 6]) {
                range.Value = "Примітка:";
                range.Merge = true;
                range.Style.Font.UnderLine = true;
                range.Style.Font.Size = 14;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 7, row, column + 75]) {
                string value = string.Empty;

                if (sale.IsCashOnDelivery) value += $" накладний платіж: {decimal.Round(sale.CashOnDeliveryAmount, 2, MidpointRounding.AwayFromZero)}. ";

                if (sale.CustomersOwnTtn != null) value += $" власне ТТН: {sale.CustomersOwnTtn.Number}. ";
                if (!string.IsNullOrEmpty(sale.Comment)) value += $" коментар: {sale.Comment}. ";

                range.Value = value;
                range.Merge = true;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 10;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column - 1, row, column + 75]) {
                range.Style.Border.Bottom.Style = ExcelBorderStyle.MediumDashed;
            }

            row += 3;

            using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                range.Merge = true;
                range.Value =
                    string.Format(
                        "Видаткова накладна № {0} від {1} р.",
                        sale.SaleNumber.Value,
                        $"{sale.ChangedToInvoice.Value.Day}   {months.FirstOrDefault(m => m.Number.Equals(sale.ChangedToInvoice.Value.Month))?.Name.ToLower() ?? string.Empty}   {sale.ChangedToInvoice.Value.Year}"
                    );
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Medium;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 14;
            }

            row += 2;

            using (ExcelRange range = worksheet.Cells[row, column, row, column + 4]) {
                range.Merge = true;
                range.Value = "Постачальник:";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.UnderLine = true;
                range.Style.Font.Size = 9;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 6, row, column + 75]) {
                range.Merge = true;
                range.Value = sale.ClientAgreement.Agreement.Organization.Name;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 11;
                range.Style.WrapText = true;
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column + 7, row, column + 75]) {
                range.Merge = true;
                string val = string.Empty;

                switch (sale.ClientAgreement.Agreement.Organization.TypeTaxation) {
                    case TypeTaxation.SingleTax:
                        val = "Є платником єдиного податку";
                        break;
                    case TypeTaxation.SingleTaxAndVat:
                        val = "Є платником єдиного податку та ПДВ";
                        break;
                    case TypeTaxation.IncomeTax:
                        val = "Є платником податку на прибуток";
                        break;
                    case TypeTaxation.IncomeTaxAndVat:
                        val = "Є платником податку на прибуток на загальних підставах";
                        break;
                    case TypeTaxation.NotPaying:
                        val = "Не є платником податку на прибуток на загальних підставах";
                        break;
                }

                range.Value = val;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
            }

            row += 2;
            using (ExcelRange range = worksheet.Cells[row, column, row, column + 4]) {
                range.Merge = true;
                range.Value = "Покупець:";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.UnderLine = true;
                range.Style.Font.Size = 9;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 6, row, column + 75]) {
                range.Merge = true;
                range.Value =
                    string.Format(
                        "{0} ", //{1}
                        !string.IsNullOrEmpty(sale.ClientAgreement.Client.FullName) ? sale.ClientAgreement.Client.FullName : sale.ClientAgreement.Client.Name
                        // , sale.ClientAgreement.Client.RegionCode == null ? "" : "- " + sale.ClientAgreement.Client.RegionCode.Value
                    );
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 11;
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column + 7, row, column + 75]) {
                string clientInfo = string.Empty;

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.RegionCode?.City)) clientInfo += $"{sale.ClientAgreement.Client.RegionCode.City}, ";

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.RegionCode?.District)) clientInfo += $"{sale.ClientAgreement.Client.RegionCode.District}, ";

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.ActualAddress)) clientInfo += $"{sale.ClientAgreement.Client.ActualAddress}, ";

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.MobileNumber) && sale.RetailClientId.HasValue)
                    clientInfo += $"тел.: {sale.ClientAgreement.Client.MobileNumber}";
                range.Merge = true;
                range.Value = clientInfo;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.WrapText = true;

                if (string.IsNullOrEmpty(clientInfo))
                    worksheet.SetRowHeight(1, row);

                if (clientInfo.Length > 80)
                    worksheet.SetRowHeight(24, row);
            }

            row += 2;

            if (sale.ClientAgreement.Agreement.WithVATAccounting) {
                using ExcelRange range = worksheet.Cells[row, column, row, column + 75];
                range.Merge = true;
                range.Value = "Видаткова накладна є підставою для оплати";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 10;
            }

            row += 2;
            //Table header
            row += 2;

            int tableStartRow = row;

            using (ExcelRange range = worksheet.Cells[row, column, row + 1, column + 1]) {
                range.Value = "№";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 2, row + 1, column + 13]) {
                range.Value = "Артикул";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 14, row + 1, column + 20]) {
                range.Value = "Розм.";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 21, row + 1, column + 48]) {
                range.Value = "Товар";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 49, row + 1, column + 60]) {
                range.Value = "Кількість";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 61, row + 1, column + 68]) {
                range.Value = "Ціна";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 69, row + 1, column + 76]) {
                range.Value = "Сума";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            worksheet.SetRowHeight(20, row + 2);

            using (ExcelRange range = worksheet.Cells[row + 2, column, row + 2, column + 10]) {
                range.Value = "Примітка:";
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Medium;
                range.Style.Font.Italic = true;
                range.Style.Font.Size = 12;
                range.Style.Border.Right.Style = ExcelBorderStyle.Thin;
                range.Style.Font.UnderLine = true;
            }

            using (ExcelRange range = worksheet.Cells[row + 2, column + 11, row + 2, column + 76]) {
                range.Value = sale.Comment;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Medium;
                range.Style.Font.Size = 12;
            }

            row += 3;

            //Table body

            int tableRowNumber = 1;

            foreach (OrderItem item in sale.Order.OrderItems) {
                bool specialItem =
                    item.Product.IsForSale || item.Product.IsForZeroSale || item.Product.Top.ToUpper().Equals("X9") || item.Product.Top.ToUpper().Equals("Х9");

                decimal currentPrice = default;
                decimal currentTotalPrice = default;
                if (item.Qty != 0) {
                    currentPrice = decimal.Round(item.TotalAmountLocal / Convert.ToDecimal(item.Qty), 2, MidpointRounding.AwayFromZero);
                    currentTotalPrice = decimal.Round(item.TotalAmountLocal, 2, MidpointRounding.AwayFromZero);
                }


                if (specialItem) {
                    if (item.ProductLocations.Any()) {
                        foreach (ProductLocation location in item.ProductLocations) {
                            //Special OrderItem
                            using (ExcelRange range = worksheet.Cells[row, column]) {
                                range.Value = tableRowNumber;
                                range.Style.Font.Size = 9;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            //Special mark * 
                            using (ExcelRange range = worksheet.Cells[row, column + 1]) {
                                range.Value = "*";
                                range.Style.Font.Size = 22;
                                range.Style.Font.Bold = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 13]) {
                                range.Value = item.Product.VendorCode;
                                range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 16;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 14, row, column + 20]) {
                                string locationAddress =
                                    location.ProductPlacement.StorageNumber +
                                    "-" +
                                    (
                                        string.IsNullOrEmpty(location.ProductPlacement.RowNumber)
                                            ? string.Empty
                                            : $"{location.ProductPlacement.RowNumber}-"
                                    ) +
                                    location.ProductPlacement.CellNumber;

                                range.Value = locationAddress;
                                range.Style.Font.Size = 10;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 21, row, column + 48]) {
                                range.Value = item.Product.Name;
                                range.Merge = true;
                                range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                range.Style.WrapText = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                range.Value = location.Qty;
                                range.Style.Font.Size = 16;
                                range.Style.Font.Bold = true;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                range.Value = item.Product.MeasureUnit.Name;
                                range.Style.Font.Size = 11;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                //ToDo: local price
                                range.Value = currentPrice;
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                //ToDo: local price
                                range.Value = currentTotalPrice;
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            if (item.Product.Name.Length > 18) {
                                if (item.Product.Name.Length < 35)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);
                            }

                            if (item.Product.VendorCode.Length > 15)
                                worksheet.SetRowHeight(28, row);
                            else
                                worksheet.SetRowHeight(35, row);

                            row++;
                        }

                        if (item.ProductLocations.Sum(l => l.Qty) < item.Qty) {
                            //Special OrderItem
                            using (ExcelRange range = worksheet.Cells[row, column]) {
                                range.Value = tableRowNumber;
                                range.Style.Font.Size = 9;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            //Special mark * 
                            using (ExcelRange range = worksheet.Cells[row, column + 1]) {
                                range.Value = "*";
                                range.Style.Font.Size = 22;
                                range.Style.Font.Bold = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 13]) {
                                range.Value = item.Product.VendorCode;
                                range.Style.Font.Size = 16;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 14, row, column + 20]) {
                                range.Value = string.Empty;
                                range.Style.Font.Size = 10;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 21, row, column + 48]) {
                                range.Value = item.Product.Name;
                                range.Merge = true;
                                range.Style.WrapText = true;
                                range.Style.Font.Size = 11;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                range.Value = item.Qty - item.ProductLocations.Sum(l => l.Qty);
                                range.Style.Font.Size = 16;
                                range.Style.Font.Bold = true;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                range.Value = item.Product.MeasureUnit.Name;
                                range.Style.Font.Size = 11;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                //ToDo: local price
                                range.Value = currentPrice;
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                //ToDo: local price
                                range.Value = currentTotalPrice;
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            if (item.Product.Name.Length > 18) {
                                if (item.Product.Name.Length < 35)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);
                            }

                            row++;
                        }
                    } else {
                        //Special OrderItem
                        using (ExcelRange range = worksheet.Cells[row, column]) {
                            range.Value = tableRowNumber;
                            range.Style.Font.Size = 9;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        //Special mark * 
                        using (ExcelRange range = worksheet.Cells[row, column + 1]) {
                            range.Value = "*";
                            range.Style.Font.Size = 22;
                            range.Style.Font.Bold = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 13]) {
                            range.Value = item.Product.VendorCode;
                            range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 16;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 14, row, column + 20]) {
                            range.Value = string.Empty;
                            range.Style.Font.Size = 10;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 21, row, column + 48]) {
                            range.Value = item.Product.Name;
                            range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                            range.Merge = true;
                            range.Style.WrapText = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                            range.Value = item.Qty;
                            range.Style.Font.Size = 16;
                            range.Style.Font.Bold = true;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                            range.Value = item.Product.MeasureUnit.Name;
                            range.Style.Font.Size = 11;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                            //ToDo: local price
                            range.Value = currentPrice;
                            range.Style.Font.Size = 11;
                            range.Style.Numberformat.Format = "0.00";
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                            //ToDo: local price
                            range.Value = currentTotalPrice;
                            range.Style.Font.Size = 11;
                            range.Style.Numberformat.Format = "0.00";
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        if (item.Product.Name.Length > 18) {
                            if (item.Product.Name.Length < 35)
                                worksheet.SetRowHeight(28, row);
                            else
                                worksheet.SetRowHeight(35, row);
                        }

                        if (item.Product.VendorCode.Length > 15)
                            worksheet.SetRowHeight(28, row);
                        else
                            worksheet.SetRowHeight(35, row);

                        row++;
                    }
                } else {
                    if (item.ProductLocations.Any()) {
                        foreach (ProductLocation location in item.ProductLocations)
                            if (item.ProductLocations.Count.Equals(1)) {
                                //Simple  OrderItem
                                using (ExcelRange range = worksheet.Cells[row, column, row, column + 1]) {
                                    range.Value = tableRowNumber;
                                    range.Style.Font.Size = 9;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 13]) {
                                    range.Value = item.Product.VendorCode;
                                    range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 16;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 14, row, column + 20]) {
                                    string locationAddress =
                                        location.ProductPlacement.StorageNumber +
                                        "-" +
                                        (
                                            string.IsNullOrEmpty(location.ProductPlacement.RowNumber)
                                                ? string.Empty
                                                : $"{location.ProductPlacement.RowNumber}-"
                                        ) +
                                        location.ProductPlacement.CellNumber;

                                    range.Value = locationAddress;
                                    range.Style.Font.Size = 10;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 21, row, column + 48]) {
                                    range.Value = item.Product.Name;
                                    range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                    range.Merge = true;
                                    range.Style.WrapText = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                    range.Value = location.Qty;
                                    range.Style.Font.Size = 16;
                                    range.Style.Font.Bold = true;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                    range.Value = item.Product.MeasureUnit.Name;
                                    range.Style.Font.Size = 11;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                    //ToDo: local price
                                    range.Value = item.Product.CurrentLocalPrice;
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                    //ToDo: local price
                                    range.Value =
                                        decimal.Round(
                                            item.Product.CurrentLocalPrice * Convert.ToDecimal(item.Qty),
                                            2,
                                            MidpointRounding.AwayFromZero
                                        );
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                if (item.Product.Name.Length > 18) {
                                    if (item.Product.Name.Length < 35)
                                        worksheet.SetRowHeight(28, row);
                                    else
                                        worksheet.SetRowHeight(35, row);
                                }

                                if (item.Product.VendorCode.Length > 15)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);

                                row++;
                            } else {
                                //Simple  OrderItem
                                using (ExcelRange range = worksheet.Cells[row, column, row, column + 1]) {
                                    range.Value = tableRowNumber;
                                    range.Style.Font.Size = 9;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 13]) {
                                    range.Value = item.Product.VendorCode;
                                    range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 16;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 14, row, column + 20]) {
                                    string locationAddress =
                                        location.ProductPlacement.StorageNumber +
                                        "-" +
                                        (
                                            string.IsNullOrEmpty(location.ProductPlacement.RowNumber)
                                                ? string.Empty
                                                : $"{location.ProductPlacement.RowNumber}-"
                                        ) +
                                        location.ProductPlacement.CellNumber;

                                    range.Value = locationAddress;
                                    range.Style.Font.Size = 10;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 21, row, column + 48]) {
                                    range.Value = item.Product.Name;
                                    range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                    range.Merge = true;
                                    range.Style.WrapText = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                    range.Value = location.Qty;
                                    range.Style.Font.Size = 16;
                                    range.Style.Font.Bold = true;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                    range.Value = item.Product.MeasureUnit.Name;
                                    range.Style.Font.Size = 11;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                    //ToDo: local price
                                    range.Value = currentPrice;
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                    //ToDo: local price
                                    range.Value = currentTotalPrice;
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                if (item.Product.Name.Length > 18) {
                                    if (item.Product.Name.Length < 35)
                                        worksheet.SetRowHeight(28, row);
                                    else
                                        worksheet.SetRowHeight(35, row);
                                }

                                if (item.Product.VendorCode.Length > 15)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);

                                row++;
                            }

                        if (item.ProductLocations.Sum(l => l.Qty) < item.Qty) {
                            //Simple  OrderItem
                            using (ExcelRange range = worksheet.Cells[row, column, row, column + 1]) {
                                range.Value = tableRowNumber;
                                range.Style.Font.Size = 9;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 13]) {
                                range.Value = item.Product.VendorCode;
                                range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 16;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 14, row, column + 20]) {
                                range.Value = string.Empty;
                                range.Style.Font.Size = 10;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 21, row, column + 48]) {
                                range.Value = item.Product.Name;
                                range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                range.Merge = true;
                                range.Style.WrapText = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                range.Value = item.Qty - item.ProductLocations.Sum(l => l.Qty);
                                range.Style.Font.Size = 16;
                                range.Style.Font.Bold = true;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                range.Value = item.Product.MeasureUnit.Name;
                                range.Style.Font.Size = 11;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                //ToDo: local price
                                range.Value = currentPrice;
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                //ToDo: local price
                                range.Value = currentTotalPrice;
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            if (item.Product.Name.Length > 18) {
                                if (item.Product.Name.Length < 35)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);
                            }

                            if (item.Product.VendorCode.Length > 15)
                                worksheet.SetRowHeight(28, row);
                            else
                                worksheet.SetRowHeight(35, row);

                            row++;
                        }
                    } else {
                        //Simple  OrderItem
                        using (ExcelRange range = worksheet.Cells[row, column, row, column + 1]) {
                            range.Value = tableRowNumber;
                            range.Style.Font.Size = 9;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 13]) {
                            range.Value = item.Product.VendorCode;
                            range.Style.Font.Size = 16;
                            range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 16;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 14, row, column + 20]) {
                            range.Value = string.Empty;
                            range.Style.Font.Size = 10;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 21, row, column + 48]) {
                            range.Value = $"{item.Product.Name} {item.AssignedSpecification?.SpecificationCode}";
                            range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                            range.Merge = true;
                            range.Style.WrapText = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                            range.Value = item.Qty;
                            range.Style.Font.Size = 16;
                            range.Style.Font.Bold = true;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                            range.Value = item.Product.MeasureUnit.Name;
                            range.Style.Font.Size = 11;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                            //ToDo: local price
                            range.Value = currentPrice;
                            range.Style.Font.Size = 11;
                            range.Style.Numberformat.Format = "0.00";
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                            //ToDo: local price
                            range.Value = currentTotalPrice;
                            range.Style.Font.Size = 11;
                            range.Style.Numberformat.Format = "0.00";
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        if (item.Product.Name.Length > 18) {
                            if (item.Product.Name.Length < 35)
                                worksheet.SetRowHeight(28, row);
                            else
                                worksheet.SetRowHeight(35, row);
                        }

                        if (item.Product.VendorCode.Length > 15)
                            worksheet.SetRowHeight(28, row);
                        else
                            worksheet.SetRowHeight(35, row);

                        row++;
                    }
                }

                tableRowNumber++;
            }

            int tableEndRow = row - 1;

            using (ExcelRange range = worksheet.Cells[tableStartRow, column, tableEndRow, column + 76]) {
                range.Style.Border.BorderAround(ExcelBorderStyle.Medium);
            }

            worksheet.SetRowHeight(6.95, row);
            worksheet.SetRowHeight(15, ++row);

            using (ExcelRange range = worksheet.Cells[row, column, row, column + 12]) {
                range.Value = DateTime.Now.ToString("dd.MM.yyyy HH:mm:ss");
                range.Style.Font.Size = 6;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 60, row, column + 66]) {
                range.Value = "Разом:";
                range.Style.Font.Size = 10;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            decimal totalAmount = sale.Order.OrderItems.Sum(x => x.TotalAmountLocal);

            using (ExcelRange range = worksheet.Cells[row, column + 68, row, column + 75]) {
                range.Value = decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero);
                range.Style.Font.Size = 11;
                range.Style.Numberformat.Format = "0.00";
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            worksheet.SetRowHeight(6.95, ++row);
            worksheet.SetRowHeight(11.25, ++row);

            if (sale.ClientAgreement.Agreement.Currency.Code.ToLower().Equals("eur")) {
                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero)} EUR.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheet.SetRowHeight(12.75, ++row);

                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                    int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                    string endKeyWord;

                    if (fullNumber > 10 && fullNumber < 20)
                        endKeyWord = "центів";
                    else
                        switch (endNumber) {
                            case 1:
                                endKeyWord = "цент";
                                break;
                            case 2:
                            case 3:
                            case 4:
                                endKeyWord = "цента";
                                break;
                            default:
                                endKeyWord = "центів";
                                break;
                        }

                    range.Value =
                        $"{totalAmount.ToText(true, true)} євро {(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100).ToText(false, true)} {endKeyWord}";
                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            } else if (sale.ClientAgreement.Agreement.Currency.Code.ToLower().Equals("usd")) {
                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero)} USD.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheet.SetRowHeight(12.75, ++row);

                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                    int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                    string endKeyWord;

                    if (fullNumber > 10 && fullNumber < 20)
                        endKeyWord = "центів";
                    else
                        switch (endNumber) {
                            case 1:
                                endKeyWord = "цент";
                                break;
                            case 2:
                            case 3:
                            case 4:
                                endKeyWord = "цента";
                                break;
                            default:
                                endKeyWord = "центів";
                                break;
                        }

                    range.Value =
                        $"{decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero).ToText(true, true)} доларів {(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100).ToText(false, true)} {endKeyWord}";
                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            } else if (sale.ClientAgreement.Agreement.Currency.Code.ToLower().Equals("pln")) {
                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero)} PLN.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheet.SetRowHeight(12.75, ++row);

                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                    int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                    string endKeyWord;

                    if (fullNumber > 10 && fullNumber < 20)
                        endKeyWord = "грошів";
                    else
                        switch (endNumber) {
                            case 1:
                                endKeyWord = "грош";
                                break;
                            case 2:
                            case 3:
                            case 4:
                                endKeyWord = "гроша";
                                break;
                            default:
                                endKeyWord = "грошів";
                                break;
                        }

                    range.Value =
                        $"{decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero).ToText(true, true)} злотих {(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100).ToText(false, true)} {endKeyWord}";
                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            } else {
                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero)} ГРН.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheet.SetRowHeight(12.75, ++row);

                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                    int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                    string endKeyWord;

                    if (fullNumber > 10 && fullNumber < 20)
                        endKeyWord = "копійок";
                    else
                        switch (endNumber) {
                            case 1:
                                endKeyWord = "копійка";
                                break;
                            case 2:
                            case 3:
                            case 4:
                                endKeyWord = "копійки";
                                break;
                            default:
                                endKeyWord = "копійок";
                                break;
                        }

                    range.Value =
                        $"{decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero).ToText(true, true)} гривень {(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100).ToText(false, true)} {endKeyWord}";
                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            }

            worksheet.SetRowHeight(6.95, ++row);
            using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Medium;
            }

            row++;

            worksheet.SetRowHeight(12.75, ++row);

            using (ExcelRange range = worksheet.Cells[row, column, row, column + 5]) {
                range.Value = "Відвантажив(ла): ";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 7, row, column + 29]) {
                range.Merge = true;
                range.Value = "директор " + sale.ClientAgreement.Agreement.Organization.Manager;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            using (ExcelRange range = worksheet.Cells[row + 1, column + 7, row + 1, column + 29]) {
                range.Style.Border.Top.Style = ExcelBorderStyle.Thin;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 36, row, column + 51]) {
                range.Value = "Отримав(ла):";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 52, row, column + 73]) {
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Thin;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            row++;
            worksheet.SetRowHeight(6.95, ++row);
            worksheet.SetRowHeight(12.75, ++row);

            using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                range.Value = $"Термін оплати до {DateTime.Now.AddDays(sale.ClientAgreement.Agreement.NumberDaysDebt).ToString("dd.MM.yyyy")}";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Style.Font.UnderLine = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            worksheet.SetRowHeight(6.95, ++row);

            //Remark
            worksheet.SetRowHeight(10, ++row);

            row++;
            worksheet.SetRowHeight(12.75, ++row);

            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 75]) {
                range.Value = "Вимоги до повернень";
                range.Style.Font.Size = 10;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            }

            row++;
            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 75]) {
                range.Value = "1)Товар має бути запакований";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            row++;
            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 75]) {
                range.Value = "2)Коробка даного товару і сам товар мають бути без пошкоджень";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            row++;
            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 75]) {
                range.Value = "3)Повинні бути документи на повернення: від кого і причина повернення в письмовому вигляді";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            row++;
            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 75]) {
                range.Value = "4)Товар не буде прийматися, якщо вказане не буде виконано, і в цьому випадку товар буде відправлено назад покупцеві.";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            package.Save();
        }

        return SaveFiles(fileName);
    }

    public (string xlsxFile, string pdfFile) ExportUkInvoiceFromStorageToXlsx(string path, Sale sale, IEnumerable<DocumentMonth> months) {
        string fileName = Path.Combine(path, $"{sale.SaleInvoiceNumber.Number}_{DateTime.Now.ToString("MM.yyyy")}_{Guid.NewGuid().ToString()}.xlsx");

        DateTime current = DateTime.Now;

        using (ExcelPackage package = NewExcelPackage(fileName)) {
            ExcelWorksheet worksheet = package.Workbook.Worksheets.Add("Накладна");

            worksheet.ApplyPrinterSettings(0.5m, 0.5m, 0.1m, 0.1m, 0.25m, 0.25m, true);

            worksheet.Cells.Style.Font.Name = "Arial";
            worksheet.Cells.Style.Font.Size = 8;
            worksheet.DefaultColWidth = 9.83;
            worksheet.DefaultRowHeight = 11.25;

            //Set Rows
            worksheet.SetRowHeight(3.75, new[] { 1, 4, 5, 6 });
            worksheet.SetRowHeight(3.95, new[] { 11, 14, 17 });
            worksheet.SetRowHeight(12.75, new[] { 9, 10, 12, 13, 15, 16 });
            worksheet.SetRowHeight(31, new[] { 7, 3 });
            worksheet.SetRowHeight(45, new[] { 2 });

            //Set Columns
            worksheet.SetColumnWidth(0.83, new[] { 1, 34, 37 });
            worksheet.SetColumnWidth(2.33, new[] { 3, 9, 11, 13, 15 });
            worksheet.SetColumnWidth(3, new[] { 8, 10 });
            worksheet.SetColumnWidth(2.5, new[] { 12, 67 });
            worksheet.SetColumnWidth(0.66, new[] { 16, 28, 31 });
            worksheet.SetColumnWidth(0.33, new[] { 18, 23, 58, 60, 62, 64, 66, 68, 70, 72, 74, 76, 78 });
            worksheet.SetColumnWidth(0.5, new[] { 20, 22, 43 });
            worksheet.SetColumnWidth(0.16, new[] { 24, 27, 30, 33, 36, 39, 42, 45, 48 });
            worksheet.SetColumnWidth(1, new[] { 25, 57, 35, 41, 44, 47, 50, 51 });
            worksheet.SetColumnWidth(1.5, new[] { 26, 29, 32, 38, 41, 52, 54, 576, 61 });
            worksheet.SetColumnWidth(1.33, new[] { 40, 55 });
            worksheet.SetColumnWidth(1.83, new[] { 46, 71, 77 });
            worksheet.SetColumnWidth(2.16, new[] { 49, 59 });
            worksheet.SetColumnWidth(2, new[] { 14, 17, 21, 53, 56, 63, 65 });
            worksheet.SetColumnWidth(3, new[] { 69, 73, 75 });
            worksheet.SetColumnWidth(2.42, 19);
            worksheet.SetColumnWidth(2.75, 4);
            worksheet.SetColumnWidth(3, 5);
            worksheet.SetColumnWidth(3, 6);
            worksheet.SetColumnWidth(3.5, 7);
            worksheet.SetColumnWidth(2.9, 2);

            int row = 2;
            int column = 2;

            //Document header
            using (ExcelRange range = worksheet.Cells[row, column, row, column + 10]) {
                range.Merge = true;
                range.Value = "Перевізник:";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.UnderLine = true;
                range.Style.Font.Size = 14;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 11, row, column + 75]) {
                range.Merge = true;
                string value = sale.Transporter.Name;

                if (!string.IsNullOrEmpty(sale.DeliveryRecipientAddress.City))
                    value += ", " + sale.DeliveryRecipientAddress.City;
                if (!string.IsNullOrEmpty(sale.DeliveryRecipientAddress.Value))
                    value += ", " + sale.DeliveryRecipientAddress.Value;
                if (!string.IsNullOrEmpty(sale.DeliveryRecipientAddress.Department))
                    value += ", " + sale.DeliveryRecipientAddress.Department;
                if (!string.IsNullOrEmpty(sale.DeliveryRecipient.FullName))
                    value += ", " + sale.DeliveryRecipient.FullName;
                if (!string.IsNullOrEmpty(sale.DeliveryRecipient.MobilePhone))
                    value += ", " + sale.DeliveryRecipient.MobilePhone;

                range.Value = value;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Bold = true;

                if (value.Length < 50)
                    range.Style.Font.Size = 14;
                else
                    range.Style.Font.Size = 10;
                range.Style.WrapText = true;
                range.Merge = true;
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column, row, column + 6]) {
                range.Value = "Примітка:";
                range.Merge = true;
                range.Style.Font.UnderLine = true;
                range.Style.Font.Size = 14;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 7, row, column + 75]) {
                string value = string.Empty;

                if (sale.IsCashOnDelivery) value += $" накладний платіж: {decimal.Round(sale.CashOnDeliveryAmount, 2, MidpointRounding.AwayFromZero)}. ";

                if (sale.CustomersOwnTtn != null) value += $" власне ТТН: {sale.CustomersOwnTtn.Number}. ";
                if (!string.IsNullOrEmpty(sale.Comment)) value += $" коментар: {sale.Comment}. ";

                range.Value = value;
                range.Merge = true;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 10;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column - 1, row, column + 75]) {
                range.Style.Border.Bottom.Style = ExcelBorderStyle.MediumDashed;
            }

            row += 3;

            using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                range.Merge = true;
                range.Value =
                    string.Format(
                        "Видаткова накладна № {0} від {1} р.",
                        sale.SaleNumber.Value,
                        $"{sale.ChangedToInvoice.Value.Day}   {months.FirstOrDefault(m => m.Number.Equals(sale.ChangedToInvoice.Value.Month))?.Name.ToLower() ?? string.Empty}   {sale.ChangedToInvoice.Value.Year}"
                    );
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Medium;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 14;
            }

            row += 2;

            using (ExcelRange range = worksheet.Cells[row, column, row, column + 4]) {
                range.Merge = true;
                range.Value = "Постачальник:";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.UnderLine = true;
                range.Style.Font.Size = 9;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 6, row, column + 75]) {
                range.Merge = true;
                range.Value = sale.ClientAgreement.Agreement.Organization.Name;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 11;
                range.Style.WrapText = true;
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column + 7, row, column + 75]) {
                range.Merge = true;
                string val = string.Empty;

                switch (sale.ClientAgreement.Agreement.Organization.TypeTaxation) {
                    case TypeTaxation.SingleTax:
                        val = "Є платником єдиного податку";
                        break;
                    case TypeTaxation.SingleTaxAndVat:
                        val = "Є платником єдиного податку та ПДВ";
                        break;
                    case TypeTaxation.IncomeTax:
                        val = "Є платником податку на прибуток";
                        break;
                    case TypeTaxation.IncomeTaxAndVat:
                        val = "Є платником податку на прибуток на загальних підставах";
                        break;
                    case TypeTaxation.NotPaying:
                        val = "Не є платником податку на прибуток на загальних підставах";
                        break;
                }

                range.Value = val;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
            }

            row += 2;
            using (ExcelRange range = worksheet.Cells[row, column, row, column + 4]) {
                range.Merge = true;
                range.Value = "Покупець:";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.UnderLine = true;
                range.Style.Font.Size = 9;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 6, row, column + 75]) {
                range.Merge = true;
                range.Value =
                    string.Format(
                        "{0} ", //- {1}
                        !string.IsNullOrEmpty(sale.ClientAgreement.Client.FullName) ? sale.ClientAgreement.Client.FullName : sale.ClientAgreement.Client.Name
                        //, sale.ClientAgreement.Client.RegionCode?.Value ?? ""
                    );
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 11;
                range.Style.WrapText = true;
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column + 7, row, column + 75]) {
                string clientInfo = string.Empty;

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.RegionCode?.City)) clientInfo += $"{sale.ClientAgreement.Client.RegionCode.City}, ";

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.RegionCode?.District)) clientInfo += $"{sale.ClientAgreement.Client.RegionCode.District}, ";

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.ActualAddress)) clientInfo += $"{sale.ClientAgreement.Client.ActualAddress}, ";

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.MobileNumber) && sale.RetailClientId.HasValue)
                    clientInfo += $"тел.: {sale.ClientAgreement.Client.MobileNumber}";
                range.Style.WrapText = true;
                range.Merge = true;
                range.Value = clientInfo;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 11;

                if (string.IsNullOrEmpty(clientInfo))
                    worksheet.SetRowHeight(1, row);

                if (clientInfo.Length > 80)
                    worksheet.SetRowHeight(24, row);
            }

            row += 2;

            if (sale.ClientAgreement.Agreement.WithVATAccounting) {
                using ExcelRange range = worksheet.Cells[row, column, row, column + 75];
                range.Merge = true;
                range.Value = "Видаткова накладна є підставою для оплати";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 10;
            }

            row += 2;
            //Table header
            row += 2;

            int tableStartRow = row;

            using (ExcelRange range = worksheet.Cells[row, column, row + 1, column + 1]) {
                range.Value = "№";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 2, row + 1, column + 13]) {
                range.Value = "Артикул";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 14, row + 1, column + 20]) {
                range.Value = "Розм.";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 21, row + 1, column + 48]) {
                range.Value = "Товар";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 49, row + 1, column + 60]) {
                range.Value = "Кількість";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 61, row + 1, column + 68]) {
                range.Value = "Ціна";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 69, row + 1, column + 76]) {
                range.Value = "Сума";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            worksheet.SetRowHeight(20, row + 2);

            using (ExcelRange range = worksheet.Cells[row + 2, column, row + 2, column + 10]) {
                range.Value = "Примітка:";
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Medium;
                range.Style.Font.Italic = true;
                range.Style.Font.Size = 12;
                range.Style.Border.Right.Style = ExcelBorderStyle.Thin;
                range.Style.Font.UnderLine = true;
            }

            using (ExcelRange range = worksheet.Cells[row + 2, column + 11, row + 2, column + 76]) {
                range.Value = sale.Comment;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Medium;
                range.Style.Font.Size = 12;
            }

            row += 3;

            //Table body

            int tableRowNumber = 1;

            foreach (OrderItem item in sale.Order.OrderItems) {
                bool specialItem =
                    item.Product.IsForSale || item.Product.IsForZeroSale || item.Product.Top.ToUpper().Equals("X9") || item.Product.Top.ToUpper().Equals("Х9");
                decimal currentPrice = 0;
                decimal currentTotalPrice = 0;
                if (item.Qty != 0) {
                    currentPrice = decimal.Round(item.TotalAmountLocal / Convert.ToDecimal(item.Qty), 2, MidpointRounding.AwayFromZero);
                    currentTotalPrice = decimal.Round(item.TotalAmountLocal, 2, MidpointRounding.AwayFromZero);
                }

                if (specialItem) {
                    if (item.ProductLocations.Any() || item.ProductLocationsHistory.Any()) {
                        foreach (ProductLocation location in item.ProductLocations) {
                            foreach (ProductLocationHistory locationHistory in item.ProductLocationsHistory.Where(x => x.TypeOfMovement == TypeOfMovement.Return))
                                if (location.ProductPlacementId == locationHistory.ProductPlacementId) {
                                    location.Qty += locationHistory.Qty;
                                    locationHistory.Qty = 0;
                                }

                            //Special OrderItem
                            using (ExcelRange range = worksheet.Cells[row, column]) {
                                range.Value = tableRowNumber;
                                range.Style.Font.Size = 9;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            //Special mark * 
                            using (ExcelRange range = worksheet.Cells[row, column + 1]) {
                                range.Value = "*";
                                range.Style.Font.Size = 22;
                                range.Style.Font.Bold = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 13]) {
                                range.Value = item.Product.VendorCode;
                                range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 16;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 14, row, column + 20]) {
                                string locationAddress =
                                    location.ProductPlacement.StorageNumber +
                                    "-" +
                                    (
                                        string.IsNullOrEmpty(location.ProductPlacement.RowNumber)
                                            ? string.Empty
                                            : $"{location.ProductPlacement.RowNumber}-"
                                    ) +
                                    location.ProductPlacement.CellNumber;

                                range.Value = locationAddress;
                                range.Style.Font.Size = 10;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 21, row, column + 48]) {
                                range.Value = item.Product.Name;
                                range.Merge = true;
                                range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                range.Style.WrapText = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                range.Value = location.Qty;
                                range.Style.Font.Size = 16;
                                range.Style.Font.Bold = true;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                range.Value = item.Product.MeasureUnit.Name;
                                range.Style.Font.Size = 11;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                //ToDo: local price
                                range.Value = currentPrice;
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                //ToDo: local price
                                range.Value = decimal.Round(currentPrice * Convert.ToDecimal(location.Qty), 2, MidpointRounding.AwayFromZero);
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            if (item.Product.Name.Length > 18) {
                                if (item.Product.Name.Length < 35)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);
                            }

                            if (item.Product.VendorCode.Length > 15)
                                worksheet.SetRowHeight(28, row);
                            else
                                worksheet.SetRowHeight(35, row);

                            row++;
                        }

                        if (item.ProductLocationsHistory.Any())
                            foreach (ProductLocationHistory location in item.ProductLocationsHistory.Where(x => x.Qty != 0)) {
                                //Special OrderItem
                                using (ExcelRange range = worksheet.Cells[row, column]) {
                                    range.Value = tableRowNumber;
                                    range.Style.Font.Size = 9;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                //Special mark * 
                                using (ExcelRange range = worksheet.Cells[row, column + 1]) {
                                    range.Value = "*";
                                    range.Style.Font.Size = 22;
                                    range.Style.Font.Bold = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 13]) {
                                    range.Value = item.Product.VendorCode;
                                    range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 16;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 14, row, column + 20]) {
                                    string locationAddress =
                                        location.ProductPlacement.StorageNumber +
                                        "-" +
                                        (
                                            string.IsNullOrEmpty(location.ProductPlacement.RowNumber)
                                                ? string.Empty
                                                : $"{location.ProductPlacement.RowNumber}-"
                                        ) +
                                        location.ProductPlacement.CellNumber;

                                    range.Value = locationAddress;
                                    range.Style.Font.Size = 10;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 21, row, column + 48]) {
                                    range.Value = item.Product.Name;
                                    range.Merge = true;
                                    range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                    range.Style.WrapText = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                    range.Value = location.Qty;
                                    range.Style.Font.Size = 16;
                                    range.Style.Font.Bold = true;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                    range.Value = item.Product.MeasureUnit.Name;
                                    range.Style.Font.Size = 11;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                    //ToDo: local price
                                    range.Value = currentPrice;
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                    //ToDo: local price
                                    range.Value = decimal.Round(currentPrice * Convert.ToDecimal(location.Qty), 2, MidpointRounding.AwayFromZero);
                                    ;
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                if (item.Product.Name.Length > 18) {
                                    if (item.Product.Name.Length < 35)
                                        worksheet.SetRowHeight(28, row);
                                    else
                                        worksheet.SetRowHeight(35, row);
                                }

                                if (item.Product.VendorCode.Length > 15)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);

                                row++;
                            }

                        if (item.ProductLocations.Sum(l => l.Qty) + item.ProductLocationsHistory.Sum(g => g.Qty) < item.Qty) {
                            //Special OrderItem
                            using (ExcelRange range = worksheet.Cells[row, column]) {
                                range.Value = tableRowNumber;
                                range.Style.Font.Size = 9;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            //Special mark * 
                            using (ExcelRange range = worksheet.Cells[row, column + 1]) {
                                range.Value = "*";
                                range.Style.Font.Size = 22;
                                range.Style.Font.Bold = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 13]) {
                                range.Value = item.Product.VendorCode;
                                range.Style.Font.Size = 16;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 14, row, column + 20]) {
                                range.Value = string.Empty;
                                range.Style.Font.Size = 10;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 21, row, column + 48]) {
                                range.Value = item.Product.Name;
                                range.Merge = true;
                                range.Style.WrapText = true;
                                range.Style.Font.Size = 11;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            double totalQty = item.Qty - (item.ProductLocations.Sum(l => l.Qty) + item.ProductLocationsHistory.Sum(g => g.Qty));
                            using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                range.Value = totalQty;
                                range.Style.Font.Size = 16;
                                range.Style.Font.Bold = true;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                range.Value = item.Product.MeasureUnit.Name;
                                range.Style.Font.Size = 11;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                //ToDo: local price
                                range.Value = currentPrice;
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                //ToDo: local price
                                range.Value = decimal.Round(currentPrice * Convert.ToDecimal(totalQty), 2, MidpointRounding.AwayFromZero);
                                ;
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            if (item.Product.Name.Length > 18) {
                                if (item.Product.Name.Length < 35)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);
                            }

                            row++;
                        }
                    } else {
                        //Special OrderItem
                        using (ExcelRange range = worksheet.Cells[row, column]) {
                            range.Value = tableRowNumber;
                            range.Style.Font.Size = 9;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        //Special mark * 
                        using (ExcelRange range = worksheet.Cells[row, column + 1]) {
                            range.Value = "*";
                            range.Style.Font.Size = 22;
                            range.Style.Font.Bold = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 13]) {
                            range.Value = item.Product.VendorCode;
                            range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 16;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 14, row, column + 20]) {
                            range.Value = string.Empty;
                            range.Style.Font.Size = 10;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 21, row, column + 48]) {
                            range.Value = item.Product.Name;
                            range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                            range.Merge = true;
                            range.Style.WrapText = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                            range.Value = item.Qty;
                            range.Style.Font.Size = 16;
                            range.Style.Font.Bold = true;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                            range.Value = item.Product.MeasureUnit.Name;
                            range.Style.Font.Size = 11;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                            //ToDo: local price
                            range.Value = currentPrice;
                            range.Style.Font.Size = 11;
                            range.Style.Numberformat.Format = "0.00";
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                            //ToDo: local price
                            range.Value = currentTotalPrice;
                            range.Style.Font.Size = 11;
                            range.Style.Numberformat.Format = "0.00";
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        if (item.Product.Name.Length > 18) {
                            if (item.Product.Name.Length < 35)
                                worksheet.SetRowHeight(28, row);
                            else
                                worksheet.SetRowHeight(35, row);
                        }

                        if (item.Product.VendorCode.Length > 15)
                            worksheet.SetRowHeight(28, row);
                        else
                            worksheet.SetRowHeight(35, row);

                        row++;
                    }
                } else {
                    if (item.ProductLocations.Any() || item.ProductLocationsHistory.Any()) {
                        foreach (ProductLocation location in item.ProductLocations) {
                            foreach (ProductLocationHistory locationHistory in item.ProductLocationsHistory.Where(x => x.TypeOfMovement == TypeOfMovement.Return))
                                if (location.ProductPlacementId == locationHistory.ProductPlacementId) {
                                    location.Qty += locationHistory.Qty;
                                    locationHistory.Qty = 0;
                                }

                            if (item.ProductLocations.Count.Equals(1) && item.ProductLocationsHistory.Count.Equals(0)) {
                                //Simple  OrderItem
                                using (ExcelRange range = worksheet.Cells[row, column, row, column + 1]) {
                                    range.Value = tableRowNumber;
                                    range.Style.Font.Size = 9;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 13]) {
                                    range.Value = item.Product.VendorCode;
                                    range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 16;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 14, row, column + 20]) {
                                    string locationAddress =
                                        location.ProductPlacement.StorageNumber +
                                        "-" +
                                        (
                                            string.IsNullOrEmpty(location.ProductPlacement.RowNumber)
                                                ? string.Empty
                                                : $"{location.ProductPlacement.RowNumber}-"
                                        ) +
                                        location.ProductPlacement.CellNumber;

                                    range.Value = locationAddress;
                                    range.Style.Font.Size = 10;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 21, row, column + 48]) {
                                    range.Value = item.Product.Name;
                                    range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                    range.Merge = true;
                                    range.Style.WrapText = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                    range.Value = location.Qty;
                                    range.Style.Font.Size = 16;
                                    range.Style.Font.Bold = true;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                    range.Value = item.Product.MeasureUnit.Name;
                                    range.Style.Font.Size = 11;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                    //ToDo: local price
                                    range.Value = item.Product.CurrentLocalPrice;
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                    //ToDo: local price
                                    range.Value =
                                        decimal.Round(
                                            item.Product.CurrentLocalPrice * Convert.ToDecimal(location.Qty),
                                            2,
                                            MidpointRounding.AwayFromZero
                                        );
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                if (item.Product.Name.Length > 18) {
                                    if (item.Product.Name.Length < 35)
                                        worksheet.SetRowHeight(28, row);
                                    else
                                        worksheet.SetRowHeight(35, row);
                                }

                                if (item.Product.VendorCode.Length > 15)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);

                                row++;
                            } else {
                                //Simple  OrderItem
                                using (ExcelRange range = worksheet.Cells[row, column, row, column + 1]) {
                                    range.Value = tableRowNumber;
                                    range.Style.Font.Size = 9;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 13]) {
                                    range.Value = item.Product.VendorCode;
                                    range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 16;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 14, row, column + 20]) {
                                    string locationAddress =
                                        location.ProductPlacement.StorageNumber +
                                        "-" +
                                        (
                                            string.IsNullOrEmpty(location.ProductPlacement.RowNumber)
                                                ? string.Empty
                                                : $"{location.ProductPlacement.RowNumber}-"
                                        ) +
                                        location.ProductPlacement.CellNumber;

                                    range.Value = locationAddress;
                                    range.Style.Font.Size = 10;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 21, row, column + 48]) {
                                    range.Value = item.Product.Name;
                                    range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                    range.Merge = true;
                                    range.Style.WrapText = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                    range.Value = location.Qty;
                                    range.Style.Font.Size = 16;
                                    range.Style.Font.Bold = true;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                    range.Value = item.Product.MeasureUnit.Name;
                                    range.Style.Font.Size = 11;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                    //ToDo: local price
                                    range.Value = currentPrice;
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                    //ToDo: local price
                                    range.Value = decimal.Round(currentPrice * Convert.ToDecimal(location.Qty), 2, MidpointRounding.AwayFromZero);
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                if (item.Product.Name.Length > 18) {
                                    if (item.Product.Name.Length < 35)
                                        worksheet.SetRowHeight(28, row);
                                    else
                                        worksheet.SetRowHeight(35, row);
                                }

                                if (item.Product.VendorCode.Length > 15)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);

                                row++;
                            }
                        }

                        if (item.ProductLocationsHistory.Any())
                            foreach (ProductLocationHistory location in item.ProductLocationsHistory.Where(x => x.Qty != 0)) {
                                //Special OrderItem
                                using (ExcelRange range = worksheet.Cells[row, column]) {
                                    range.Value = tableRowNumber;
                                    range.Style.Font.Size = 9;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                //Special mark * 
                                using (ExcelRange range = worksheet.Cells[row, column + 1]) {
                                    range.Value = "*";
                                    range.Style.Font.Size = 22;
                                    range.Style.Font.Bold = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 13]) {
                                    range.Value = item.Product.VendorCode;
                                    range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 16;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 14, row, column + 20]) {
                                    string locationAddress =
                                        location.ProductPlacement.StorageNumber +
                                        "-" +
                                        (
                                            string.IsNullOrEmpty(location.ProductPlacement.RowNumber)
                                                ? string.Empty
                                                : $"{location.ProductPlacement.RowNumber}-"
                                        ) +
                                        location.ProductPlacement.CellNumber;

                                    range.Value = locationAddress;
                                    range.Style.Font.Size = 10;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 21, row, column + 48]) {
                                    range.Value = item.Product.Name;
                                    range.Merge = true;
                                    range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                    range.Style.WrapText = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                    range.Value = location.Qty;
                                    range.Style.Font.Size = 16;
                                    range.Style.Font.Bold = true;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                    range.Value = item.Product.MeasureUnit.Name;
                                    range.Style.Font.Size = 11;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                    //ToDo: local price
                                    range.Value = currentPrice;
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                    //ToDo: local price
                                    range.Value = decimal.Round(currentPrice * Convert.ToDecimal(location.Qty), 2, MidpointRounding.AwayFromZero);
                                    ;
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                if (item.Product.Name.Length > 18) {
                                    if (item.Product.Name.Length < 35)
                                        worksheet.SetRowHeight(28, row);
                                    else
                                        worksheet.SetRowHeight(35, row);
                                }

                                if (item.Product.VendorCode.Length > 15)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);

                                row++;
                            }

                        if (item.ProductLocations.Sum(l => l.Qty) + item.ProductLocationsHistory.Sum(g => g.Qty) < item.Qty) {
                            //Simple  OrderItem
                            using (ExcelRange range = worksheet.Cells[row, column, row, column + 1]) {
                                range.Value = tableRowNumber;
                                range.Style.Font.Size = 9;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 13]) {
                                range.Value = item.Product.VendorCode;
                                range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 16;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 14, row, column + 20]) {
                                range.Value = string.Empty;
                                range.Style.Font.Size = 10;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 21, row, column + 48]) {
                                range.Value = item.Product.Name;
                                range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                range.Merge = true;
                                range.Style.WrapText = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            double totalQty = item.Qty - (item.ProductLocations.Sum(l => l.Qty) + item.ProductLocationsHistory.Sum(g => g.Qty));
                            using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                range.Value = totalQty;
                                range.Style.Font.Size = 16;
                                range.Style.Font.Bold = true;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                range.Value = item.Product.MeasureUnit.Name;
                                range.Style.Font.Size = 11;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                //ToDo: local price
                                range.Value = currentPrice;
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                //ToDo: local price
                                range.Value = decimal.Round(currentPrice * Convert.ToDecimal(totalQty), 2, MidpointRounding.AwayFromZero);
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            if (item.Product.Name.Length > 18) {
                                if (item.Product.Name.Length < 35)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);
                            }

                            if (item.Product.VendorCode.Length > 15)
                                worksheet.SetRowHeight(28, row);
                            else
                                worksheet.SetRowHeight(35, row);

                            row++;
                        }
                    } else {
                        //Simple  OrderItem
                        using (ExcelRange range = worksheet.Cells[row, column, row, column + 1]) {
                            range.Value = tableRowNumber;
                            range.Style.Font.Size = 9;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 13]) {
                            range.Value = item.Product.VendorCode;
                            range.Style.Font.Size = 16;
                            range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 16;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 14, row, column + 20]) {
                            range.Value = string.Empty;
                            range.Style.Font.Size = 10;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 21, row, column + 48]) {
                            range.Value = $"{item.Product.Name} {item.AssignedSpecification?.SpecificationCode}";
                            range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                            range.Merge = true;
                            range.Style.WrapText = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                            range.Value = item.Qty;
                            range.Style.Font.Size = 16;
                            range.Style.Font.Bold = true;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                            range.Value = item.Product.MeasureUnit.Name;
                            range.Style.Font.Size = 11;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                            //ToDo: local price
                            range.Value = currentPrice;
                            range.Style.Font.Size = 11;
                            range.Style.Numberformat.Format = "0.00";
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                            //ToDo: local price
                            range.Value = currentTotalPrice;
                            range.Style.Font.Size = 11;
                            range.Style.Numberformat.Format = "0.00";
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        if (item.Product.Name.Length > 18) {
                            if (item.Product.Name.Length < 35)
                                worksheet.SetRowHeight(28, row);
                            else
                                worksheet.SetRowHeight(35, row);
                        }

                        if (item.Product.VendorCode.Length > 15)
                            worksheet.SetRowHeight(28, row);
                        else
                            worksheet.SetRowHeight(35, row);

                        row++;
                    }
                }

                tableRowNumber++;
            }

            int tableEndRow = row - 1;

            using (ExcelRange range = worksheet.Cells[tableStartRow, column, tableEndRow, column + 76]) {
                range.Style.Border.BorderAround(ExcelBorderStyle.Medium);
            }

            worksheet.SetRowHeight(6.95, row);
            worksheet.SetRowHeight(15, ++row);

            using (ExcelRange range = worksheet.Cells[row, column, row, column + 12]) {
                range.Value = DateTime.Now.ToString("dd.MM.yyyy HH:mm:ss");
                range.Style.Font.Size = 6;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 60, row, column + 66]) {
                range.Value = "Разом:";
                range.Style.Font.Size = 10;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            decimal totalAmount = sale.Order.OrderItems.Sum(x => x.TotalAmountLocal);

            using (ExcelRange range = worksheet.Cells[row, column + 68, row, column + 75]) {
                range.Value = decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero);
                range.Style.Font.Size = 11;
                range.Style.Numberformat.Format = "0.00";
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            worksheet.SetRowHeight(6.95, ++row);
            worksheet.SetRowHeight(11.25, ++row);

            if (sale.ClientAgreement.Agreement.Currency.Code.ToLower().Equals("eur")) {
                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero)} EUR.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheet.SetRowHeight(12.75, ++row);

                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                    int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                    string endKeyWord;

                    if (fullNumber > 10 && fullNumber < 20)
                        endKeyWord = "центів";
                    else
                        switch (endNumber) {
                            case 1:
                                endKeyWord = "цент";
                                break;
                            case 2:
                            case 3:
                            case 4:
                                endKeyWord = "цента";
                                break;
                            default:
                                endKeyWord = "центів";
                                break;
                        }

                    range.Value =
                        $"{totalAmount.ToText(true, true)} євро {(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100).ToText(false, true)} {endKeyWord}";
                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            } else if (sale.ClientAgreement.Agreement.Currency.Code.ToLower().Equals("usd")) {
                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero)} USD.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheet.SetRowHeight(12.75, ++row);

                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                    int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                    string endKeyWord;

                    if (fullNumber > 10 && fullNumber < 20)
                        endKeyWord = "центів";
                    else
                        switch (endNumber) {
                            case 1:
                                endKeyWord = "цент";
                                break;
                            case 2:
                            case 3:
                            case 4:
                                endKeyWord = "цента";
                                break;
                            default:
                                endKeyWord = "центів";
                                break;
                        }

                    range.Value =
                        $"{decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero).ToText(true, true)} доларів {(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100).ToText(false, true)} {endKeyWord}";
                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            } else if (sale.ClientAgreement.Agreement.Currency.Code.ToLower().Equals("pln")) {
                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero)} PLN.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheet.SetRowHeight(12.75, ++row);

                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                    int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                    string endKeyWord;

                    if (fullNumber > 10 && fullNumber < 20)
                        endKeyWord = "грошів";
                    else
                        switch (endNumber) {
                            case 1:
                                endKeyWord = "грош";
                                break;
                            case 2:
                            case 3:
                            case 4:
                                endKeyWord = "гроша";
                                break;
                            default:
                                endKeyWord = "грошів";
                                break;
                        }

                    range.Value =
                        $"{decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero).ToText(true, true)} злотих {(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100).ToText(false, true)} {endKeyWord}";
                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            } else {
                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero)} ГРН.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheet.SetRowHeight(12.75, ++row);

                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                    int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                    string endKeyWord;

                    if (fullNumber > 10 && fullNumber < 20)
                        endKeyWord = "копійок";
                    else
                        switch (endNumber) {
                            case 1:
                                endKeyWord = "копійка";
                                break;
                            case 2:
                            case 3:
                            case 4:
                                endKeyWord = "копійки";
                                break;
                            default:
                                endKeyWord = "копійок";
                                break;
                        }

                    range.Value =
                        $"{decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero).ToText(true, true)} гривень {(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100).ToText(false, true)} {endKeyWord}";
                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            }

            worksheet.SetRowHeight(6.95, ++row);
            using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Medium;
            }

            row++;

            worksheet.SetRowHeight(12.75, ++row);

            using (ExcelRange range = worksheet.Cells[row, column, row, column + 5]) {
                range.Value = "Відвантажив(ла): ";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 7, row, column + 29]) {
                range.Merge = true;
                range.Value = "директор " + sale.ClientAgreement.Agreement.Organization.Manager;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            using (ExcelRange range = worksheet.Cells[row + 1, column + 7, row + 1, column + 29]) {
                range.Style.Border.Top.Style = ExcelBorderStyle.Thin;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 36, row, column + 51]) {
                range.Value = "Отримав(ла):";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 52, row, column + 73]) {
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Thin;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            row++;
            worksheet.SetRowHeight(6.95, ++row);
            worksheet.SetRowHeight(12.75, ++row);

            using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                range.Value = $"Термін оплати до {DateTime.Now.AddDays(sale.ClientAgreement.Agreement.NumberDaysDebt).ToString("dd.MM.yyyy")}";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Style.Font.UnderLine = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            worksheet.SetRowHeight(6.95, ++row);

            //Remark
            worksheet.SetRowHeight(10, ++row);

            row++;
            worksheet.SetRowHeight(12.75, ++row);

            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 75]) {
                range.Value = "Вимоги до повернень";
                range.Style.Font.Size = 10;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            }

            row++;
            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 75]) {
                range.Value = "1)Товар має бути запакований";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            row++;
            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 75]) {
                range.Value = "2)Коробка даного товару і сам товар мають бути без пошкоджень";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            row++;
            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 75]) {
                range.Value = "3)Повинні бути документи на повернення: від кого і причина повернення в письмовому вигляді";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            row++;
            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 75]) {
                range.Value = "4)Товар не буде прийматися, якщо вказане не буде виконано, і в цьому випадку товар буде відправлено назад покупцеві.";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            worksheet = package.Workbook.Worksheets.Add("Накладна_2");

            worksheet.ApplyPrinterSettings(0.5m, 0.5m, 0.1m, 0.1m, 0.25m, 0.25m, true);

            worksheet.Cells.Style.Font.Name = "Arial";
            worksheet.Cells.Style.Font.Size = 8;
            worksheet.DefaultColWidth = 9.83;
            worksheet.DefaultRowHeight = 11.25;

            //Set Rows
            worksheet.SetRowHeight(3.75, new[] { 1, 4, 5, 6 });
            worksheet.SetRowHeight(3.95, new[] { 11, 14, 17 });
            worksheet.SetRowHeight(12.75, new[] { 9, 10, 12, 13, 15, 16 });
            worksheet.SetRowHeight(31, new[] { 7, 3 });
            worksheet.SetRowHeight(45, new[] { 2 });

            //Set Columns
            worksheet.SetColumnWidth(0.83, new[] { 1, 34, 37 });
            worksheet.SetColumnWidth(2.33, new[] { 3, 9, 11, 13, 15 });
            worksheet.SetColumnWidth(3, new[] { 8, 10 });
            worksheet.SetColumnWidth(2.5, new[] { 12, 67 });
            worksheet.SetColumnWidth(0.66, new[] { 16, 28, 31 });
            worksheet.SetColumnWidth(0.33, new[] { 18, 23, 58, 60, 62, 64, 66, 68, 70, 72, 74, 76, 78 });
            worksheet.SetColumnWidth(0.5, new[] { 20, 22, 43 });
            worksheet.SetColumnWidth(0.16, new[] { 24, 27, 30, 33, 36, 39, 42, 45, 48 });
            worksheet.SetColumnWidth(1, new[] { 25, 57, 35, 41, 44, 47, 50, 51 });
            worksheet.SetColumnWidth(1.5, new[] { 26, 29, 32, 38, 41, 52, 54, 576, 61 });
            worksheet.SetColumnWidth(1.33, new[] { 40, 55 });
            worksheet.SetColumnWidth(1.83, new[] { 46, 71, 77 });
            worksheet.SetColumnWidth(2.16, new[] { 49, 59 });
            worksheet.SetColumnWidth(2, new[] { 14, 17, 21, 53, 56, 63, 65 });
            worksheet.SetColumnWidth(3, new[] { 69, 73, 75 });
            worksheet.SetColumnWidth(2.42, 19);
            worksheet.SetColumnWidth(2.75, 4);
            worksheet.SetColumnWidth(3, 5);
            worksheet.SetColumnWidth(3, 6);
            worksheet.SetColumnWidth(3.5, 7);
            worksheet.SetColumnWidth(2.9, 2);

            row = 2;
            column = 2;

            //Document header
            using (ExcelRange range = worksheet.Cells[row, column, row, column + 10]) {
                range.Merge = true;
                range.Value = "Перевізник:";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.UnderLine = true;
                range.Style.Font.Size = 14;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 11, row, column + 75]) {
                range.Merge = true;
                string value = sale.Transporter.Name;

                if (!string.IsNullOrEmpty(sale.DeliveryRecipientAddress.City))
                    value += ", " + sale.DeliveryRecipientAddress.City;
                if (!string.IsNullOrEmpty(sale.DeliveryRecipientAddress.Value))
                    value += ", " + sale.DeliveryRecipientAddress.Value;
                if (!string.IsNullOrEmpty(sale.DeliveryRecipientAddress.Department))
                    value += ", " + sale.DeliveryRecipientAddress.Department;
                if (!string.IsNullOrEmpty(sale.DeliveryRecipient.FullName))
                    value += ", " + sale.DeliveryRecipient.FullName;
                if (!string.IsNullOrEmpty(sale.DeliveryRecipient.MobilePhone))
                    value += ", " + sale.DeliveryRecipient.MobilePhone;

                range.Value = value;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Bold = true;

                if (value.Length < 50)
                    range.Style.Font.Size = 14;
                else
                    range.Style.Font.Size = 10;
                range.Style.WrapText = true;
                range.Merge = true;
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column, row, column + 6]) {
                range.Value = "Примітка:";
                range.Merge = true;
                range.Style.Font.UnderLine = true;
                range.Style.Font.Size = 14;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 7, row, column + 75]) {
                string value = string.Empty;

                if (sale.IsCashOnDelivery) value += $" накладний платіж: {decimal.Round(sale.CashOnDeliveryAmount, 2, MidpointRounding.AwayFromZero)}. ";

                if (sale.CustomersOwnTtn != null) value += $" власне ТТН: {sale.CustomersOwnTtn.Number}. ";

                if (!string.IsNullOrEmpty(sale.Comment)) value += $" коментар: {sale.Comment}. ";

                range.Value = value;
                range.Merge = true;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 10;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column - 1, row, column + 75]) {
                range.Style.Border.Bottom.Style = ExcelBorderStyle.MediumDashed;
            }

            row += 3;

            using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                range.Merge = true;
                range.Value =
                    string.Format(
                        "Видаткова накладна № {0} від {1} р.",
                        sale.SaleNumber.Value,
                        $"{sale.ChangedToInvoice.Value.Day}   {months.FirstOrDefault(m => m.Number.Equals(sale.ChangedToInvoice.Value.Month))?.Name.ToLower() ?? string.Empty}   {sale.ChangedToInvoice.Value.Year}"
                    );
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Medium;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 14;
            }

            row += 2;

            using (ExcelRange range = worksheet.Cells[row, column, row, column + 4]) {
                range.Merge = true;
                range.Value = "Постачальник:";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.UnderLine = true;
                range.Style.Font.Size = 9;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 6, row, column + 75]) {
                range.Merge = true;
                range.Value = sale.ClientAgreement.Agreement.Organization.Name;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 11;
                range.Style.WrapText = true;
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column + 7, row, column + 75]) {
                range.Merge = true;
                string val = string.Empty;

                switch (sale.ClientAgreement.Agreement.Organization.TypeTaxation) {
                    case TypeTaxation.SingleTax:
                        val = "Є платником єдиного податку";
                        break;
                    case TypeTaxation.SingleTaxAndVat:
                        val = "Є платником єдиного податку та ПДВ";
                        break;
                    case TypeTaxation.IncomeTax:
                        val = "Є платником податку на прибуток";
                        break;
                    case TypeTaxation.IncomeTaxAndVat:
                        val = "Є платником податку на прибуток на загальних підставах";
                        break;
                    case TypeTaxation.NotPaying:
                        val = "Не є платником податку на прибуток на загальних підставах";
                        break;
                }

                range.Value = val;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
            }

            row += 2;
            using (ExcelRange range = worksheet.Cells[row, column, row, column + 4]) {
                range.Merge = true;
                range.Value = "Покупець:";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.UnderLine = true;
                range.Style.Font.Size = 9;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 6, row, column + 75]) {
                range.Merge = true;
                range.Value =
                    string.Format(
                        "{0}", // - {1}
                        !string.IsNullOrEmpty(sale.ClientAgreement.Client.FullName) ? sale.ClientAgreement.Client.FullName : sale.ClientAgreement.Client.Name
                        //, sale.ClientAgreement.Client.RegionCode?.Value ?? ""
                    );
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 11;
                range.Style.WrapText = true;
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column + 7, row, column + 75]) {
                string clientInfo = string.Empty;

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.RegionCode?.City)) clientInfo += $"{sale.ClientAgreement.Client.RegionCode.City}, ";

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.RegionCode?.District)) clientInfo += $"{sale.ClientAgreement.Client.RegionCode.District}, ";

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.ActualAddress)) clientInfo += $"{sale.ClientAgreement.Client.ActualAddress}, ";

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.MobileNumber) && sale.RetailClientId.HasValue)
                    clientInfo += $"тел.: {sale.ClientAgreement.Client.MobileNumber}";

                range.Style.WrapText = true;
                range.Merge = true;
                range.Value = clientInfo;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 11;

                if (string.IsNullOrEmpty(clientInfo))
                    worksheet.SetRowHeight(1, row);

                if (clientInfo.Length > 80)
                    worksheet.SetRowHeight(24, row);
            }

            row += 2;
            //Table header
            row += 2;

            tableStartRow = row;

            using (ExcelRange range = worksheet.Cells[row, column, row + 1, column + 1]) {
                range.Value = "№";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 2, row + 1, column + 13]) {
                range.Value = "Артикул";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 14, row + 1, column + 20]) {
                range.Value = "Розм.";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 21, row + 1, column + 48]) {
                range.Value = "Товар";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 49, row + 1, column + 60]) {
                range.Value = "Кількість";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 61, row + 1, column + 68]) {
                range.Value = "Ціна";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 69, row + 1, column + 76]) {
                range.Value = "Сума";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            worksheet.SetRowHeight(20, row + 2);

            using (ExcelRange range = worksheet.Cells[row + 2, column, row + 2, column + 10]) {
                range.Value = "Примітка:";
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Medium;
                range.Style.Font.Italic = true;
                range.Style.Font.Size = 12;
                range.Style.Border.Right.Style = ExcelBorderStyle.Thin;
                range.Style.Font.UnderLine = true;
            }

            using (ExcelRange range = worksheet.Cells[row + 2, column + 11, row + 2, column + 76]) {
                range.Value = sale.Comment;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Medium;
                range.Style.Font.Size = 12;
            }

            row += 3;

            //Table body

            tableRowNumber = 1;

            foreach (OrderItem item in sale.Order.OrderItems) {
                bool specialItem =
                    item.Product.IsForSale || item.Product.IsForZeroSale || item.Product.Top.ToUpper().Equals("X9") || item.Product.Top.ToUpper().Equals("Х9");
                decimal currentPrice = default;
                decimal currentTotalPrice = default;
                if (item.Qty != 0) {
                    currentPrice = decimal.Round(item.TotalAmountLocal / Convert.ToDecimal(item.Qty), 2, MidpointRounding.AwayFromZero);
                    currentTotalPrice = decimal.Round(item.TotalAmountLocal, 2, MidpointRounding.AwayFromZero);
                }


                if (specialItem) {
                    if (item.ProductLocations.Any() || item.ProductLocationsHistory.Any()) {
                        foreach (ProductLocation location in item.ProductLocations) {
                            foreach (ProductLocationHistory locationHistory in item.ProductLocationsHistory.Where(x => x.TypeOfMovement == TypeOfMovement.Return))
                                if (location.ProductPlacementId == locationHistory.ProductPlacementId) {
                                    location.Qty += locationHistory.Qty;
                                    locationHistory.Qty = 0;
                                }

                            //Special OrderItem
                            using (ExcelRange range = worksheet.Cells[row, column]) {
                                range.Value = tableRowNumber;
                                range.Style.Font.Size = 9;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            //Special mark * 
                            using (ExcelRange range = worksheet.Cells[row, column + 1]) {
                                range.Value = "*";
                                range.Style.Font.Size = 22;
                                range.Style.Font.Bold = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 13]) {
                                range.Value = item.Product.VendorCode;
                                range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 16;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 14, row, column + 20]) {
                                string locationAddress =
                                    location.ProductPlacement.StorageNumber +
                                    "-" +
                                    (
                                        string.IsNullOrEmpty(location.ProductPlacement.RowNumber)
                                            ? string.Empty
                                            : $"{location.ProductPlacement.RowNumber}-"
                                    ) +
                                    location.ProductPlacement.CellNumber;

                                range.Value = locationAddress;
                                range.Style.Font.Size = 10;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 21, row, column + 48]) {
                                range.Value = item.Product.Name;
                                range.Merge = true;
                                range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                range.Style.WrapText = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                range.Value = location.Qty;
                                range.Style.Font.Size = 16;
                                range.Style.Font.Bold = true;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                range.Value = item.Product.MeasureUnit.Name;
                                range.Style.Font.Size = 11;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                //ToDo: local price
                                range.Value = currentPrice;
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                //ToDo: local price
                                range.Value = decimal.Round(currentPrice * Convert.ToDecimal(location.Qty), 2, MidpointRounding.AwayFromZero);
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            if (item.Product.Name.Length > 18) {
                                if (item.Product.Name.Length < 35)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);
                            }

                            if (item.Product.VendorCode.Length > 15)
                                worksheet.SetRowHeight(28, row);
                            else
                                worksheet.SetRowHeight(35, row);

                            row++;
                        }

                        if (item.ProductLocationsHistory.Any())
                            foreach (ProductLocationHistory location in item.ProductLocationsHistory.Where(x => x.Qty != 0)) {
                                //Special OrderItem
                                using (ExcelRange range = worksheet.Cells[row, column]) {
                                    range.Value = tableRowNumber;
                                    range.Style.Font.Size = 9;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                //Special mark * 
                                using (ExcelRange range = worksheet.Cells[row, column + 1]) {
                                    range.Value = "*";
                                    range.Style.Font.Size = 22;
                                    range.Style.Font.Bold = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 13]) {
                                    range.Value = item.Product.VendorCode;
                                    range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 16;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 14, row, column + 20]) {
                                    string locationAddress =
                                        location.ProductPlacement.StorageNumber +
                                        "-" +
                                        (
                                            string.IsNullOrEmpty(location.ProductPlacement.RowNumber)
                                                ? string.Empty
                                                : $"{location.ProductPlacement.RowNumber}-"
                                        ) +
                                        location.ProductPlacement.CellNumber;

                                    range.Value = locationAddress;
                                    range.Style.Font.Size = 10;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 21, row, column + 48]) {
                                    range.Value = item.Product.Name;
                                    range.Merge = true;
                                    range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                    range.Style.WrapText = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                    range.Value = location.Qty;
                                    range.Style.Font.Size = 16;
                                    range.Style.Font.Bold = true;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                    range.Value = item.Product.MeasureUnit.Name;
                                    range.Style.Font.Size = 11;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                    //ToDo: local price
                                    range.Value = currentPrice;
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                    //ToDo: local price
                                    range.Value = decimal.Round(currentPrice / Convert.ToDecimal(location.Qty), 2, MidpointRounding.AwayFromZero);
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                if (item.Product.Name.Length > 18) {
                                    if (item.Product.Name.Length < 35)
                                        worksheet.SetRowHeight(28, row);
                                    else
                                        worksheet.SetRowHeight(35, row);
                                }

                                if (item.Product.VendorCode.Length > 15)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);

                                row++;
                            }

                        if (item.ProductLocations.Sum(l => l.Qty) + item.ProductLocationsHistory.Sum(g => g.Qty) < item.Qty) {
                            //Special OrderItem
                            using (ExcelRange range = worksheet.Cells[row, column]) {
                                range.Value = tableRowNumber;
                                range.Style.Font.Size = 9;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            //Special mark * 
                            using (ExcelRange range = worksheet.Cells[row, column + 1]) {
                                range.Value = "*";
                                range.Style.Font.Size = 22;
                                range.Style.Font.Bold = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 13]) {
                                range.Value = item.Product.VendorCode;
                                range.Style.Font.Size = 16;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 14, row, column + 20]) {
                                range.Value = string.Empty;
                                range.Style.Font.Size = 10;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 21, row, column + 48]) {
                                range.Value = item.Product.Name;
                                range.Merge = true;
                                range.Style.WrapText = true;
                                range.Style.Font.Size = 11;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            double totalQty = item.Qty - (item.ProductLocations.Sum(l => l.Qty) + item.ProductLocationsHistory.Sum(g => g.Qty));
                            using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                range.Value = totalQty;
                                range.Style.Font.Size = 16;
                                range.Style.Font.Bold = true;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                range.Value = item.Product.MeasureUnit.Name;
                                range.Style.Font.Size = 11;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                //ToDo: local price
                                range.Value = currentPrice;
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                //ToDo: local price
                                range.Value = decimal.Round(currentPrice / Convert.ToDecimal(totalQty), 2, MidpointRounding.AwayFromZero);
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            if (item.Product.Name.Length > 18) {
                                if (item.Product.Name.Length < 35)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);
                            }

                            row++;
                        }
                    } else {
                        //Special OrderItem
                        using (ExcelRange range = worksheet.Cells[row, column]) {
                            range.Value = tableRowNumber;
                            range.Style.Font.Size = 9;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        //Special mark * 
                        using (ExcelRange range = worksheet.Cells[row, column + 1]) {
                            range.Value = "*";
                            range.Style.Font.Size = 22;
                            range.Style.Font.Bold = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 13]) {
                            range.Value = item.Product.VendorCode;
                            range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 16;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 14, row, column + 20]) {
                            range.Value = string.Empty;
                            range.Style.Font.Size = 10;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 21, row, column + 48]) {
                            range.Value = item.Product.Name;
                            range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                            range.Merge = true;
                            range.Style.WrapText = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                            range.Value = item.Qty;
                            range.Style.Font.Size = 16;
                            range.Style.Font.Bold = true;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                            range.Value = item.Product.MeasureUnit.Name;
                            range.Style.Font.Size = 11;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                            //ToDo: local price
                            range.Value = currentPrice;
                            range.Style.Font.Size = 11;
                            range.Style.Numberformat.Format = "0.00";
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                            //ToDo: local price
                            range.Value = currentTotalPrice;
                            range.Style.Font.Size = 11;
                            range.Style.Numberformat.Format = "0.00";
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        if (item.Product.Name.Length > 18) {
                            if (item.Product.Name.Length < 35)
                                worksheet.SetRowHeight(28, row);
                            else
                                worksheet.SetRowHeight(35, row);
                        }

                        if (item.Product.VendorCode.Length > 15)
                            worksheet.SetRowHeight(28, row);
                        else
                            worksheet.SetRowHeight(35, row);

                        row++;
                    }
                } else {
                    if (item.ProductLocations.Any() || item.ProductLocationsHistory.Any()) {
                        foreach (ProductLocation location in item.ProductLocations) {
                            foreach (ProductLocationHistory locationHistory in item.ProductLocationsHistory.Where(x => x.TypeOfMovement == TypeOfMovement.Return))
                                if (location.ProductPlacementId == locationHistory.ProductPlacementId) {
                                    location.Qty += locationHistory.Qty;
                                    locationHistory.Qty = 0;
                                }

                            //if (item.ProductLocations.Count.Equals(1) && item.ProductLocationsHistory.Count.Equals(0)) {
                            //Simple  OrderItem
                            using (ExcelRange range = worksheet.Cells[row, column, row, column + 1]) {
                                range.Value = tableRowNumber;
                                range.Style.Font.Size = 9;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 13]) {
                                range.Value = item.Product.VendorCode;
                                range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 16;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 14, row, column + 20]) {
                                string locationAddress =
                                    location.ProductPlacement.StorageNumber +
                                    "-" +
                                    (
                                        string.IsNullOrEmpty(location.ProductPlacement.RowNumber)
                                            ? string.Empty
                                            : $"{location.ProductPlacement.RowNumber}-"
                                    ) +
                                    location.ProductPlacement.CellNumber;

                                range.Value = locationAddress;
                                range.Style.Font.Size = 10;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 21, row, column + 48]) {
                                range.Value = item.Product.Name;
                                range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                range.Merge = true;
                                range.Style.WrapText = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                range.Value = location.Qty;
                                range.Style.Font.Size = 16;
                                range.Style.Font.Bold = true;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                range.Value = item.Product.MeasureUnit.Name;
                                range.Style.Font.Size = 11;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                //ToDo: local price
                                range.Value = item.Product.CurrentLocalPrice;
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                //ToDo: local price
                                range.Value =
                                    decimal.Round(
                                        item.Product.CurrentLocalPrice * Convert.ToDecimal(location.Qty),
                                        2,
                                        MidpointRounding.AwayFromZero
                                    );
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            if (item.Product.Name.Length > 18) {
                                if (item.Product.Name.Length < 35)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);
                            }

                            if (item.Product.VendorCode.Length > 15)
                                worksheet.SetRowHeight(28, row);
                            else
                                worksheet.SetRowHeight(35, row);

                            row++;
                            //} else {
                            //    //Simple  OrderItem
                            //    using (ExcelRange range = worksheet.Cells[row, column, row, column + 1]) {
                            //        range.Value = tableRowNumber;
                            //        range.Style.Font.Size = 9;
                            //        range.Merge = true;
                            //        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                            //        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            //        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            //    }

                            //    using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 13]) {
                            //        range.Value = item.Product.VendorCode;
                            //        range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 16;
                            //        range.Merge = true;
                            //        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            //        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            //        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            //    }

                            //    using (ExcelRange range = worksheet.Cells[row, column + 14, row, column + 20]) {
                            //        string locationAddress =
                            //            location.ProductPlacement.StorageNumber +
                            //            "-" +
                            //            (
                            //                string.IsNullOrEmpty(location.ProductPlacement.RowNumber)
                            //                    ? string.Empty
                            //                    : $"{location.ProductPlacement.RowNumber}-"
                            //            ) +
                            //            location.ProductPlacement.CellNumber;

                            //        range.Value = locationAddress;
                            //        range.Style.Font.Size = 10;
                            //        range.Merge = true;
                            //        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            //        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            //        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            //    }

                            //    using (ExcelRange range = worksheet.Cells[row, column + 21, row, column + 48]) {
                            //        range.Value = item.Product.Name;
                            //        range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                            //        range.Merge = true;
                            //        range.Style.WrapText = true;
                            //        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            //        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            //        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            //    }

                            //    using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                            //        range.Value = location.Qty;
                            //        range.Style.Font.Size = 16;
                            //        range.Style.Font.Bold = true;
                            //        range.Merge = true;
                            //        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            //        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            //        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            //    }

                            //    using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                            //        range.Value = item.Product.MeasureUnit.Name;
                            //        range.Style.Font.Size = 11;
                            //        range.Merge = true;
                            //        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            //        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            //        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            //    }

                            //    using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                            //        //ToDo: local price
                            //        range.Value = currentPrice;
                            //        range.Style.Font.Size = 11;
                            //        range.Style.Numberformat.Format = "0.00";
                            //        range.Merge = true;
                            //        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            //        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            //        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            //    }

                            //    using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                            //        //ToDo: local price
                            //        range.Value = currentTotalPrice;
                            //        range.Style.Font.Size = 11;
                            //        range.Style.Numberformat.Format = "0.00";
                            //        range.Merge = true;
                            //        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            //        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            //        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            //    }

                            //    if (item.Product.Name.Length > 18) {
                            //        if (item.Product.Name.Length < 35) {
                            //            worksheet.SetRowHeight(28, row);
                            //        } else {
                            //            worksheet.SetRowHeight(35, row);
                            //        }
                            //    }

                            //    if (item.Product.VendorCode.Length > 15) {
                            //        worksheet.SetRowHeight(28, row);
                            //    } else {
                            //        worksheet.SetRowHeight(35, row);
                            //    }

                            //    row++;
                            //}
                        }

                        if (item.ProductLocationsHistory.Any())
                            foreach (ProductLocationHistory location in item.ProductLocationsHistory.Where(x => x.Qty != 0)) {
                                //Special OrderItem
                                using (ExcelRange range = worksheet.Cells[row, column, row, column + 1]) {
                                    range.Value = tableRowNumber;
                                    range.Style.Font.Size = 9;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 13]) {
                                    range.Value = item.Product.VendorCode;
                                    range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 16;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 14, row, column + 20]) {
                                    string locationAddress =
                                        location.ProductPlacement.StorageNumber +
                                        "-" +
                                        (
                                            string.IsNullOrEmpty(location.ProductPlacement.RowNumber)
                                                ? string.Empty
                                                : $"{location.ProductPlacement.RowNumber}-"
                                        ) +
                                        location.ProductPlacement.CellNumber;

                                    range.Value = locationAddress;
                                    range.Style.Font.Size = 10;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 21, row, column + 48]) {
                                    range.Value = item.Product.Name;
                                    range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                    range.Merge = true;
                                    range.Style.WrapText = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                    range.Value = location.Qty;
                                    range.Style.Font.Size = 16;
                                    range.Style.Font.Bold = true;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                    range.Value = item.Product.MeasureUnit.Name;
                                    range.Style.Font.Size = 11;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                    //ToDo: local price
                                    range.Value = item.Product.CurrentLocalPrice;
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                    //ToDo: local price
                                    range.Value =
                                        decimal.Round(
                                            item.Product.CurrentLocalPrice * Convert.ToDecimal(location.Qty),
                                            2,
                                            MidpointRounding.AwayFromZero
                                        );
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                if (item.Product.Name.Length > 18) {
                                    if (item.Product.Name.Length < 35)
                                        worksheet.SetRowHeight(28, row);
                                    else
                                        worksheet.SetRowHeight(35, row);
                                }

                                if (item.Product.VendorCode.Length > 15)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);

                                row++;
                            }

                        if (item.ProductLocations.Sum(l => l.Qty) + item.ProductLocationsHistory.Sum(g => g.Qty) < item.Qty) {
                            //Simple  OrderItem
                            using (ExcelRange range = worksheet.Cells[row, column, row, column + 1]) {
                                range.Value = tableRowNumber;
                                range.Style.Font.Size = 9;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 13]) {
                                range.Value = item.Product.VendorCode;
                                range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 16;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 14, row, column + 20]) {
                                range.Value = string.Empty;
                                range.Style.Font.Size = 10;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 21, row, column + 48]) {
                                range.Value = item.Product.Name;
                                range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                range.Merge = true;
                                range.Style.WrapText = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            double totalQty = item.Qty - (item.ProductLocations.Sum(l => l.Qty) + item.ProductLocationsHistory.Sum(g => g.Qty));
                            using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                range.Value = totalQty;
                                range.Style.Font.Size = 16;
                                range.Style.Font.Bold = true;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                range.Value = item.Product.MeasureUnit.Name;
                                range.Style.Font.Size = 11;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                //ToDo: local price
                                range.Value = currentPrice;
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                //ToDo: local price
                                range.Value = decimal.Round(currentPrice / Convert.ToDecimal(totalQty), 2, MidpointRounding.AwayFromZero);
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            if (item.Product.Name.Length > 18) {
                                if (item.Product.Name.Length < 35)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);
                            }

                            if (item.Product.VendorCode.Length > 15)
                                worksheet.SetRowHeight(28, row);
                            else
                                worksheet.SetRowHeight(35, row);

                            row++;
                        }
                    } else {
                        //Simple  OrderItem
                        using (ExcelRange range = worksheet.Cells[row, column, row, column + 1]) {
                            range.Value = tableRowNumber;
                            range.Style.Font.Size = 9;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 13]) {
                            range.Value = item.Product.VendorCode;
                            range.Style.Font.Size = 16;
                            range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 16;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 14, row, column + 20]) {
                            range.Value = string.Empty;
                            range.Style.Font.Size = 10;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 21, row, column + 48]) {
                            range.Value = $"{item.Product.Name} {item.AssignedSpecification?.SpecificationCode}";
                            range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                            range.Merge = true;
                            range.Style.WrapText = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                            range.Value = item.Qty;
                            range.Style.Font.Size = 16;
                            range.Style.Font.Bold = true;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                            range.Value = item.Product.MeasureUnit.Name;
                            range.Style.Font.Size = 11;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                            //ToDo: local price
                            range.Value = currentPrice;
                            range.Style.Font.Size = 11;
                            range.Style.Numberformat.Format = "0.00";
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                            //ToDo: local price
                            range.Value = decimal.Round(currentPrice / Convert.ToDecimal(item.Qty), 2, MidpointRounding.AwayFromZero);
                            ;
                            range.Style.Font.Size = 11;
                            range.Style.Numberformat.Format = "0.00";
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        if (item.Product.Name.Length > 18) {
                            if (item.Product.Name.Length < 35)
                                worksheet.SetRowHeight(28, row);
                            else
                                worksheet.SetRowHeight(35, row);
                        }

                        if (item.Product.VendorCode.Length > 15)
                            worksheet.SetRowHeight(28, row);
                        else
                            worksheet.SetRowHeight(35, row);

                        row++;
                    }
                }

                tableRowNumber++;
            }

            tableEndRow = row - 1;

            using (ExcelRange range = worksheet.Cells[tableStartRow, column, tableEndRow, column + 76]) {
                range.Style.Border.BorderAround(ExcelBorderStyle.Medium);
            }

            worksheet.SetRowHeight(6.95, row);
            worksheet.SetRowHeight(15, ++row);

            using (ExcelRange range = worksheet.Cells[row, column, row, column + 12]) {
                range.Value = DateTime.Now.ToString("dd.MM.yyyy HH:mm:ss");
                range.Style.Font.Size = 6;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 60, row, column + 66]) {
                range.Value = "Разом:";
                range.Style.Font.Size = 10;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            totalAmount = sale.Order.OrderItems.Sum(x => x.TotalAmountLocal);

            using (ExcelRange range = worksheet.Cells[row, column + 68, row, column + 75]) {
                range.Value = decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero);
                range.Style.Font.Size = 11;
                range.Style.Numberformat.Format = "0.00";
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            worksheet.SetRowHeight(6.95, ++row);
            worksheet.SetRowHeight(11.25, ++row);

            if (sale.ClientAgreement.Agreement.Currency.Code.ToLower().Equals("eur")) {
                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero)} EUR.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheet.SetRowHeight(12.75, ++row);

                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                    int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                    string endKeyWord;

                    if (fullNumber > 10 && fullNumber < 20)
                        endKeyWord = "центів";
                    else
                        switch (endNumber) {
                            case 1:
                                endKeyWord = "цент";
                                break;
                            case 2:
                            case 3:
                            case 4:
                                endKeyWord = "цента";
                                break;
                            default:
                                endKeyWord = "центів";
                                break;
                        }

                    range.Value =
                        $"{totalAmount.ToText(true, true)} євро {(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100).ToText(false, true)} {endKeyWord}";
                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            } else if (sale.ClientAgreement.Agreement.Currency.Code.ToLower().Equals("usd")) {
                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero)} USD.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheet.SetRowHeight(12.75, ++row);

                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                    int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                    string endKeyWord;

                    if (fullNumber > 10 && fullNumber < 20)
                        endKeyWord = "центів";
                    else
                        switch (endNumber) {
                            case 1:
                                endKeyWord = "цент";
                                break;
                            case 2:
                            case 3:
                            case 4:
                                endKeyWord = "цента";
                                break;
                            default:
                                endKeyWord = "центів";
                                break;
                        }

                    range.Value =
                        $"{decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero).ToText(true, true)} доларів {(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100).ToText(false, true)} {endKeyWord}";
                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            } else if (sale.ClientAgreement.Agreement.Currency.Code.ToLower().Equals("pln")) {
                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero)} PLN.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheet.SetRowHeight(12.75, ++row);

                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                    int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                    string endKeyWord;

                    if (fullNumber > 10 && fullNumber < 20)
                        endKeyWord = "грошів";
                    else
                        switch (endNumber) {
                            case 1:
                                endKeyWord = "грош";
                                break;
                            case 2:
                            case 3:
                            case 4:
                                endKeyWord = "гроша";
                                break;
                            default:
                                endKeyWord = "грошів";
                                break;
                        }

                    range.Value =
                        $"{decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero).ToText(true, true)} злотих {(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100).ToText(false, true)} {endKeyWord}";
                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            } else {
                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero)} ГРН.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheet.SetRowHeight(12.75, ++row);

                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                    int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                    string endKeyWord;

                    if (fullNumber > 10 && fullNumber < 20)
                        endKeyWord = "копійок";
                    else
                        switch (endNumber) {
                            case 1:
                                endKeyWord = "копійка";
                                break;
                            case 2:
                            case 3:
                            case 4:
                                endKeyWord = "копійки";
                                break;
                            default:
                                endKeyWord = "копійок";
                                break;
                        }

                    range.Value =
                        $"{decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero).ToText(true, true)} гривень {(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100).ToText(false, true)} {endKeyWord}";
                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            }

            worksheet.SetRowHeight(6.95, ++row);
            using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Medium;
            }

            row++;

            worksheet.SetRowHeight(12.75, ++row);

            using (ExcelRange range = worksheet.Cells[row, column, row, column + 5]) {
                range.Value = "Відвантажив(ла): ";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 7, row, column + 29]) {
                range.Merge = true;
                range.Value = "директор " + sale.ClientAgreement.Agreement.Organization.Manager;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            using (ExcelRange range = worksheet.Cells[row + 1, column + 7, row + 1, column + 29]) {
                range.Style.Border.Top.Style = ExcelBorderStyle.Thin;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 36, row, column + 51]) {
                range.Value = "Отримав(ла):";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 52, row, column + 73]) {
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Thin;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            row++;
            worksheet.SetRowHeight(6.95, ++row);
            worksheet.SetRowHeight(12.75, ++row);

            using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                range.Value = $"Термін оплати до {DateTime.Now.AddDays(sale.ClientAgreement.Agreement.NumberDaysDebt).ToString("dd.MM.yyyy")}";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Style.Font.UnderLine = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            worksheet.SetRowHeight(6.95, ++row);

            //Remark
            worksheet.SetRowHeight(10, ++row);

            row++;
            worksheet.SetRowHeight(12.75, ++row);

            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 75]) {
                range.Value = "Вимоги до повернень";
                range.Style.Font.Size = 10;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            }

            row++;
            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 75]) {
                range.Value = "1)Товар має бути запакований";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            row++;
            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 75]) {
                range.Value = "2)Коробка даного товару і сам товар мають бути без пошкоджень";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            row++;
            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 75]) {
                range.Value = "3)Повинні бути документи на повернення: від кого і причина повернення в письмовому вигляді";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            row++;
            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 75]) {
                range.Value = "4)Товар не буде прийматися, якщо вказане не буде виконано, і в цьому випадку товар буде відправлено назад покупцеві.";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            package.Save();
        }

        return SaveFiles(fileName);
    }

    public (string xlsxFile, string pdfFile) ExportUkInvoiceIsVatSaleToXlsx(string path, Sale sale, IEnumerable<DocumentMonth> months) {
        string fileName = Path.Combine(path, $"{sale.SaleInvoiceNumber.Number}_{DateTime.Now.ToString("MM.yyyy")}_{Guid.NewGuid().ToString()}.xlsx");

        DateTime current = DateTime.Now;

        using (ExcelPackage package = NewExcelPackage(fileName)) {
            ExcelWorksheet worksheet = package.Workbook.Worksheets.Add("Накладна");

            worksheet.ApplyPrinterSettings(0.5m, 0.5m, 0.1m, 0.1m, 0.25m, 0.25m, true);

            worksheet.Cells.Style.Font.Name = "Arial";
            worksheet.Cells.Style.Font.Size = 8;
            worksheet.DefaultColWidth = 9.83;
            worksheet.DefaultRowHeight = 11.25;

            //Set Rows
            worksheet.SetRowHeight(3.75, new[] { 1, 3 });
            worksheet.SetRowHeight(3.95, new[] { 15 });
            worksheet.SetRowHeight(12.75, new[] { 9, 10, 13, 6, 7, 8, 11, 12, 5 });
            worksheet.SetRowHeight(31, new[] { 2, 4, 14 });
            worksheet.SetRowHeight(22, 16);

            //Set Columns
            worksheet.SetColumnWidth(0.83, new[] { 1, 34, 37 });
            worksheet.SetColumnWidth(2.33, new[] { 3, 9, 11, 13, 15 });
            worksheet.SetColumnWidth(3, new[] { 8, 10 });
            worksheet.SetColumnWidth(2.5, new[] { 12, 67 });
            worksheet.SetColumnWidth(0.66, new[] { 16, 28, 31 });
            worksheet.SetColumnWidth(0.33, new[] { 18, 23, 58, 60, 62, 64, 66, 68, 70, 72, 74, 76, 78 });
            worksheet.SetColumnWidth(0.5, new[] { 20, 22, 43 });
            worksheet.SetColumnWidth(0.16, new[] { 24, 27, 30, 33, 36, 39, 42, 45, 48 });
            worksheet.SetColumnWidth(1, new[] { 25, 57, 35, 41, 44, 47, 50, 51 });
            worksheet.SetColumnWidth(1.5, new[] { 26, 29, 32, 38, 41, 52, 54, 576, 61 });
            worksheet.SetColumnWidth(1.33, new[] { 40, 55 });
            worksheet.SetColumnWidth(1.83, new[] { 46, 71, 77 });
            worksheet.SetColumnWidth(2.16, new[] { 49, 59 });
            worksheet.SetColumnWidth(2, new[] { 14, 17, 21, 53, 56, 63, 65 });
            worksheet.SetColumnWidth(3, new[] { 69, 73, 75 });
            worksheet.SetColumnWidth(2.42, 19);
            worksheet.SetColumnWidth(2.75, 4);
            worksheet.SetColumnWidth(3, 5);
            worksheet.SetColumnWidth(3, 6);
            worksheet.SetColumnWidth(3.5, 7);
            worksheet.SetColumnWidth(2.9, 2);

            int row = 2;
            int column = 2;

            DateTime fromDate = sale.ChangedToInvoice.Value;

            //Document header
            using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                range.Merge = true;
                string invoice = "Видаткова накладна № {0} від {1} р.";
                if (sale.HistoryInvoiceEdit.Any() && !sale.IsVatSale) invoice += "                Змінено";
                range.Value =
                    string.Format(
                        invoice,
                        sale.SaleNumber.Value,
                        $"{fromDate.Day} {months.FirstOrDefault(m => m.Number.Equals(fromDate.Month))?.Name.ToLower() ?? string.Empty} {fromDate.Year}"
                    );
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Medium;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 14;
            }

            row += 2;

            using (ExcelRange range = worksheet.Cells[row, column, row, column + 4]) {
                range.Merge = true;
                range.Value = "Постачальник:";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.UnderLine = true;
                range.Style.Font.Size = 9;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 6, row, column + 75]) {
                range.Merge = true;
                range.Value = sale.ClientAgreement.Agreement.Organization.FullName;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 14;
                range.Style.WrapText = true;
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column + 6, row, column + 75]) {
                range.Merge = true;
                string val = string.Empty;
                if (sale.ClientAgreement.Agreement.Organization.MainPaymentRegister != null) {
                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.AccountNumber))
                        val += $"П/р {sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.AccountNumber}, ";

                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.BankName))
                        val += $"у банку {sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.BankName}, ";

                    range.Value = val;
                } else {
                    range.Value = val;
                }

                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;

                if (string.IsNullOrEmpty(val))
                    worksheet.SetRowHeight(1, row);
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column + 6, row, column + 75]) {
                range.Merge = true;
                string val = string.Empty;

                if (sale.ClientAgreement.Agreement.Organization.MainPaymentRegister != null) {
                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.City))
                        val += $"м. {sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.City}, ";

                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.SortCode))
                        val += $"МФО {sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.SortCode}, ";

                    range.Value = val;
                } else {
                    range.Value = val;
                }

                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;

                if (string.IsNullOrEmpty(val))
                    worksheet.SetRowHeight(1, row);
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column + 6, row, column + 75]) {
                range.Merge = true;
                string val = string.Empty;

                if (sale.ClientAgreement.Agreement.Organization.MainPaymentRegister != null) {
                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.Address))
                        val += $"{sale.ClientAgreement.Agreement.Organization.Address}, ";
                    range.Value = val;
                } else {
                    range.Value = val;
                }

                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;

                if (string.IsNullOrEmpty(val))
                    worksheet.SetRowHeight(1, row);
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column + 6, row, column + 75]) {
                range.Merge = true;
                string val = string.Empty;

                if (sale.ClientAgreement.Agreement.Organization.MainPaymentRegister != null) {
                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.PhoneNumber))
                        val += $"тел.: {sale.ClientAgreement.Agreement.Organization.PhoneNumber}, ";

                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.USREOU))
                        val += $"код за ЄДРПОУ {sale.ClientAgreement.Agreement.Organization.USREOU}, ";

                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.TIN))
                        val += $"ІПН {sale.ClientAgreement.Agreement.Organization.TIN}";

                    range.Value = val;
                } else {
                    range.Value = val;
                }

                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;

                if (string.IsNullOrEmpty(val))
                    worksheet.SetRowHeight(1, row);
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column + 7, row, column + 75]) {
                range.Merge = true;
                string val = string.Empty;

                switch (sale.ClientAgreement.Agreement.Organization.TypeTaxation) {
                    case TypeTaxation.SingleTax:
                        val = "Є платником єдиного податку";
                        break;
                    case TypeTaxation.SingleTaxAndVat:
                        val = "Є платником єдиного податку та ПДВ";
                        break;
                    case TypeTaxation.IncomeTax:
                        val = "Є платником податку на прибуток";
                        break;
                    case TypeTaxation.IncomeTaxAndVat:
                        val = "Є платником податку на прибуток на загальних підставах";
                        break;
                    case TypeTaxation.NotPaying:
                        val = "Не є платником податку на прибуток на загальних підставах";
                        break;
                }

                range.Value = val;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
            }

            row += 2;
            using (ExcelRange range = worksheet.Cells[row, column, row, column + 4]) {
                range.Merge = true;
                range.Value = "Покупець:";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.UnderLine = true;
                range.Style.Font.Size = 9;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 6, row, column + 75]) {
                range.Merge = true;
                range.Value =
                    string.Format(
                        "{0} ", //{1}
                        !string.IsNullOrEmpty(sale.ClientAgreement.Client.FullName) ? sale.ClientAgreement.Client.FullName : sale.ClientAgreement.Client.Name
                        // , sale.ClientAgreement.Client.RegionCode == null ? "" : "- " + sale.ClientAgreement.Client.RegionCode.Value
                    );
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 11;
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column + 7, row, column + 75]) {
                string clientInfo = string.Empty;

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.RegionCode?.City)) clientInfo += $"{sale.ClientAgreement.Client.RegionCode.City}, ";

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.RegionCode?.District)) clientInfo += $"{sale.ClientAgreement.Client.RegionCode.District}, ";

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.ActualAddress)) clientInfo += $"{sale.ClientAgreement.Client.ActualAddress}, ";

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.MobileNumber) && !sale.RetailClientId.HasValue)
                    clientInfo += $"тел.: {sale.ClientAgreement.Client.MobileNumber}";

                range.Merge = true;
                range.Value = clientInfo;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.WrapText = true;

                if (string.IsNullOrEmpty(clientInfo))
                    worksheet.SetRowHeight(1, row);

                if (clientInfo.Length > 80)
                    worksheet.SetRowHeight(24, row);
            }

            row += 2;

            if (sale.ClientAgreement.Agreement.WithAgreementLine && !sale.ClientAgreement.Client.ClientInRole.ClientTypeRole.Name.ToLower().Equals("shopclient")) {
                using (ExcelRange range = worksheet.Cells[row, column, row, column + 4]) {
                    range.Merge = true;
                    range.Value = "Договір:";
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    range.Style.Font.UnderLine = true;
                    range.Style.Font.Size = 9;
                }

                using (ExcelRange range = worksheet.Cells[row, column + 6, row, column + 75]) {
                    range.Merge = true;
                    string fromDateStringFormat = string.Empty;

                    if (sale.ClientAgreement.Agreement.FromDate.HasValue)
                        fromDateStringFormat = TimeZoneInfo.ConvertTimeFromUtc(
                            sale.ClientAgreement.Agreement.FromDate.Value,
                            TimeZoneInfo.FindSystemTimeZoneById(
                                CultureInfo.CurrentCulture.TwoLetterISOLanguageName.Equals("uk")
                                    ? "FLE Standard Time"
                                    : "Central European Standard Time"
                            )).ToString("dd.MM.yyyy");

                    range.Value = $"№ {sale.ClientAgreement.Agreement.Number} від {fromDateStringFormat}";

                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    range.Style.Font.Size = 10;
                }
            }

            row += 2;

            if (sale.ClientAgreement.Agreement.WithVATAccounting) {
                using ExcelRange range = worksheet.Cells[row, column, row, column + 75];
                range.Merge = true;
                range.Value = "Видаткова накладна є підставою для оплати";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 10;
            }

            row += 2;
            //Table header
            int tableStartRow = row;

            using (ExcelRange range = worksheet.Cells[row, column, row + 1, column + 1]) {
                range.Value = "№";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 2, row + 1, column + 7]) {
                range.Value = "Артикул";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 8, row + 1, column + 35]) {
                range.Value = "Товар";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 36, row + 1, column + 48]) {
                range.Value = "";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 49, row + 1, column + 60]) {
                range.Value = "Кількість";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 61, row + 1, column + 68]) {
                range.Value = "Ціна з ПДВ";
                range.Merge = true;
                range.SetTableHeaderStyle();
                range.Style.WrapText = true;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 69, row + 1, column + 76]) {
                range.Value = "Сума з ПДВ";
                range.Merge = true;
                range.SetTableHeaderStyle();
                range.Style.WrapText = true;
            }

            row += 2;

            //Table body

            int tableRowNumber = 1;

            foreach (OrderItem item in sale.Order.OrderItems) {
                bool specialItem =
                    item.Product.IsForSale || item.Product.IsForZeroSale || item.Product.Top.ToUpper().Equals("X9") || item.Product.Top.ToUpper().Equals("Х9");

                if (specialItem) {
                    if (item.ProductLocations.Any() || item.ProductLocationsHistory.Any()) {
                        foreach (ProductLocation location in item.ProductLocations) {
                            foreach (ProductLocationHistory locationHistory in item.ProductLocationsHistory.Where(x => x.TypeOfMovement == TypeOfMovement.Return))
                                if (location.ProductPlacementId == locationHistory.ProductPlacementId) {
                                    location.Qty += locationHistory.Qty;
                                    locationHistory.Qty = 0;
                                }

                            //Special OrderItem
                            using (ExcelRange range = worksheet.Cells[row, column]) {
                                range.Value = tableRowNumber;
                                range.Style.Font.Size = 9;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            //Special mark * 
                            using (ExcelRange range = worksheet.Cells[row, column + 1]) {
                                range.Value = "*";
                                range.Style.Font.Size = 22;
                                range.Style.Font.Bold = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 7]) {
                                range.Value = item.Product.VendorCode;
                                range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 14;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 8, row, column + 35]) {
                                range.Value = item.Product.Name;
                                range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                range.Merge = true;
                                range.Style.WrapText = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 36, row, column + 48]) {
                                // string locationAddress =
                                //     location.ProductPlacement.StorageNumber +
                                //     "-" +
                                //     (
                                //         string.IsNullOrEmpty(location.ProductPlacement.RowNumber)
                                //             ? string.Empty
                                //             : $"{location.ProductPlacement.RowNumber}-"
                                //     ) +
                                //     location.ProductPlacement.CellNumber;
                                //
                                // range.Value = locationAddress;
                                range.Value = item.AssignedSpecification?.SpecificationCode;
                                range.Style.Font.Size = 10;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                range.Value = location.Qty;
                                range.Style.Font.Size = 16;
                                range.Style.Font.Bold = true;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                range.Value = item.Product.MeasureUnit.Name;
                                range.Style.Font.Size = 11;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                //ToDo: local price
                                range.Value = item.Product.CurrentLocalPrice;
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                //ToDo: local price
                                range.Value = decimal.Round(item.Product.CurrentLocalPrice * Convert.ToDecimal(location.Qty), 2, MidpointRounding.AwayFromZero);
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            if (item.Product.Name.Length > 18) {
                                if (item.Product.Name.Length < 35)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);
                            }

                            if (item.Product.VendorCode.Length > 15)
                                worksheet.SetRowHeight(28, row);
                            else
                                worksheet.SetRowHeight(35, row);

                            row++;
                        }

                        if (item.ProductLocationsHistory.Any())
                            foreach (ProductLocationHistory location in item.ProductLocationsHistory.Where(x => x.Qty != 0)) {
                                //Special OrderItem
                                using (ExcelRange range = worksheet.Cells[row, column]) {
                                    range.Value = tableRowNumber;
                                    range.Style.Font.Size = 9;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                //Special mark * 
                                using (ExcelRange range = worksheet.Cells[row, column + 1]) {
                                    range.Value = "*";
                                    range.Style.Font.Size = 22;
                                    range.Style.Font.Bold = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 7]) {
                                    range.Value = item.Product.VendorCode;
                                    range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 14;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 8, row, column + 35]) {
                                    range.Value = item.Product.Name;
                                    range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                    range.Merge = true;
                                    range.Style.WrapText = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 36, row, column + 48]) {
                                    // string locationAddress =
                                    //     location.ProductPlacement.StorageNumber +
                                    //     "-" +
                                    //     (
                                    //         string.IsNullOrEmpty(location.ProductPlacement.RowNumber)
                                    //             ? string.Empty
                                    //             : $"{location.ProductPlacement.RowNumber}-"
                                    //     ) +
                                    //     location.ProductPlacement.CellNumber;
                                    //
                                    // range.Value = locationAddress;
                                    range.Value = item.AssignedSpecification?.SpecificationCode;
                                    range.Style.Font.Size = 10;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                    range.Value = location.Qty;
                                    range.Style.Font.Size = 16;
                                    range.Style.Font.Bold = true;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                    range.Value = item.Product.MeasureUnit.Name;
                                    range.Style.Font.Size = 11;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                    //ToDo: local price
                                    range.Value = item.Product.CurrentLocalPrice;
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                    //ToDo: local price
                                    range.Value = decimal.Round(item.Product.CurrentLocalPrice * Convert.ToDecimal(location.Qty), 2, MidpointRounding.AwayFromZero);
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                if (item.Product.Name.Length > 18) {
                                    if (item.Product.Name.Length < 35)
                                        worksheet.SetRowHeight(28, row);
                                    else
                                        worksheet.SetRowHeight(35, row);
                                }

                                if (item.Product.VendorCode.Length > 15)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);

                                row++;
                            }

                        if (item.ProductLocations.Sum(l => l.Qty) + item.ProductLocationsHistory.Sum(g => g.Qty) < item.Qty) {
                            //Special OrderItem
                            using (ExcelRange range = worksheet.Cells[row, column]) {
                                range.Value = tableRowNumber;
                                range.Style.Font.Size = 9;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            //Special mark * 
                            using (ExcelRange range = worksheet.Cells[row, column + 1]) {
                                range.Value = "*";
                                range.Style.Font.Size = 22;
                                range.Style.Font.Bold = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 7]) {
                                range.Value = item.Product.VendorCode;
                                range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 14;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 8, row, column + 35]) {
                                range.Value = item.Product.Name;
                                range.Merge = true;
                                range.Style.WrapText = true;
                                range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 36, row, column + 48]) {
                                range.Value = item.AssignedSpecification?.SpecificationCode;
                                range.Style.Font.Size = 10;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                range.Value = item.Qty - item.ProductLocations.Sum(l => l.Qty);
                                range.Style.Font.Size = 16;
                                range.Style.Font.Bold = true;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                range.Value = item.Product.MeasureUnit.Name;
                                range.Style.Font.Size = 11;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                //ToDo: local price
                                range.Value = item.Product.CurrentLocalPrice;
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                //ToDo: local price

                                range.Value =
                                    decimal.Round(
                                        item.Product.CurrentLocalPrice * Convert.ToDecimal(item.Qty - item.ProductLocations.Sum(l => l.Qty)),
                                        2,
                                        MidpointRounding.AwayFromZero
                                    );
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            if (item.Product.Name.Length > 18) {
                                if (item.Product.Name.Length < 35)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);
                            }

                            if (item.Product.VendorCode.Length > 15)
                                worksheet.SetRowHeight(28, row);
                            else
                                worksheet.SetRowHeight(35, row);

                            row++;
                        }
                    } else {
                        //Special OrderItem
                        using (ExcelRange range = worksheet.Cells[row, column]) {
                            range.Value = tableRowNumber;
                            range.Style.Font.Size = 9;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        //Special mark * 
                        using (ExcelRange range = worksheet.Cells[row, column + 1]) {
                            range.Value = "*";
                            range.Style.Font.Size = 22;
                            range.Style.Font.Bold = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 7]) {
                            range.Value = item.Product.VendorCode;
                            range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 14;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 8, row, column + 35]) {
                            range.Value = item.Product.Name;
                            range.Merge = true;
                            range.Style.WrapText = true;
                            range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 36, row, column + 48]) {
                            range.Value = item.AssignedSpecification?.SpecificationCode;
                            range.Style.Font.Size = 10;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                            range.Value = item.Qty;
                            range.Style.Font.Size = 16;
                            range.Style.Font.Bold = true;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                            range.Value = item.Product.MeasureUnit.Name;
                            range.Style.Font.Size = 11;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                            //ToDo: local price
                            range.Value = item.Product.CurrentLocalPrice;
                            range.Style.Font.Size = 11;
                            range.Style.Numberformat.Format = "0.00";
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                            //ToDo: local price
                            range.Value =
                                decimal.Round(
                                    item.Product.CurrentLocalPrice * Convert.ToDecimal(item.Qty),
                                    2,
                                    MidpointRounding.AwayFromZero
                                );
                            range.Style.Font.Size = 11;
                            range.Style.Numberformat.Format = "0.00";
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        if (item.Product.Name.Length > 18) {
                            if (item.Product.Name.Length < 35)
                                worksheet.SetRowHeight(28, row);
                            else
                                worksheet.SetRowHeight(35, row);
                        }

                        if (item.Product.VendorCode.Length > 15)
                            worksheet.SetRowHeight(28, row);
                        else
                            worksheet.SetRowHeight(35, row);

                        row++;
                    }
                } else {
                    //Simple  OrderItem
                    using (ExcelRange range = worksheet.Cells[row, column, row, column + 1]) {
                        range.Value = tableRowNumber;
                        range.Style.Font.Size = 9;
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    }

                    using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 7]) {
                        range.Value = item.Product.VendorCode;
                        range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 14;
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    }

                    using (ExcelRange range = worksheet.Cells[row, column + 8, row, column + 35]) {
                        range.Value = item.Product.Name;
                        range.Merge = true;
                        range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                        range.Style.WrapText = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    }

                    using (ExcelRange range = worksheet.Cells[row, column + 36, row, column + 48]) {
                        range.Value = item.AssignedSpecification?.SpecificationCode;
                        range.Style.Font.Size = 10;
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    }

                    using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                        range.Value = item.Qty;
                        range.Style.Font.Size = 16;
                        range.Style.Font.Bold = true;
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    }

                    using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                        range.Value = item.Product.MeasureUnit?.Name;
                        range.Style.Font.Size = 11;
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    }

                    using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                        //ToDo: local price
                        range.Value = decimal.Round(
                            item.Product.CurrentLocalPrice,
                            2,
                            MidpointRounding.AwayFromZero
                        );
                        range.Style.Font.Size = 11;
                        range.Style.Numberformat.Format = "0.00";
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    }

                    using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                        //ToDo: local price
                        range.Value = item.Product.CurrentLocalPrice * Convert.ToDecimal(item.Qty);
                        range.Style.Font.Size = 11;
                        range.Style.Numberformat.Format = "0.00";
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    }

                    if (item.Product.Name.Length > 18) {
                        if (item.Product.Name.Length < 35)
                            worksheet.SetRowHeight(28, row);
                        else
                            worksheet.SetRowHeight(35, row);
                    }

                    if (item.Product.VendorCode.Length > 15)
                        worksheet.SetRowHeight(28, row);
                    else
                        worksheet.SetRowHeight(35, row);

                    row++;
                }

                tableRowNumber++;
            }

            int tableEndRow = row - 1;

            using (ExcelRange range = worksheet.Cells[tableStartRow, column, tableEndRow, column + 76]) {
                range.Style.Border.BorderAround(ExcelBorderStyle.Medium);
            }

            worksheet.SetRowHeight(6.95, row);
            worksheet.SetRowHeight(15, ++row);

            using (ExcelRange range = worksheet.Cells[row, column + 60, row, column + 66]) {
                range.Value = "Разом:";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            decimal totalAmount = Math.Round(sale.Order.OrderItems.Sum(x => x.Product.CurrentLocalPrice * Convert.ToDecimal(x.Qty)), 2);

            using (ExcelRange range = worksheet.Cells[row, column + 67, row, column + 76]) {
                range.Value = decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero);
                range.Style.Font.Size = 11;
                range.Style.Numberformat.Format = "0.00";
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column + 52, row, column + 66]) {
                range.Value = "У тому числі ПДВ:";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 68, row, column + 76]) {
                decimal vatRate =
                    sale.ClientAgreement.Agreement.Organization.VatRate != null
                        ? Convert.ToDecimal(sale.ClientAgreement.Agreement.Organization.VatRate.Value) / 100
                        : 0;

                range.Value = decimal.Round(totalAmount * (vatRate / (1 + vatRate)), 2, MidpointRounding.AwayFromZero);
                range.Style.Font.Size = 11;
                range.Style.Numberformat.Format = "0.00";
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            worksheet.SetRowHeight(6.95, ++row);
            worksheet.SetRowHeight(11.25, ++row);

            if (sale.ClientAgreement.Agreement.Currency.Code.ToLower().Equals("eur")) {
                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero)} EUR.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheet.SetRowHeight(12.75, ++row);

                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                    int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                    string endKeyWord;

                    if (fullNumber > 10 && fullNumber < 20)
                        endKeyWord = "центів";
                    else
                        switch (endNumber) {
                            case 1:
                                endKeyWord = "цент";
                                break;
                            case 2:
                            case 3:
                            case 4:
                                endKeyWord = "цента";
                                break;
                            default:
                                endKeyWord = "центів";
                                break;
                        }

                    range.Value =
                        $"{decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero).ToText(true, true)} євро {(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100).ToText(false, true)} {endKeyWord}";
                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            } else if (sale.ClientAgreement.Agreement.Currency.Code.ToLower().Equals("usd")) {
                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero)} USD.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheet.SetRowHeight(12.75, ++row);

                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                    int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                    string endKeyWord;

                    if (fullNumber > 10 && fullNumber < 20)
                        endKeyWord = "центів";
                    else
                        switch (endNumber) {
                            case 1:
                                endKeyWord = "цент";
                                break;
                            case 2:
                            case 3:
                            case 4:
                                endKeyWord = "цента";
                                break;
                            default:
                                endKeyWord = "центів";
                                break;
                        }

                    range.Value =
                        $"{decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero).ToText(true, true)} доларів {(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100).ToText(false, true)} {endKeyWord}";
                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            } else if (sale.ClientAgreement.Agreement.Currency.Code.ToLower().Equals("pln")) {
                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero)} PLN.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheet.SetRowHeight(12.75, ++row);

                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                    int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                    string endKeyWord;

                    if (fullNumber > 10 && fullNumber < 20)
                        endKeyWord = "грошів";
                    else
                        switch (endNumber) {
                            case 1:
                                endKeyWord = "грош";
                                break;
                            case 2:
                            case 3:
                            case 4:
                                endKeyWord = "гроша";
                                break;
                            default:
                                endKeyWord = "грошів";
                                break;
                        }

                    range.Value =
                        $"{decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero).ToText(true, true)} злотих {(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100).ToText(false, true)} {endKeyWord}";
                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            } else {
                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero)} ГРН.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheet.SetRowHeight(12.75, ++row);

                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                    int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                    range.Value = $"{totalAmount.ToCompleteText(sale.ClientAgreement.Agreement.Currency.Code, true, true, true)}";
                    //range.Value =
                    //    $"{decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero).ToText(true, true)} гривень {(Math.Round(totalAmount % 1, 2) * 100).ToText(false, true, false)} {endKeyWord}";

                    // else
                    //     range.Value =
                    //         $"{decimal.Round(sale.TotalAmount, 2, MidpointRounding.AwayFromZero).ToText(true, true)} гривень {(Math.Round(decimal.Round(sale.TotalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100).ToText(false, true)} {endKeyWord}";

                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            }

            worksheet.SetRowHeight(6.95, ++row);
            using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Medium;
            }

            row++;

            worksheet.SetRowHeight(12.75, ++row);

            using (ExcelRange range = worksheet.Cells[row, column, row, column + 5]) {
                range.Value = "Відвантажив(ла):";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 7, row, column + 29]) {
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Thin;
                range.Merge = true;
                range.Value = $" директор {sale.ClientAgreement.Agreement.Organization.Manager}";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 36, row, column + 51]) {
                range.Value = "Отримав(ла):";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 52, row, column + 73]) {
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Thin;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            worksheet.SetRowHeight(14.75, ++row);
            worksheet.SetRowHeight(14.75, row + 1);

            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 29]) {
                range.Value = "* Відповідальний за здійснення господарської операції";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.General;
            }

            using (ExcelRange range = worksheet.Cells[row + 1, column + 2, row + 1, column + 29]) {
                range.Value = "і правильність її оформлення";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.General;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 36, row, column + 51]) {
                range.Value = "За довіреністю";
                range.Style.Font.Size = 9;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 57]) {
                range.Merge = true;
                range.Value = "№";
                range.Style.Font.Size = 9;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 65, row, column + 70]) {
                range.Merge = true;
                range.Value = "від";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.Font.Size = 9;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            }

            worksheet.SetRowHeight(6.95, ++row);
            worksheet.SetRowHeight(12.75, ++row);

            //Remark

            if (sale.Order.OrderItems.Any(x => x.OneTimeDiscount > 0)) {
                worksheet.SetRowHeight(24, ++row);

                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    range.Value = "* - замовлений або акційний товар поверненню не підлягає";
                    range.Style.Font.Size = 18;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }

                row++;
            }

            worksheet.SetRowHeight(12.75, ++row);

            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 75]) {
                range.Value = "Вимоги до повернень";
                range.Style.Font.Size = 10;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            }

            row++;
            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 75]) {
                range.Value = "1)Товар має бути запакований";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            row++;
            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 75]) {
                range.Value = "2)Коробка даного товару і сам товар мають бути без пошкоджень";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            row++;
            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 75]) {
                range.Value = "3)Повинні бути документи на повернення: від кого і причина повернення в письмовому вигляді";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            row++;
            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 75]) {
                range.Value = "4)Товар не буде прийматися, якщо вказане не буде виконано, і в цьому випадку товар буде відправлено назад покупцеві.";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            package.Save();
        }

        return SaveFiles(fileName);
    }

    public (string xlsxFile, string pdfFile) ExportInvoiceForPaymentForSale(string path, Sale sale) {
        string fileName = Path.Combine(path, $"VAT_Invoice_{sale.SaleNumber.Value}_{Guid.NewGuid().ToString()}.xlsx");

        using (ExcelPackage package = NewExcelPackage(fileName)) {
            ExcelWorksheet worksheet = package.Workbook.Worksheets.Add("VAT_Invoice");

            //Set printer settings
            worksheet.ApplyPrinterSettings(0.3m, 0.3m, 0.1m, 0.1m, 0.3m, 0.3m, true);

            //Set column's width
            worksheet.SetColumnWidth(0.55, 1);
            worksheet.SetColumnWidth(0.44, 2);
            worksheet.SetColumnWidth(2.55, 3);
            worksheet.SetColumnWidth(2.99, 4);
            worksheet.SetColumnWidth(2.66, 5);
            worksheet.SetColumnWidth(0.66, 6);
            worksheet.SetColumnWidth(1.99, 7);
            worksheet.SetColumnWidth(2.66, 8);
            worksheet.SetColumnWidth(1.99, 9);
            worksheet.SetColumnWidth(1.99, 10);
            worksheet.SetColumnWidth(1.99, 11);
            worksheet.SetColumnWidth(1.99, 12);
            worksheet.SetColumnWidth(1.99, 13);
            worksheet.SetColumnWidth(1.99, 14);
            worksheet.SetColumnWidth(1.22, 15);
            worksheet.SetColumnWidth(1.66, 16);
            worksheet.SetColumnWidth(2.66, 17);
            worksheet.SetColumnWidth(0.55, 18);
            worksheet.SetColumnWidth(2.11, 19);
            worksheet.SetColumnWidth(2.66, 20);
            worksheet.SetColumnWidth(2.66, 21);
            worksheet.SetColumnWidth(1.44, 22);
            worksheet.SetColumnWidth(1.22, 23);
            worksheet.SetColumnWidth(1.11, 24);
            worksheet.SetColumnWidth(1.55, 25);
            worksheet.SetColumnWidth(2.66, 26);
            worksheet.SetColumnWidth(1.88, 27);
            worksheet.SetColumnWidth(0.88, 28);
            worksheet.SetColumnWidth(2.66, 29);
            worksheet.SetColumnWidth(0.99, 30);
            worksheet.SetColumnWidth(1.66, 31);
            worksheet.SetColumnWidth(0.22, 32);
            worksheet.SetColumnWidth(2.66, 33);
            worksheet.SetColumnWidth(2.99, 34);
            worksheet.SetColumnWidth(1.22, 35);
            worksheet.SetColumnWidth(1.55, 36);
            worksheet.SetColumnWidth(2.99, 37);
            worksheet.SetColumnWidth(2.99, 38);
            worksheet.SetColumnWidth(2.99, 39);
            worksheet.SetColumnWidth(2.99, 40);
            worksheet.SetColumnWidth(2.55, 41);
            worksheet.SetColumnWidth(0.11, 42);
            worksheet.SetColumnWidth(2.99, 43);
            worksheet.SetColumnWidth(2.11, 44);
            worksheet.SetColumnWidth(0.66, 45);
            worksheet.SetColumnWidth(2.99, 46);
            worksheet.SetColumnWidth(2.99, 47);
            worksheet.SetColumnWidth(2.88, 48);
            worksheet.SetColumnWidth(2.55, 49);
            worksheet.SetColumnWidth(2.22, 50);
            worksheet.SetColumnWidth(0.55, 51);
            worksheet.SetColumnWidth(0.22, 52);

            worksheet.SetRowHeight(4.38, new[] { 11, 20, 25, 24 }); //5
            worksheet.SetRowHeight(6.38, new[] { 4, 6, 13 }); //8
            worksheet.SetRowHeight(11.28, new[] { 1, 2, 3, 8, 15, 17 /*28, 34, 37*/ }); //15
            worksheet.SetRowHeight(11.98, new[] { 10, 22, 23, 26, 27, 25 }); //16
            worksheet.SetRowHeight(12.78, new[] { 9, 14, 18, 21 /*31, 32, 38*/ }); //17
            worksheet.SetRowHeight(16.28, new[] { 5 }); //21
            worksheet.SetRowHeight(21.28, new[] { 16 }); //28
            worksheet.SetRowHeight(28, new[] { 12 /*, 29*/ }); //29
            worksheet.SetRowHeight(24.38, new[] { 7 }); //32
            worksheet.SetRowHeight(34.48, new[] { 19 }); //46

            using (ExcelRange range = worksheet.Cells[1, 5, 3, 47]) {
                range.Merge = true;
                range.Value =
                    "Увага! Оплата цього рахунку означає погодження з умовами поставки товарів. Повідомлення про оплату є обов'язковим, в іншому випадку не гарантується наявність товарів на складі. Товар відпускається за фактом надходження коштів на п/р Постачальника, самовивозом, за наявності довіреності та паспорта.";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 8;
                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
            }

            using (ExcelRange range = worksheet.Cells[5, 3, 5, 50]) {
                range.Merge = true;
                range.Value = "Зразок заповнення платіжного доручення";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
            }

            using (ExcelRange range = worksheet.Cells[7, 3, 7, 6]) {
                range.Merge = true;
                range.Value = "Одержувач";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                range.Style.Font.Size = 9;
            }

            using (ExcelRange range = worksheet.Cells[7, 7, 7, 30]) {
                range.Merge = true;
                range.Value = sale.ClientAgreement.Agreement.Organization.FullName;
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
            }

            using (ExcelRange range = worksheet.Cells[8, 3, 9, 6]) {
                range.Merge = true;
                range.Value = "Код";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
            }

            using (ExcelRange range = worksheet.Cells[8, 7, 9, 15]) {
                range.Merge = true;
                range.Value = sale.ClientAgreement.Agreement.Organization.TIN;
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Style.Border.BorderAround(ExcelBorderStyle.Medium);
            }

            using (ExcelRange range = worksheet.Cells[10, 3, 10, 10]) {
                range.Merge = true;
                range.Value = "Банк одержувача";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                range.Style.Font.Size = 9;
            }

            using (ExcelRange range = worksheet.Cells[10, 25, 10, 30]) {
                range.Merge = true;
                range.Value = "Код банку";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                range.Style.Font.Size = 9;
            }

            using (ExcelRange range = worksheet.Cells[12, 3, 12, 24]) {
                range.Merge = true;
                range.Value =
                    $"{sale.ClientAgreement.Agreement.Organization.MainPaymentRegister?.BankName ?? string.Empty} {sale.ClientAgreement.Agreement.Organization.MainPaymentRegister?.City ?? string.Empty}";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Thin;
            }

            using (ExcelRange range = worksheet.Cells[12, 25, 12, 30]) {
                range.Merge = true;
                range.Value = sale.ClientAgreement.Agreement.Organization.MainPaymentRegister?.SortCode ?? string.Empty;
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
            }

            using (ExcelRange range = worksheet.Cells[11, 25, 12, 30]) {
                range.Style.Border.BorderAround(ExcelBorderStyle.Medium);
            }

            using (ExcelRange range = worksheet.Cells[8, 33, 8, 44]) {
                range.Merge = true;
                range.Value = "КРЕДИТ рах. N";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
            }

            using (ExcelRange range = worksheet.Cells[9, 33, 10, 44]) {
                range.Merge = true;
                range.Value = sale.ClientAgreement.Agreement.Organization.MainPaymentRegister?.AccountNumber ?? string.Empty;
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Style.Border.BorderAround(ExcelBorderStyle.Medium);
            }

            using (ExcelRange range = worksheet.Cells[11, 33, 12, 44]) {
                range.Style.Border.BorderAround(ExcelBorderStyle.Medium);
            }

            using (ExcelRange range = worksheet.Cells[7, 45, 12, 50]) {
                range.Merge = true;
                range.Style.Border.Left.Style = ExcelBorderStyle.Medium;
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Medium;
            }

            using (ExcelRange range = worksheet.Cells[5, 3, 13, 50]) {
                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
            }

            string dateFormated = string.Empty;

            // if (sale.ChangedToInvoice.HasValue) {
            //     dateFormated += $"{sale.ChangedToInvoice?.Day} ";
            //
            //     switch (sale.ChangedToInvoice?.Month) {
            //         case 1:
            //             dateFormated += "січня ";
            //             break;
            //         case 2:
            //             dateFormated += "лютого ";
            //             break;
            //         case 3:
            //             dateFormated += "березня ";
            //             break;
            //         case 4:
            //             dateFormated += "квітня ";
            //             break;
            //         case 5:
            //             dateFormated += "травня ";
            //             break;
            //         case 6:
            //             dateFormated += "червня ";
            //             break;
            //         case 7:
            //             dateFormated += "липня ";
            //             break;
            //         case 8:
            //             dateFormated += "серпня ";
            //             break;
            //         case 9:
            //             dateFormated += "вересня ";
            //             break;
            //         case 10:
            //             dateFormated += "жовтня ";
            //             break;
            //         case 11:
            //             dateFormated += "листопада ";
            //             break;
            //         case 12:
            //             dateFormated += "грудня ";
            //             break;
            //         default:
            //             break;
            //     }
            //
            //     dateFormated += $"{sale.ChangedToInvoice?.Year} ";
            // } else {
            dateFormated += $"{sale.BillDownloadDate.Value.Day} ";

            switch (sale.BillDownloadDate.Value.Month) {
                case 1:
                    dateFormated += "січня ";
                    break;
                case 2:
                    dateFormated += "лютого ";
                    break;
                case 3:
                    dateFormated += "березня ";
                    break;
                case 4:
                    dateFormated += "квітня ";
                    break;
                case 5:
                    dateFormated += "травня ";
                    break;
                case 6:
                    dateFormated += "червня ";
                    break;
                case 7:
                    dateFormated += "липня ";
                    break;
                case 8:
                    dateFormated += "серпня ";
                    break;
                case 9:
                    dateFormated += "вересня ";
                    break;
                case 10:
                    dateFormated += "жовтня ";
                    break;
                case 11:
                    dateFormated += "листопада ";
                    break;
                case 12:
                    dateFormated += "грудня ";
                    break;
            }

            dateFormated += $"{sale.BillDownloadDate.Value.Year} ";
            // }

            using (ExcelRange range = worksheet.Cells[16, 2, 16, 51]) {
                string currentMonth = MonthCodesResourceNames.GetCurrentMonthCode();

                range.Merge = true;
                range.Value =
                    string.Format(
                        "Рахунок на оплату № {0} від {1} р.",
                        sale.SaleNumber.Value,
                        dateFormated
                    );
                //"Рахунок на оплату № 77 від 24 грудня 2018 р.";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 14;
                range.Style.Font.Bold = true;
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Medium;
            }

            using (ExcelRange range = worksheet.Cells[18, 2, 18, 8]) {
                range.Merge = true;
                range.Value = "Постачальник:";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
                range.Style.Font.UnderLine = true;
            }

            using (ExcelRange range = worksheet.Cells[18, 9, 18, 51]) {
                range.Merge = true;
                range.Value = sale.ClientAgreement.Agreement.Organization.FullName;
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
            }

            using (ExcelRange range = worksheet.Cells[19, 10, 19, 51]) {
                range.Merge = true;
                range.Value =
                    string.Format(
                        "П/р {0}, Банк {1} {2},  МФО {3}\r{4}, тел.: {5}\rкод за ДРФО {6}, ІПН {7}",
                        sale.ClientAgreement.Agreement.Organization.MainPaymentRegister?.AccountNumber ?? string.Empty,
                        sale.ClientAgreement.Agreement.Organization.MainPaymentRegister?.BankName ?? string.Empty,
                        sale.ClientAgreement.Agreement.Organization.MainPaymentRegister?.City ?? string.Empty,
                        sale.ClientAgreement.Agreement.Organization.MainPaymentRegister?.SortCode ?? string.Empty,
                        sale.ClientAgreement.Agreement.Organization.Address,
                        sale.ClientAgreement.Agreement.Organization.PhoneNumber,
                        sale.ClientAgreement.Agreement.Organization.USREOU,
                        sale.ClientAgreement.Agreement.Organization.TIN
                    );
                //"П/р 26002190000065, Банк ПАТ «УНІВЕРСАЛ БАНК» м. Київ, МФО 322001\rУкраїна, 29000, Хмельницький, Чорновола, дом № 176, кв.7, тел.: (097) 7013465,\r код за ДРФО 3100401117, ІПН 3100401117";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
            }

            using (ExcelRange range = worksheet.Cells[21, 2, 21, 8]) {
                range.Merge = true;
                range.Value = "Покупець:";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
                range.Style.Font.UnderLine = true;
            }

            using (ExcelRange range = worksheet.Cells[21, 9, 21, 51]) {
                range.Merge = true;
                range.Value = !string.IsNullOrEmpty(sale.ClientAgreement.Client.FullName) ? sale.ClientAgreement.Client.FullName : sale.ClientAgreement.Client.Name;
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
            }

            using (ExcelRange range = worksheet.Cells[22, 10, 22, 51]) {
                range.Merge = true;
                range.Value = $"{sale.ClientAgreement.Client.LegalAddress}";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
            }

            if (!sale.RetailClientId.HasValue) {
                using ExcelRange range = worksheet.Cells[23, 10, 23, 51];
                range.Merge = true;
                range.Value = $"Тел.: {sale.ClientAgreement.Client.MobileNumber}";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
            }

            if (sale.ClientAgreement.Agreement.WithAgreementLine && !sale.ClientAgreement.Client.ClientInRole.ClientTypeRole.Name.ToLower().Equals("shopclient")) {
                using (ExcelRange range = worksheet.Cells[25, 2, 25, 7]) {
                    range.Merge = true;
                    range.Value = "Договір:";
                    range.Style.WrapText = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    range.Style.Font.Size = 10;
                }

                using (ExcelRange range = worksheet.Cells[25, 8, 25, 51]) {
                    range.Merge = true;
                    string fromDateStringFormat = string.Empty;

                    if (sale.ClientAgreement.Agreement.FromDate.HasValue)
                        fromDateStringFormat = TimeZoneInfo.ConvertTimeFromUtc(
                            sale.ClientAgreement.Agreement.FromDate.Value,
                            TimeZoneInfo.FindSystemTimeZoneById(
                                CultureInfo.CurrentCulture.TwoLetterISOLanguageName.Equals("uk")
                                    ? "FLE Standard Time"
                                    : "Central European Standard Time"
                            )).ToString("dd.MM.yyyy");

                    range.Value = $"№ {sale.ClientAgreement.Agreement.Number} від {fromDateStringFormat}";
                    range.Style.WrapText = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    range.Style.Font.Size = 10;
                }
            }

            //Table header
            using (ExcelRange range = worksheet.Cells[27, 2, 28, 4]) {
                range.Merge = true;
                range.Value = "№";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                range.Style.Fill.BackgroundColor.SetColor(ColorTranslator.FromHtml("#EEEEEE"));
                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
            }

            using (ExcelRange range = worksheet.Cells[27, 5, 28, 12]) {
                range.Merge = true;
                range.Value = "Артикул";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                range.Style.Fill.BackgroundColor.SetColor(ColorTranslator.FromHtml("#EEEEEE"));
                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
            }

            using (ExcelRange range = worksheet.Cells[27, 13, 28, 36]) {
                range.Merge = true;
                range.Value = "Товари (роботи, послуги)";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                range.Style.Fill.BackgroundColor.SetColor(ColorTranslator.FromHtml("#EEEEEE"));
                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
            }

            using (ExcelRange range = worksheet.Cells[27, 37, 28, 40]) {
                range.Merge = true;
                range.Value = "Кількість";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                range.Style.Fill.BackgroundColor.SetColor(ColorTranslator.FromHtml("#EEEEEE"));
                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
            }

            using (ExcelRange range = worksheet.Cells[27, 41, 28, 46]) {
                range.Merge = true;
                range.Value = "Ціна з ПДВ";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                range.Style.Fill.BackgroundColor.SetColor(ColorTranslator.FromHtml("#EEEEEE"));
                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
            }

            using (ExcelRange range = worksheet.Cells[27, 47, 28, 51]) {
                range.Merge = true;
                range.Value = "Сума з ПДВ";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                range.Style.Fill.BackgroundColor.SetColor(ColorTranslator.FromHtml("#EEEEEE"));
                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
            }

            //Table body
            int row = 29;

            int index = 1;

            foreach (OrderItem item in sale.Order.OrderItems) {
                using (ExcelRange range = worksheet.Cells[row, 2, row, 4]) {
                    range.Merge = true;
                    range.Value = index;
                    range.Style.WrapText = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                    range.Style.Font.Size = 8;
                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                }

                using (ExcelRange range = worksheet.Cells[row, 5, row, 12]) {
                    range.Merge = true;
                    range.Value = item.Product.VendorCode;
                    range.Style.WrapText = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                    range.Style.Font.Size = 8;
                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                }

                using (ExcelRange range = worksheet.Cells[row, 13, row, 36]) {
                    range.Merge = true;
                    range.Value = $"{item.Product.Name} "; //{item.AssignedSpecification?.SpecificationCode}
                    range.Style.WrapText = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                    range.Style.Font.Size = 8;
                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                }

                using (ExcelRange range = worksheet.Cells[row, 37, row, 38]) {
                    range.Merge = true;
                    range.Value = item.Qty;
                    range.Style.WrapText = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                    range.Style.Font.Size = 8;
                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                }

                using (ExcelRange range = worksheet.Cells[row, 39, row, 40]) {
                    range.Merge = true;
                    range.Value = item.Product.MeasureUnit?.Name;
                    range.Style.WrapText = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                    range.Style.Font.Size = 8;
                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                }

                using (ExcelRange range = worksheet.Cells[row, 41, row, 46]) {
                    range.Merge = true;
                    range.Value = decimal.Round(item.Product.CurrentLocalPrice, 2, MidpointRounding.AwayFromZero);
                    range.Style.WrapText = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                    range.Style.Font.Size = 8;
                    range.Style.Numberformat.Format = "0.00";
                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                }

                using (ExcelRange range = worksheet.Cells[row, 47, row, 51]) {
                    range.Merge = true;
                    range.Value = decimal.Round(item.Product.CurrentLocalPrice * Convert.ToDecimal(item.Qty), 2, MidpointRounding.AwayFromZero);
                    range.Style.WrapText = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                    range.Style.Font.Size = 8;
                    range.Style.Numberformat.Format = "0.00";
                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                }

                if (item.Product.Name.Length > 32 || item.Product.VendorCode.Length > 32)
                    worksheet.SetRowHeight(24, row);
                else
                    worksheet.SetRowHeight(12, row);

                row++;
                index++;
            }

            worksheet.SetRowHeight(7.11, row);
            row++;

            using (ExcelRange range = worksheet.Cells[row, 41, row, 46]) {
                range.Merge = true;
                range.Value = "Разом:";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
            }

            decimal totalAmount = sale.Order.OrderItems.Sum(x => x.Product.CurrentLocalPrice * Convert.ToDecimal(x.Qty));

            using (ExcelRange range = worksheet.Cells[row, 47, row, 51]) {
                range.Merge = true;
                range.Value = decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero);
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Style.Numberformat.Format = "0.00";
            }

            worksheet.SetRowHeight(12.78, row);
            row++;

            using (ExcelRange range = worksheet.Cells[row, 41, row, 46]) {
                range.Merge = true;
                range.Value = "У тому числі ПДВ:";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
            }

            decimal vatRate =
                sale.ClientAgreement.Agreement.Organization.VatRate != null
                    ? Convert.ToDecimal(sale.ClientAgreement.Agreement.Organization.VatRate.Value) / 100
                    : 0;
            decimal totalVat = decimal.Round(totalAmount * (vatRate / (vatRate + 1)), 2, MidpointRounding.AwayFromZero);

            using (ExcelRange range = worksheet.Cells[row, 47, row, 51]) {
                range.Merge = true;

                range.Value = totalVat;
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Style.Numberformat.Format = "0.00";
            }

            worksheet.SetRowHeight(12.78, row);
            row++;

            worksheet.SetRowHeight(7.11, row);
            row++;

            // using (ExcelRange range = worksheet.Cells[row, 2, row, 51]) {
            //     range.Merge = true;
            //     range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero)} грн.";
            //     range.Style.WrapText = true;
            //     range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
            //     range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            //     range.Style.Font.Size = 8;
            //     range.Style.Numberformat.Format = "0.00";
            // }
            //
            // worksheet.SetRowHeight(11.28, row);
            // row++;
            //
            // int fullNumber = Convert.ToInt32(Math.Round(totalAmount % 1, 2) * 100);
            // int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());
            //
            // string endKeyWord;
            //
            // if (fullNumber > 10 && fullNumber < 20) {
            //     endKeyWord = "копійок";
            // } else {
            //     switch (endNumber) {
            //         case 1:
            //             endKeyWord = "копійка";
            //             break;
            //         case 2:
            //         case 3:
            //         case 4:
            //             endKeyWord = "копійки";
            //             break;
            //         default:
            //             endKeyWord = "копійок";
            //             break;
            //     }
            // }
            //
            // int vatFullNumber = Convert.ToInt32(Math.Round(totalAmount % 1, 2) * 100);
            // int vatEndNumber = Convert.ToInt32(vatFullNumber.ToString().Last().ToString());
            //
            // string varEndKeyWord;
            //
            // if (vatFullNumber > 10 && vatFullNumber < 20) {
            //     varEndKeyWord = "копійок";
            // } else {
            //     switch (vatEndNumber) {
            //         case 1:
            //             varEndKeyWord = "копійка";
            //             break;
            //         case 2:
            //         case 3:
            //         case 4:
            //             varEndKeyWord = "копійки";
            //             break;
            //         default:
            //             varEndKeyWord = "копійок";
            //             break;
            //     }
            // }
            //
            // using (ExcelRange range = worksheet.Cells[row, 2, row, 51]) {
            //     range.Merge = true;
            //     range.Value =
            //         string.Format(
            //             "{0} гривень {1} {2}\rУ т.ч. ПДВ: {3} гривень {4} {5}",
            //             totalAmount.ToText(true, true),
            //             (Math.Round(totalAmount % 1, 2) * 100).ToText(false, true),
            //             endKeyWord,
            //             totalVat.ToText(true, true),
            //             (Math.Round(totalVat % 1, 2) * 100).ToText(false, true),
            //             varEndKeyWord
            //         );
            //     //"Чотири тисячі вісімсот тридцять дев'ять гривень 89 копійок\rУ т.ч. ПДВ: Вісімсот шість гривень 65 копійок";
            //     range.Style.WrapText = true;
            //     range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
            //     range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            //     range.Style.Font.Size = 9;
            //     range.Style.Font.Bold = true;
            // }

            string vatInString;

            switch (sale.ClientAgreement.Agreement.Currency.Code.ToLower()) {
                case "eur": {
                    using (ExcelRange range = worksheet.Cells[row, 2, row, 51]) {
                        range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero)} EUR.";
                        range.Style.Font.Size = 8;
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                    }

                    worksheet.SetRowHeight(12.75, ++row);

                    using (ExcelRange range = worksheet.Cells[row, 2, row, 51]) {
                        int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                        int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                        string endKeyWord;

                        if (fullNumber > 10 && fullNumber < 20)
                            endKeyWord = "центів";
                        else
                            switch (endNumber) {
                                case 1:
                                    endKeyWord = "цент";
                                    break;
                                case 2:
                                case 3:
                                case 4:
                                    endKeyWord = "цента";
                                    break;
                                default:
                                    endKeyWord = "центів";
                                    break;
                            }

                        vatInString = $"У т.ч. ПДВ: {totalVat.ToText(true, true)} євро {(Math.Round(totalVat % 1, 2) * 100).ToText(false, true)} {endKeyWord}";

                        range.Value =
                            $"{decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero).ToText(true, true)} євро {(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100).ToText(false, true)} {endKeyWord}\r{vatInString}";
                        range.Style.Font.Size = 9;
                        range.Style.Font.Bold = true;
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                        range.Style.WrapText = true;
                    }

                    break;
                }
                case "usd": {
                    using (ExcelRange range = worksheet.Cells[row, 2, row, 51]) {
                        range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero)} USD.";
                        range.Style.Font.Size = 8;
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                    }

                    worksheet.SetRowHeight(12.75, ++row);

                    using (ExcelRange range = worksheet.Cells[row, 2, row, 51]) {
                        int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                        int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                        string endKeyWord;

                        if (fullNumber > 10 && fullNumber < 20)
                            endKeyWord = "центів";
                        else
                            switch (endNumber) {
                                case 1:
                                    endKeyWord = "цент";
                                    break;
                                case 2:
                                case 3:
                                case 4:
                                    endKeyWord = "цента";
                                    break;
                                default:
                                    endKeyWord = "центів";
                                    break;
                            }

                        vatInString = $"У т.ч. ПДВ: {totalVat.ToText(true, true)} доларів {(Math.Round(totalVat % 1, 2) * 100).ToText(false, true)} {endKeyWord}";

                        range.Value =
                            $"{decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero).ToText(true, true)} доларів {(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100).ToText(false, true)} {endKeyWord}\r{vatInString}";
                        range.Style.Font.Size = 9;
                        range.Style.Font.Bold = true;
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                        range.Style.WrapText = true;
                    }

                    break;
                }
                case "pln": {
                    using (ExcelRange range = worksheet.Cells[row, 2, row, 51]) {
                        range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero)} PLN.";
                        range.Style.Font.Size = 8;
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                    }

                    worksheet.SetRowHeight(12.75, ++row);

                    using (ExcelRange range = worksheet.Cells[row, 2, row, 51]) {
                        int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                        int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                        string endKeyWord;

                        if (fullNumber > 10 && fullNumber < 20)
                            endKeyWord = "грошів";
                        else
                            switch (endNumber) {
                                case 1:
                                    endKeyWord = "грош";
                                    break;
                                case 2:
                                case 3:
                                case 4:
                                    endKeyWord = "гроша";
                                    break;
                                default:
                                    endKeyWord = "грошів";
                                    break;
                            }

                        vatInString = $"У т.ч. ПДВ: {totalVat.ToText(true, true)} злотих {(Math.Round(totalVat % 1, 2) * 100).ToText(false, true)} {endKeyWord}";

                        range.Value =
                            $"{decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero).ToText(true, true)} злотих {(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100).ToText(false, true)} {endKeyWord}\r{vatInString}";
                        range.Style.Font.Size = 9;
                        range.Style.Font.Bold = true;
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                        range.Style.WrapText = true;
                    }

                    break;
                }
                default: {
                    using (ExcelRange range = worksheet.Cells[row, 2, row, 51]) {
                        range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero)} ГРН.";
                        range.Style.Font.Size = 8;
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                    }

                    worksheet.SetRowHeight(12.75, ++row);

                    using (ExcelRange range = worksheet.Cells[row, 2, row, 51]) {
                        int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                        int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                        vatInString = $" У т.ч. ПДВ: {totalVat.ToCompleteText(sale.ClientAgreement.Agreement.Currency.Code, true, true, true)}";

                        range.Value = $"{totalAmount.ToCompleteText(sale.ClientAgreement.Agreement.Currency.Code, true, true, true)} \r{vatInString}";

                        //range.Value =
                        //    $"{decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero).ToText(true, true)} гривень {(Math.Round(totalAmount % 1, 2) * 100).ToText(false, true, false)} {endKeyWord}\r{vatInString}";

                        range.Style.Font.Size = 9;
                        range.Style.Font.Bold = true;
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                        range.Style.WrapText = true;
                    }

                    break;
                }
            }

            worksheet.SetRowHeight(24.98, row);
            row++;

            using (ExcelRange range = worksheet.Cells[row, 2, row, 51]) {
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Medium;
            }

            worksheet.SetRowHeight(7.11, row);
            row++;

            worksheet.SetRowHeight(11.28, row);
            row++;

            using (ExcelRange range = worksheet.Cells[row, 29, row, 49]) {
                range.Merge = true;
                range.Value = "Виписав(ла): директор " + sale.ClientAgreement.Agreement.Organization.Manager;
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Thin;
            }

            row++;
            row++;

            worksheet.SetRowHeight(16.28, row);

            using (ExcelRange range = worksheet.Cells[row, 4, row, 49]) {
                range.Merge = true;
                range.Value = "Увага! Рахунок дійсний на протязі 3-х робочих днів";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                range.Style.Font.Size = 11;
                range.Style.Font.Bold = true;
                range.Style.Border.BorderAround(ExcelBorderStyle.Medium);
            }

            //Setting default font options
            using (ExcelRange range = worksheet.Cells[1, 1, worksheet.Dimension.End.Row, worksheet.Dimension.End.Column]) {
                range.Style.Font.Name = "Arial";
            }

            using (ExcelRange range = worksheet.Cells[7, 1, 13, 52]) {
                range.Style.Font.Name = "Times New Roman";
            }

            package.Workbook.Properties.Title = "77 Document";
            package.Workbook.Properties.Author = "Concord CRM";
            package.Workbook.Properties.Comments = "Auto-generated xlsx by Concord CRM";

            //Saving the file.
            package.Save();
        }

        return SaveFiles(fileName);
    }

    public (string xlsxFile, string pdfFile) ExportShipmentListForSale(string path, Sale sale, IEnumerable<DocumentMonth> months) {
        string fileName = Path.Combine(path, $"ShipmentList_{DateTime.Now.ToString("MM.yyyy")}_{Guid.NewGuid().ToString()}.xlsx");

        //Math.Round(Convert.ToDecimal(pricing.ExtraCharge.Value) * price / 100 + price, 14)
        decimal totalAmount = Math.Round(sale.Order.OrderItems.Sum(x => x.Product.CurrentLocalPrice * (1 - x.OneTimeDiscount / 100) * Convert.ToDecimal(x.Qty)), 2);

        DateTime current = DateTime.Now;

        using (ExcelPackage package = NewExcelPackage(fileName)) {
            ExcelWorksheet worksheet = package.Workbook.Worksheets.Add("Лист на пакування");

            worksheet.ApplyPrinterSettings(0.5m, 0.5m, 0.1m, 0.1m, 0.25m, 0.25m, true);

            worksheet.Cells.Style.Font.Name = "Arial";
            worksheet.Cells.Style.Font.Size = 8;
            worksheet.DefaultColWidth = 9.83;
            worksheet.DefaultRowHeight = 11.25;

            // Set Rows
            worksheet.SetRowHeight(3.75, new[] { 6, 8, 1, 4, 5 });
            worksheet.SetRowHeight(3.95, new[] { 20 });
            worksheet.SetRowHeight(12.75, new[] { 14, 15, 18, 11, 12, 13, 16, 18, 11 });
            worksheet.SetRowHeight(31, new[] { 7, 9, 19 });
            worksheet.SetRowHeight(22, 21);

            worksheet.SetRowHeight(45, 2);
            worksheet.SetRowHeight(29.5455, 3);

            //Set Columns
            worksheet.SetColumnWidth(0.83, new[] { 1, 34, 37 });
            worksheet.SetColumnWidth(2.33, new[] { 3, 9, 11, 13, 15 });
            worksheet.SetColumnWidth(3, new[] { 8, 10 });
            worksheet.SetColumnWidth(2.5, new[] { 12, 67 });
            worksheet.SetColumnWidth(0.66, new[] { 16, 28, 31 });
            worksheet.SetColumnWidth(0.33, new[] { 18, 23, 58, 60, 62, 64, 66, 68, 70, 72, 74, 76, 78 });
            worksheet.SetColumnWidth(0.5, new[] { 20, 22, 43 });
            worksheet.SetColumnWidth(0.16, new[] { 24, 27, 30, 33, 36, 39, 42, 45, 48 });
            worksheet.SetColumnWidth(1, new[] { 25, 57, 35, 41, 44, 47, 50, 51 });
            worksheet.SetColumnWidth(1.5, new[] { 26, 29, 32, 38, 41, 52, 54, 576, 61 });
            worksheet.SetColumnWidth(1.33, new[] { 40, 55 });
            worksheet.SetColumnWidth(1.83, new[] { 46, 71, 77 });
            worksheet.SetColumnWidth(2.16, new[] { 49, 59 });
            worksheet.SetColumnWidth(2, new[] { 14, 17, 21, 53, 56, 63, 65 });
            worksheet.SetColumnWidth(3, new[] { 69, 73, 75 });
            worksheet.SetColumnWidth(2.42, 19);
            worksheet.SetColumnWidth(2.75, 4);
            worksheet.SetColumnWidth(3, 5);
            worksheet.SetColumnWidth(3, 6);
            worksheet.SetColumnWidth(3.5, 7);
            worksheet.SetColumnWidth(2.9, 2);

            int row = 2;
            int column = 2;

            //Document header
            //Document header
            using (ExcelRange range = worksheet.Cells[row, column, row, column + 10]) {
                range.Merge = true;
                range.Value = "Перевізник:";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.UnderLine = true;
                range.Style.Font.Size = 14;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 11, row, column + 75]) {
                range.Merge = true;

                string value = sale.Transporter.Name;

                if (!string.IsNullOrEmpty(sale.DeliveryRecipientAddress.City))
                    value += ", " + sale.DeliveryRecipientAddress.City;
                if (!string.IsNullOrEmpty(sale.DeliveryRecipientAddress.Value))
                    value += ", " + sale.DeliveryRecipientAddress.Value;
                if (!string.IsNullOrEmpty(sale.DeliveryRecipientAddress.Department))
                    value += ", " + sale.DeliveryRecipientAddress.Department;
                if (!string.IsNullOrEmpty(sale.DeliveryRecipient.FullName))
                    value += ", " + sale.DeliveryRecipient.FullName;
                if (!string.IsNullOrEmpty(sale.DeliveryRecipient.MobilePhone))
                    value += ", " + sale.DeliveryRecipient.MobilePhone;

                range.Value = value;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Bold = true;

                if (value.Length < 150)
                    range.Style.Font.Size = 14;
                else
                    range.Style.Font.Size = 8;
                range.Style.WrapText = true;
                range.Merge = true;
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                string value = "Примітка: ";

                if (sale.IsCashOnDelivery) value += $" накладний платіж: {decimal.Round(sale.CashOnDeliveryAmount, 2, MidpointRounding.AwayFromZero)}. ";

                if (sale.CustomersOwnTtn != null) value += $" власне ТТН: {sale.CustomersOwnTtn.Number}. ";
                if (!string.IsNullOrEmpty(sale.Comment)) value += $" коментар: {sale.Comment}. ";

                range.Value = value;
                range.Merge = true;
                range.Style.Font.UnderLine = true;
                range.Style.Font.Size = 10;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            }

            //using (ExcelRange range = worksheet.Cells[row, column + 7, row, column + 75]) {
            //    range.Value = sale.Comment;
            //    range.Merge = true;
            //    range.Style.Font.Bold = true;
            //    range.Style.Font.Size = 10;
            //    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
            //    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            //}

            row++;

            using (ExcelRange range = worksheet.Cells[row, column - 1, row, column + 75]) {
                range.Style.Border.Bottom.Style = ExcelBorderStyle.MediumDashed;
            }

            row += 3;

            DateTime fromDate = sale.ChangedToInvoice.Value;

            //
            using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                range.Merge = true;
                string invoice = "Лист на пакування № {0} від {1} р.";
                if (sale.HistoryInvoiceEdit.Any() && sale.IsVatSale) invoice += "                Змінено";

                range.Value =
                    string.Format(
                        invoice,
                        sale.SaleNumber.Value,
                        $"{fromDate.Day} {months.FirstOrDefault(m => m.Number.Equals(fromDate.Month))?.Name.ToLower() ?? string.Empty} {fromDate.Year}"
                    );
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Medium;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 14;
            }

            row += 2;

            using (ExcelRange range = worksheet.Cells[row, column, row, column + 4]) {
                range.Merge = true;
                range.Value = "Постачальник:";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.UnderLine = true;
                range.Style.Font.Size = 9;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 6, row, column + 75]) {
                range.Merge = true;
                range.Value = sale.ClientAgreement.Agreement.Organization.FullName;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 14;
                range.Style.WrapText = true;

                if (sale.ClientAgreement.Agreement.Organization.FullName.Length > 80)
                    worksheet.SetRowHeight(40, row);
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column + 7, row, column + 75]) {
                range.Merge = true;
                string val = string.Empty;
                if (sale.ClientAgreement.Agreement.Organization.MainPaymentRegister != null) {
                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.AccountNumber))
                        val += $"П/р {sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.AccountNumber}, ";

                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.BankName))
                        val += $"у банку {sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.BankName}, ";

                    range.Value = val;
                } else {
                    range.Value = val;
                }

                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;

                if (string.IsNullOrEmpty(val))
                    worksheet.SetRowHeight(1, row);
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column + 7, row, column + 75]) {
                range.Merge = true;
                string val = string.Empty;

                if (sale.ClientAgreement.Agreement.Organization.MainPaymentRegister != null) {
                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.City))
                        val += $"м. {sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.City}, ";

                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.SortCode))
                        val += $"МФО {sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.SortCode}, ";

                    range.Value = val;
                } else {
                    range.Value = val;
                }

                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;

                if (string.IsNullOrEmpty(val))
                    worksheet.SetRowHeight(1, row);
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column + 7, row, column + 75]) {
                range.Merge = true;
                string val = string.Empty;

                if (sale.ClientAgreement.Agreement.Organization.MainPaymentRegister != null) {
                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.Address))
                        val += $"{sale.ClientAgreement.Agreement.Organization.Address}, ";
                    range.Value = val;
                } else {
                    range.Value = val;
                }

                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;

                if (string.IsNullOrEmpty(val))
                    worksheet.SetRowHeight(1, row);
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column + 7, row, column + 75]) {
                range.Merge = true;
                string val = string.Empty;

                if (sale.ClientAgreement.Agreement.Organization.MainPaymentRegister != null) {
                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.PhoneNumber))
                        val += $"тел.: {sale.ClientAgreement.Agreement.Organization.PhoneNumber}, ";

                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.USREOU))
                        val += $"код за ЄДРПОУ {sale.ClientAgreement.Agreement.Organization.USREOU}, ";

                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.TIN))
                        val += $"ІПН {sale.ClientAgreement.Agreement.Organization.TIN}";

                    range.Value = val;
                } else {
                    range.Value = val;
                }

                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;

                if (string.IsNullOrEmpty(val))
                    worksheet.SetRowHeight(1, row);
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column + 7, row, column + 75]) {
                range.Merge = true;
                string val = string.Empty;

                switch (sale.ClientAgreement.Agreement.Organization.TypeTaxation) {
                    case TypeTaxation.SingleTax:
                        val = "Є платником єдиного податку";
                        break;
                    case TypeTaxation.SingleTaxAndVat:
                        val = "Є платником єдиного податку та ПДВ";
                        break;
                    case TypeTaxation.IncomeTax:
                        val = "Є платником податку на прибуток";
                        break;
                    case TypeTaxation.IncomeTaxAndVat:
                        val = "Є платником податку на прибуток на загальних підставах";
                        break;
                    case TypeTaxation.NotPaying:
                        val = "Не є платником податку на прибуток на загальних підставах";
                        break;
                }

                range.Value = val;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
            }

            row += 2;
            using (ExcelRange range = worksheet.Cells[row, column, row, column + 4]) {
                range.Merge = true;
                range.Value = "Покупець:";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.UnderLine = true;
                range.Style.Font.Size = 9;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 6, row, column + 75]) {
                string buyer = string.Format(
                    "{0} {1}",
                    sale.RetailClient != null
                        ? sale.RetailClient.Name
                        : !string.IsNullOrEmpty(sale.ClientAgreement.Client.FullName)
                            ? sale.ClientAgreement.Client.FullName
                            : sale.ClientAgreement.Client.Name,
                    sale.RetailClient != null ? "" : "- " + sale.ClientAgreement.Client.RegionCode?.Value ?? ""
                );

                range.Merge = true;
                range.Value = buyer;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 11;
                range.Style.WrapText = true;

                if (buyer.Length > 80)
                    worksheet.SetRowHeight(24, row);
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column + 7, row, column + 75]) {
                string clientInfo = string.Empty;

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.RegionCode?.City)) clientInfo += $", {sale.ClientAgreement.Client.RegionCode.City}";

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.RegionCode?.District)) clientInfo += $", {sale.ClientAgreement.Client.RegionCode.District}";

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.ActualAddress)) clientInfo += $"{sale.ClientAgreement.Client.ActualAddress}";

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.MobileNumber)) clientInfo += $", тел.: {sale.ClientAgreement.Client.MobileNumber}";

                range.Merge = true;
                range.Value = clientInfo;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.WrapText = true;

                if (string.IsNullOrEmpty(clientInfo))
                    worksheet.SetRowHeight(1, row);

                if (clientInfo.Length > 80)
                    worksheet.SetRowHeight(24, row);
            }

            row += 2;
            //Table header
            int tableStartRow = row;

            using (ExcelRange range = worksheet.Cells[row, column, row + 1, column + 1]) {
                range.Value = "№";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 2, row + 1, column + 14]) {
                range.Value = "Артикул";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 15, row + 1, column + 23]) {
                range.Value = "Розм";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 24, row + 1, column + 48]) {
                range.Value = "Товар";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 49, row + 1, column + 60]) {
                range.Value = "Кількість";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 61, row + 1, column + 68]) {
                range.Value = "Ціна з ПДВ";
                range.Merge = true;
                range.SetTableHeaderStyle();
                range.Style.WrapText = true;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 69, row + 1, column + 76]) {
                range.Value = "Сума з ПДВ";
                range.Merge = true;
                range.SetTableHeaderStyle();
                range.Style.WrapText = true;
            }

            row += 2;

            //Table body

            int tableRowNumber = 1;

            foreach (OrderItem item in sale.Order.OrderItems) {
                bool specialItem =
                    item.Product.IsForSale || item.Product.IsForZeroSale || item.Product.Top.ToUpper().Equals("X9") || item.Product.Top.ToUpper().Equals("Х9");

                if (specialItem) {
                    if (item.ProductLocations.Any() || item.ProductLocationsHistory.Any()) {
                        foreach (ProductLocation location in item.ProductLocations) {
                            foreach (ProductLocationHistory locationHistory in item.ProductLocationsHistory.Where(x => x.TypeOfMovement == TypeOfMovement.Return))
                                if (location.ProductPlacementId == locationHistory.ProductPlacementId) {
                                    location.Qty += locationHistory.Qty;
                                    locationHistory.Qty = 0;
                                }

                            //Special OrderItem
                            using (ExcelRange range = worksheet.Cells[row, column]) {
                                range.Value = tableRowNumber;
                                range.Style.Font.Size = 9;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            //Special mark * 
                            using (ExcelRange range = worksheet.Cells[row, column + 1]) {
                                range.Value = "*";
                                range.Style.Font.Size = 22;
                                range.Style.Font.Bold = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 14]) {
                                range.Value = item.Product.VendorCode;
                                range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 14;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 15, row, column + 23]) {
                                string locationAddress =
                                    location.ProductPlacement.StorageNumber +
                                    "-" +
                                    (
                                        string.IsNullOrEmpty(location.ProductPlacement.RowNumber)
                                            ? string.Empty
                                            : $"{location.ProductPlacement.RowNumber}-"
                                    ) +
                                    location.ProductPlacement.CellNumber;

                                range.Value = locationAddress;
                                range.Style.Font.Size = 10;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 24, row, column + 48]) {
                                range.Value = item.Product.Name;
                                range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                range.Merge = true;
                                range.Style.WrapText = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                range.Value = location.Qty;
                                range.Style.Font.Size = 16;
                                range.Style.Font.Bold = true;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                range.Value = item.Product.MeasureUnit?.Name;
                                range.Style.Font.Size = 11;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                //ToDo: local price
                                range.Value =
                                    decimal.Round(
                                        item.Product.CurrentLocalPrice * (1 - item.OneTimeDiscount / 100),
                                        2,
                                        MidpointRounding.AwayFromZero
                                    );
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                //ToDo: local price
                                range.Value =
                                    decimal.Round(
                                        item.Product.CurrentLocalPrice * (1 - item.OneTimeDiscount / 100) * Convert.ToDecimal(location.Qty),
                                        2,
                                        MidpointRounding.AwayFromZero
                                    );
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            if (item.Product.Name.Length > 18) {
                                if (item.Product.Name.Length < 35)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);
                            }

                            if (item.Product.VendorCode.Length > 10)
                                worksheet.SetRowHeight(35, row);
                            else
                                worksheet.SetRowHeight(28, row);

                            row++;
                        }

                        if (item.ProductLocationsHistory.Any())
                            foreach (ProductLocationHistory location in item.ProductLocationsHistory.Where(x => x.Qty != 0)) {
                                //Special OrderItem
                                using (ExcelRange range = worksheet.Cells[row, column]) {
                                    range.Value = tableRowNumber;
                                    range.Style.Font.Size = 9;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                //Special mark * 
                                using (ExcelRange range = worksheet.Cells[row, column + 1]) {
                                    range.Value = "*";
                                    range.Style.Font.Size = 22;
                                    range.Style.Font.Bold = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 14]) {
                                    range.Value = item.Product.VendorCode;
                                    range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 14;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 15, row, column + 23]) {
                                    string locationAddress =
                                        location.ProductPlacement.StorageNumber +
                                        "-" +
                                        (
                                            string.IsNullOrEmpty(location.ProductPlacement.RowNumber)
                                                ? string.Empty
                                                : $"{location.ProductPlacement.RowNumber}-"
                                        ) +
                                        location.ProductPlacement.CellNumber;

                                    range.Value = locationAddress;
                                    range.Style.Font.Size = 10;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 24, row, column + 48]) {
                                    range.Value = item.Product.Name;
                                    range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                    range.Merge = true;
                                    range.Style.WrapText = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                    range.Value = location.Qty;
                                    range.Style.Font.Size = 16;
                                    range.Style.Font.Bold = true;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                    range.Value = item.Product.MeasureUnit?.Name;
                                    range.Style.Font.Size = 11;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                    //ToDo: local price
                                    range.Value =
                                        decimal.Round(
                                            item.Product.CurrentLocalPrice * (1 - item.OneTimeDiscount / 100),
                                            2,
                                            MidpointRounding.AwayFromZero
                                        );
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                    //ToDo: local price
                                    range.Value =
                                        decimal.Round(
                                            item.Product.CurrentLocalPrice * (1 - item.OneTimeDiscount / 100) * Convert.ToDecimal(item.Qty),
                                            2,
                                            MidpointRounding.AwayFromZero
                                        );
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                if (item.Product.Name.Length > 18) {
                                    if (item.Product.Name.Length < 35)
                                        worksheet.SetRowHeight(28, row);
                                    else
                                        worksheet.SetRowHeight(35, row);
                                }

                                if (item.Product.VendorCode.Length > 10)
                                    worksheet.SetRowHeight(35, row);
                                else
                                    worksheet.SetRowHeight(28, row);

                                row++;
                            }

                        if (item.ProductLocations.Sum(l => l.Qty) + item.ProductLocationsHistory.Sum(g => g.Qty) < item.Qty) {
                            //Special OrderItem
                            using (ExcelRange range = worksheet.Cells[row, column]) {
                                range.Value = tableRowNumber;
                                range.Style.Font.Size = 9;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            //Special mark * 
                            using (ExcelRange range = worksheet.Cells[row, column + 1]) {
                                range.Value = "*";
                                range.Style.Font.Size = 22;
                                range.Style.Font.Bold = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 14]) {
                                range.Value = item.Product.VendorCode;
                                range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 14;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }


                            using (ExcelRange range = worksheet.Cells[row, column + 15, row, column + 23]) {
                                range.Value = string.Empty;
                                range.Style.Font.Size = 10;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 24, row, column + 48]) {
                                range.Value = item.Product.Name;
                                range.Merge = true;
                                range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                range.Style.WrapText = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                range.Value = item.Qty - (item.ProductLocations.Sum(l => l.Qty) + item.ProductLocationsHistory.Sum(g => g.Qty));
                                range.Style.Font.Size = 16;
                                range.Style.Font.Bold = true;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                range.Value = item.Product.MeasureUnit?.Name;
                                range.Style.Font.Size = 11;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                //ToDo: local price
                                range.Value =
                                    decimal.Round(
                                        item.Product.CurrentLocalPrice * (1 - item.OneTimeDiscount / 100),
                                        2,
                                        MidpointRounding.AwayFromZero
                                    );
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                //ToDo: local price
                                range.Value =
                                    decimal.Round(
                                        item.Product.CurrentLocalPrice * (1 - item.OneTimeDiscount / 100) * Convert.ToDecimal(item.Qty),
                                        2,
                                        MidpointRounding.AwayFromZero
                                    );
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            if (item.Product.Name.Length > 18) {
                                if (item.Product.Name.Length < 35)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);
                            }

                            if (item.Product.VendorCode.Length > 10)
                                worksheet.SetRowHeight(35, row);
                            else
                                worksheet.SetRowHeight(28, row);

                            row++;
                        }
                    } else {
                        //Special OrderItem
                        using (ExcelRange range = worksheet.Cells[row, column]) {
                            range.Value = tableRowNumber;
                            range.Style.Font.Size = 9;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        //Special mark * 
                        using (ExcelRange range = worksheet.Cells[row, column + 1]) {
                            range.Value = "*";
                            range.Style.Font.Size = 22;
                            range.Style.Font.Bold = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 14]) {
                            range.Value = item.Product.VendorCode;
                            range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 14;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 15, row, column + 23]) {
                            range.Value = string.Empty;
                            range.Style.Font.Size = 10;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 24, row, column + 48]) {
                            range.Value = item.Product.Name;
                            range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                            range.Merge = true;
                            range.Style.WrapText = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                            range.Value = item.Qty;
                            range.Style.Font.Size = 16;
                            range.Style.Font.Bold = true;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                            range.Value = item.Product.MeasureUnit?.Name;
                            range.Style.Font.Size = 11;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                            //ToDo: local price
                            range.Value =
                                decimal.Round(
                                    item.Product.CurrentLocalPrice * (1 - item.OneTimeDiscount / 100),
                                    2,
                                    MidpointRounding.AwayFromZero
                                );
                            range.Style.Font.Size = 11;
                            range.Style.Numberformat.Format = "0.00";
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                            //ToDo: local price
                            range.Value =
                                decimal.Round(
                                    item.Product.CurrentLocalPrice * (1 - item.OneTimeDiscount / 100) * Convert.ToDecimal(item.Qty),
                                    2,
                                    MidpointRounding.AwayFromZero
                                );
                            range.Style.Font.Size = 11;
                            range.Style.Numberformat.Format = "0.00";
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        if (item.Product.Name.Length > 18) {
                            if (item.Product.Name.Length < 35)
                                worksheet.SetRowHeight(28, row);
                            else
                                worksheet.SetRowHeight(35, row);
                        }

                        if (item.Product.VendorCode.Length > 10)
                            worksheet.SetRowHeight(35, row);
                        else
                            worksheet.SetRowHeight(28, row);

                        row++;
                    }
                } else {
                    if (item.ProductLocations.Any() || item.ProductLocationsHistory.Any()) {
                        foreach (ProductLocation location in item.ProductLocations) {
                            foreach (ProductLocationHistory locationHistory in item.ProductLocationsHistory.Where(x => x.TypeOfMovement == TypeOfMovement.Return))
                                if (location.ProductPlacementId == locationHistory.ProductPlacementId) {
                                    location.Qty += locationHistory.Qty;
                                    locationHistory.Qty = 0;
                                }

                            //Simple  OrderItem
                            using (ExcelRange range = worksheet.Cells[row, column, row, column + 1]) {
                                range.Value = tableRowNumber;
                                range.Style.Font.Size = 9;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 14]) {
                                range.Value = item.Product.VendorCode;
                                range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 14;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 15, row, column + 23]) {
                                string locationAddress =
                                    location.ProductPlacement.StorageNumber +
                                    "-" +
                                    (
                                        string.IsNullOrEmpty(location.ProductPlacement.RowNumber)
                                            ? string.Empty
                                            : $"{location.ProductPlacement.RowNumber}-"
                                    ) +
                                    location.ProductPlacement.CellNumber;

                                range.Value = locationAddress;
                                range.Style.Font.Size = 10;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 24, row, column + 48]) {
                                range.Value = item.Product.Name;
                                range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                range.Merge = true;
                                range.Style.WrapText = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                range.Value = location.Qty;
                                range.Style.Font.Size = 16;
                                range.Style.Font.Bold = true;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                range.Value = item.Product.MeasureUnit?.Name;
                                range.Style.Font.Size = 11;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                //ToDo: local price
                                range.Value =
                                    decimal.Round(
                                        item.Product.CurrentLocalPrice * (1 - item.OneTimeDiscount / 100),
                                        2,
                                        MidpointRounding.AwayFromZero
                                    );
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                //ToDo: local price
                                range.Value =
                                    decimal.Round(
                                        item.Product.CurrentLocalPrice * (1 - item.OneTimeDiscount / 100) * Convert.ToDecimal(location.Qty),
                                        2,
                                        MidpointRounding.AwayFromZero
                                    );
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            if (item.Product.Name.Length > 18) {
                                if (item.Product.Name.Length < 35)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);
                            }

                            if (item.Product.VendorCode.Length > 10)
                                worksheet.SetRowHeight(35, row);
                            else
                                worksheet.SetRowHeight(28, row);

                            row++;
                        }

                        if (item.ProductLocationsHistory.Any())
                            foreach (ProductLocationHistory location in item.ProductLocationsHistory.Where(x => x.Qty != 0)) {
                                //Special OrderItem
                                using (ExcelRange range = worksheet.Cells[row, column, row, column + 1]) {
                                    range.Value = tableRowNumber;
                                    range.Style.Font.Size = 9;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 14]) {
                                    range.Value = item.Product.VendorCode;
                                    range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 14;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 15, row, column + 23]) {
                                    string locationAddress =
                                        location.ProductPlacement.StorageNumber +
                                        "-" +
                                        (
                                            string.IsNullOrEmpty(location.ProductPlacement.RowNumber)
                                                ? string.Empty
                                                : $"{location.ProductPlacement.RowNumber}-"
                                        ) +
                                        location.ProductPlacement.CellNumber;

                                    range.Value = locationAddress;
                                    range.Style.Font.Size = 10;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 24, row, column + 48]) {
                                    range.Value = item.Product.Name;
                                    range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                    range.Merge = true;
                                    range.Style.WrapText = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                    range.Value = location.Qty;
                                    range.Style.Font.Size = 16;
                                    range.Style.Font.Bold = true;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                    range.Value = item.Product.MeasureUnit?.Name;
                                    range.Style.Font.Size = 11;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                    //ToDo: local price
                                    range.Value =
                                        decimal.Round(
                                            item.Product.CurrentLocalPrice * (1 - item.OneTimeDiscount / 100),
                                            2,
                                            MidpointRounding.AwayFromZero
                                        );
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                    //ToDo: local price
                                    range.Value =
                                        decimal.Round(
                                            item.Product.CurrentLocalPrice * (1 - item.OneTimeDiscount / 100) * Convert.ToDecimal(location.Qty),
                                            2,
                                            MidpointRounding.AwayFromZero
                                        );
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                if (item.Product.Name.Length > 18) {
                                    if (item.Product.Name.Length < 35)
                                        worksheet.SetRowHeight(28, row);
                                    else
                                        worksheet.SetRowHeight(35, row);
                                }

                                if (item.Product.VendorCode.Length > 10)
                                    worksheet.SetRowHeight(35, row);
                                else
                                    worksheet.SetRowHeight(28, row);

                                row++;
                            }

                        if (item.ProductLocations.Sum(l => l.Qty) + item.ProductLocationsHistory.Sum(g => g.Qty) < item.Qty) {
                            //Simple  OrderItem
                            using (ExcelRange range = worksheet.Cells[row, column, row, column + 1]) {
                                range.Value = tableRowNumber;
                                range.Style.Font.Size = 9;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 14]) {
                                range.Value = item.Product.VendorCode;
                                range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 14;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 15, row, column + 23]) {
                                range.Value = string.Empty;
                                range.Style.Font.Size = 10;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 24, row, column + 48]) {
                                range.Value = item.Product.Name;
                                range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                range.Merge = true;
                                range.Style.WrapText = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                range.Value = item.Qty - (item.ProductLocations.Sum(l => l.Qty) + item.ProductLocationsHistory.Sum(g => g.Qty));
                                range.Style.Font.Size = 16;
                                range.Style.Font.Bold = true;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                range.Value = item.Product.MeasureUnit?.Name;
                                range.Style.Font.Size = 11;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                //ToDo: local price
                                range.Value =
                                    decimal.Round(
                                        item.Product.CurrentLocalPrice * (1 - item.OneTimeDiscount / 100),
                                        2,
                                        MidpointRounding.AwayFromZero
                                    );
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                //ToDo: local price
                                range.Value =
                                    decimal.Round(
                                        item.Product.CurrentLocalPrice * (1 - item.OneTimeDiscount / 100) * Convert.ToDecimal(item.Qty),
                                        2,
                                        MidpointRounding.AwayFromZero
                                    );
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            if (item.Product.Name.Length > 18) {
                                if (item.Product.Name.Length < 35)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);
                            }

                            if (item.Product.VendorCode.Length > 10)
                                worksheet.SetRowHeight(35, row);
                            else
                                worksheet.SetRowHeight(28, row);

                            row++;
                        }
                    } else {
                        //Simple  OrderItem
                        using (ExcelRange range = worksheet.Cells[row, column, row, column + 1]) {
                            range.Value = tableRowNumber;
                            range.Style.Font.Size = 9;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 14]) {
                            range.Value = item.Product.VendorCode;
                            range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 14;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 15, row, column + 23]) {
                            range.Value = item.AssignedSpecification?.SpecificationCode;
                            range.Style.Font.Size = 10;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 24, row, column + 48]) {
                            range.Value = item.Product.Name;
                            range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                            range.Merge = true;
                            range.Style.WrapText = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                            range.Value = item.Qty;
                            range.Style.Font.Size = 16;
                            range.Style.Font.Bold = true;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                            range.Value = item.Product.MeasureUnit?.Name;
                            range.Style.Font.Size = 11;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                            //ToDo: local price
                            range.Value =
                                decimal.Round(
                                    item.Product.CurrentLocalPrice * (1 - item.OneTimeDiscount / 100),
                                    2,
                                    MidpointRounding.AwayFromZero
                                );
                            range.Style.Font.Size = 11;
                            range.Style.Numberformat.Format = "0.00";
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                            //ToDo: local price
                            range.Value =
                                decimal.Round(
                                    item.Product.CurrentLocalPrice * (1 - item.OneTimeDiscount / 100) * Convert.ToDecimal(item.Qty),
                                    2,
                                    MidpointRounding.AwayFromZero
                                );
                            range.Style.Font.Size = 11;
                            range.Style.Numberformat.Format = "0.00";
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        if (item.Product.Name.Length > 18) {
                            if (item.Product.Name.Length < 35)
                                worksheet.SetRowHeight(28, row);
                            else
                                worksheet.SetRowHeight(35, row);
                        }

                        if (item.Product.VendorCode.Length > 10)
                            worksheet.SetRowHeight(35, row);
                        else
                            worksheet.SetRowHeight(28, row);

                        row++;
                    }
                }

                tableRowNumber++;
            }

            int tableEndRow = row - 1;

            using (ExcelRange range = worksheet.Cells[tableStartRow, column, tableEndRow, column + 76]) {
                range.Style.Border.BorderAround(ExcelBorderStyle.Medium);
            }

            worksheet.SetRowHeight(6.95, row);
            worksheet.SetRowHeight(15, ++row);

            using (ExcelRange range = worksheet.Cells[row, column, row, column + 23]) {
                range.Value = $"{DateTime.Now.ToString("dd.MM.yyyy HH.mm.ss")} {sale.ClientAgreement.Agreement.Organization.Manager}";
                range.Style.Font.Size = 7;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 60, row, column + 66]) {
                range.Value = "Разом:";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 68, row, column + 75]) {
                range.Value = totalAmount;
                range.Style.Font.Size = 11;
                range.Style.Numberformat.Format = "0.00";
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column + 52, row, column + 66]) {
                range.Value = "У тому числі ПДВ:";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 68, row, column + 75]) {
                decimal vatRate =
                    sale.ClientAgreement.Agreement.Organization.VatRate != null
                        ? Convert.ToDecimal(sale.ClientAgreement.Agreement.Organization.VatRate.Value) / 100
                        : 0;

                range.Value = decimal.Round(totalAmount * (vatRate / (1 + vatRate)), 2, MidpointRounding.AwayFromZero);
                range.Style.Font.Size = 11;
                range.Style.Numberformat.Format = "0.00";
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            worksheet.SetRowHeight(6.95, ++row);
            worksheet.SetRowHeight(11.25, ++row);

            if (sale.ClientAgreement.Agreement.Currency.Code.ToLower().Equals("eur")) {
                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {totalAmount} EUR.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheet.SetRowHeight(12.75, ++row);

                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    int fullNumber = Convert.ToInt32(Math.Round(totalAmount % 1, 2) * 100);
                    int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                    string endKeyWord;

                    if (fullNumber > 10 && fullNumber < 20)
                        endKeyWord = "центів";
                    else
                        switch (endNumber) {
                            case 1:
                                endKeyWord = "цент";
                                break;
                            case 2:
                            case 3:
                            case 4:
                                endKeyWord = "цента";
                                break;
                            default:
                                endKeyWord = "центів";
                                break;
                        }

                    range.Value = $"{totalAmount.ToText(true, true)} євро {(Math.Round(totalAmount % 1, 2) * 100).ToText(false, true)} {endKeyWord}";
                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            } else if (sale.ClientAgreement.Agreement.Currency.Code.ToLower().Equals("usd")) {
                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {totalAmount} USD.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheet.SetRowHeight(12.75, ++row);

                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    int fullNumber = Convert.ToInt32(Math.Round(totalAmount % 1, 2) * 100);
                    int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                    string endKeyWord;

                    if (fullNumber > 10 && fullNumber < 20)
                        endKeyWord = "центів";
                    else
                        switch (endNumber) {
                            case 1:
                                endKeyWord = "цент";
                                break;
                            case 2:
                            case 3:
                            case 4:
                                endKeyWord = "цента";
                                break;
                            default:
                                endKeyWord = "центів";
                                break;
                        }

                    range.Value = $"{totalAmount.ToText(true, true)} доларів {(Math.Round(totalAmount % 1, 2) * 100).ToText(false, true)} {endKeyWord}";
                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            } else if (sale.ClientAgreement.Agreement.Currency.Code.ToLower().Equals("pln")) {
                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero)} PLN.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheet.SetRowHeight(12.75, ++row);

                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                    int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                    string endKeyWord;

                    if (fullNumber > 10 && fullNumber < 20)
                        endKeyWord = "грошів";
                    else
                        switch (endNumber) {
                            case 1:
                                endKeyWord = "грош";
                                break;
                            case 2:
                            case 3:
                            case 4:
                                endKeyWord = "гроша";
                                break;
                            default:
                                endKeyWord = "грошів";
                                break;
                        }

                    range.Value =
                        $"{decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero).ToText(true, true)} злотих {(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100).ToText(false, true)} {endKeyWord}";
                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            } else {
                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {Math.Round(totalAmount, 2, MidpointRounding.AwayFromZero)} ГРН.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheet.SetRowHeight(12.75, ++row);

                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    range.Value = $"{totalAmount.ToCompleteText(sale.ClientAgreement.Agreement.Currency.Code, true, true, true)}";
                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            }

            worksheet.SetRowHeight(6.95, ++row);
            using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Medium;
            }

            row++;

            worksheet.SetRowHeight(12.75, ++row);

            using (ExcelRange range = worksheet.Cells[row, column, row, column + 5]) {
                range.Value = "Відвантажив(ла): ";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 6, row, column + 29]) {
                range.Value = "директор " + sale.ClientAgreement.Agreement.Organization.Manager;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            using (ExcelRange range = worksheet.Cells[row + 1, column + 6, row + 1, column + 29]) {
                range.Style.Border.Top.Style = ExcelBorderStyle.Thin;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 36, row, column + 51]) {
                range.Value = "Отримав(ла):";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 52, row, column + 73]) {
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Thin;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            worksheet.SetRowHeight(14.75, ++row);
            worksheet.SetRowHeight(14.75, row + 1);

            worksheet.SetRowHeight(6.95, ++row);
            worksheet.SetRowHeight(12.75, ++row);

            //Remark

            if (sale.Order.OrderItems.Any(x => x.OneTimeDiscount > 0)) {
                worksheet.SetRowHeight(24, ++row);

                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    range.Value = "* - замовлений або акційний товар поверненню не підлягає";
                    range.Style.Font.Size = 18;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }

                row++;
            }

            worksheet.SetRowHeight(12.75, ++row);

            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 75]) {
                range.Value = "Вимоги до повернень";
                range.Style.Font.Size = 10;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            }

            row++;
            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 75]) {
                range.Value = "1)Товар має бути запакований";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            row++;
            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 75]) {
                range.Value = "2)Коробка даного товару і сам товар мають бути без пошкоджень";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            row++;
            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 75]) {
                range.Value = "3)Повинні бути документи на повернення: від кого і причина повернення в письмовому вигляді";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            row++;
            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 75]) {
                range.Value = "4)Товар не буде прийматися, якщо вказане не буде виконано, і в цьому випадку товар буде відправлено назад покупцеві.";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            package.Workbook.Properties.Title = "Лист на пакування";
            package.Workbook.Properties.Author = "Concord CRM";
            package.Workbook.Properties.Comments = "Auto-generated xlsx by Concord CRM";

            package.Save();
        }

        return SaveFiles(fileName);
    }

    public (string xlsxFile, string pdfFile) ExportUkDocumentPackageIsVatSaleToXlsx(string path, Sale sale, IEnumerable<DocumentMonth> months) {
        string fileName = Path.Combine(path, $"{sale.SaleInvoiceNumber.Number}_{DateTime.Now.ToString("MM.yyyy")}_{Guid.NewGuid().ToString()}.xlsx");

        DateTime current = DateTime.Now;

        using (ExcelPackage package = NewExcelPackage(fileName)) {
            ExcelWorksheet worksheetPayment = package.Workbook.Worksheets.Add("VAT_Invoice");

            //Set printer settings
            worksheetPayment.ApplyPrinterSettings(0.3m, 0.3m, 0.1m, 0.1m, 0.3m, 0.3m, true);

            //Set column's width
            worksheetPayment.SetColumnWidth(0.55, 1);
            worksheetPayment.SetColumnWidth(0.44, 2);
            worksheetPayment.SetColumnWidth(2.55, 3);
            worksheetPayment.SetColumnWidth(2.99, 4);
            worksheetPayment.SetColumnWidth(2.66, 5);
            worksheetPayment.SetColumnWidth(0.66, 6);
            worksheetPayment.SetColumnWidth(1.99, 7);
            worksheetPayment.SetColumnWidth(2.66, 8);
            worksheetPayment.SetColumnWidth(1.99, 9);
            worksheetPayment.SetColumnWidth(1.99, 10);
            worksheetPayment.SetColumnWidth(1.99, 11);
            worksheetPayment.SetColumnWidth(1.99, 12);
            worksheetPayment.SetColumnWidth(1.99, 13);
            worksheetPayment.SetColumnWidth(1.99, 14);
            worksheetPayment.SetColumnWidth(1.22, 15);
            worksheetPayment.SetColumnWidth(1.66, 16);
            worksheetPayment.SetColumnWidth(2.66, 17);
            worksheetPayment.SetColumnWidth(0.55, 18);
            worksheetPayment.SetColumnWidth(2.11, 19);
            worksheetPayment.SetColumnWidth(2.66, 20);
            worksheetPayment.SetColumnWidth(2.66, 21);
            worksheetPayment.SetColumnWidth(1.44, 22);
            worksheetPayment.SetColumnWidth(1.22, 23);
            worksheetPayment.SetColumnWidth(1.11, 24);
            worksheetPayment.SetColumnWidth(1.55, 25);
            worksheetPayment.SetColumnWidth(2.66, 26);
            worksheetPayment.SetColumnWidth(1.88, 27);
            worksheetPayment.SetColumnWidth(0.88, 28);
            worksheetPayment.SetColumnWidth(2.66, 29);
            worksheetPayment.SetColumnWidth(0.99, 30);
            worksheetPayment.SetColumnWidth(1.66, 31);
            worksheetPayment.SetColumnWidth(0.22, 32);
            worksheetPayment.SetColumnWidth(2.66, 33);
            worksheetPayment.SetColumnWidth(2.99, 34);
            worksheetPayment.SetColumnWidth(1.22, 35);
            worksheetPayment.SetColumnWidth(1.55, 36);
            worksheetPayment.SetColumnWidth(2.99, 37);
            worksheetPayment.SetColumnWidth(2.99, 38);
            worksheetPayment.SetColumnWidth(2.99, 39);
            worksheetPayment.SetColumnWidth(2.99, 40);
            worksheetPayment.SetColumnWidth(2.55, 41);
            worksheetPayment.SetColumnWidth(0.11, 42);
            worksheetPayment.SetColumnWidth(2.99, 43);
            worksheetPayment.SetColumnWidth(2.11, 44);
            worksheetPayment.SetColumnWidth(0.66, 45);
            worksheetPayment.SetColumnWidth(2.99, 46);
            worksheetPayment.SetColumnWidth(2.99, 47);
            worksheetPayment.SetColumnWidth(2.88, 48);
            worksheetPayment.SetColumnWidth(2.55, 49);
            worksheetPayment.SetColumnWidth(2.22, 50);
            worksheetPayment.SetColumnWidth(0.55, 51);
            worksheetPayment.SetColumnWidth(0.22, 52);

            worksheetPayment.SetRowHeight(4.38, new[] { 11, 20, 25, 24 }); //5
            worksheetPayment.SetRowHeight(6.38, new[] { 4, 6, 13 }); //8
            worksheetPayment.SetRowHeight(11.28, new[] { 1, 2, 3, 8, 15, 17 /*28, 34, 37*/ }); //15
            worksheetPayment.SetRowHeight(11.98, new[] { 10, 22, 23, 26, 27, 25 }); //16
            worksheetPayment.SetRowHeight(12.78, new[] { 9, 14, 18, 21 /*31, 32, 38*/ }); //17
            worksheetPayment.SetRowHeight(16.28, new[] { 5 }); //21
            worksheetPayment.SetRowHeight(21.28, new[] { 16 }); //28
            worksheetPayment.SetRowHeight(28, new[] { 12 /*, 29*/ }); //29
            worksheetPayment.SetRowHeight(24.38, new[] { 7 }); //32
            worksheetPayment.SetRowHeight(34.48, new[] { 19 }); //46

            using (ExcelRange range = worksheetPayment.Cells[1, 5, 3, 47]) {
                range.Merge = true;
                range.Value =
                    "Увага! Оплата цього рахунку означає погодження з умовами поставки товарів. Повідомлення про оплату є обов'язковим, в іншому випадку не гарантується наявність товарів на складі. Товар відпускається за фактом надходження коштів на п/р Постачальника, самовивозом, за наявності довіреності та паспорта.";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 8;
                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
            }

            using (ExcelRange range = worksheetPayment.Cells[5, 3, 5, 50]) {
                range.Merge = true;
                range.Value = "Зразок заповнення платіжного доручення";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
            }

            using (ExcelRange range = worksheetPayment.Cells[7, 3, 7, 6]) {
                range.Merge = true;
                range.Value = "Одержувач";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                range.Style.Font.Size = 9;
            }

            using (ExcelRange range = worksheetPayment.Cells[7, 7, 7, 30]) {
                range.Merge = true;
                range.Value = sale.ClientAgreement.Agreement.Organization.FullName;
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
            }

            using (ExcelRange range = worksheetPayment.Cells[8, 3, 9, 6]) {
                range.Merge = true;
                range.Value = "Код";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
            }

            using (ExcelRange range = worksheetPayment.Cells[8, 7, 9, 15]) {
                range.Merge = true;
                range.Value = sale.ClientAgreement.Agreement.Organization.TIN;
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Style.Border.BorderAround(ExcelBorderStyle.Medium);
            }

            using (ExcelRange range = worksheetPayment.Cells[10, 3, 10, 10]) {
                range.Merge = true;
                range.Value = "Банк одержувача";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                range.Style.Font.Size = 9;
            }

            using (ExcelRange range = worksheetPayment.Cells[10, 25, 10, 30]) {
                range.Merge = true;
                range.Value = "Код банку";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                range.Style.Font.Size = 9;
            }

            using (ExcelRange range = worksheetPayment.Cells[12, 3, 12, 24]) {
                range.Merge = true;
                range.Value =
                    $"{sale.ClientAgreement.Agreement.Organization.MainPaymentRegister?.BankName ?? string.Empty} {sale.ClientAgreement.Agreement.Organization.MainPaymentRegister?.City ?? string.Empty}";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Thin;
            }

            using (ExcelRange range = worksheetPayment.Cells[12, 25, 12, 30]) {
                range.Merge = true;
                range.Value = sale.ClientAgreement.Agreement.Organization.MainPaymentRegister?.SortCode ?? string.Empty;
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
            }

            using (ExcelRange range = worksheetPayment.Cells[11, 25, 12, 30]) {
                range.Style.Border.BorderAround(ExcelBorderStyle.Medium);
            }

            using (ExcelRange range = worksheetPayment.Cells[8, 33, 8, 44]) {
                range.Merge = true;
                range.Value = "КРЕДИТ рах. N";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
            }

            using (ExcelRange range = worksheetPayment.Cells[9, 33, 10, 44]) {
                range.Merge = true;
                range.Value = sale.ClientAgreement.Agreement.Organization.MainPaymentRegister?.AccountNumber ?? string.Empty;
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Style.Border.BorderAround(ExcelBorderStyle.Medium);
            }

            using (ExcelRange range = worksheetPayment.Cells[11, 33, 12, 44]) {
                range.Style.Border.BorderAround(ExcelBorderStyle.Medium);
            }

            using (ExcelRange range = worksheetPayment.Cells[7, 45, 12, 50]) {
                range.Merge = true;
                range.Style.Border.Left.Style = ExcelBorderStyle.Medium;
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Medium;
            }

            using (ExcelRange range = worksheetPayment.Cells[5, 3, 13, 50]) {
                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
            }

            string dateFormated = string.Empty;

            dateFormated += $"{sale.BillDownloadDate.Value.Day} ";

            switch (sale.BillDownloadDate.Value.Month) {
                case 1:
                    dateFormated += "січня ";
                    break;
                case 2:
                    dateFormated += "лютого ";
                    break;
                case 3:
                    dateFormated += "березня ";
                    break;
                case 4:
                    dateFormated += "квітня ";
                    break;
                case 5:
                    dateFormated += "травня ";
                    break;
                case 6:
                    dateFormated += "червня ";
                    break;
                case 7:
                    dateFormated += "липня ";
                    break;
                case 8:
                    dateFormated += "серпня ";
                    break;
                case 9:
                    dateFormated += "вересня ";
                    break;
                case 10:
                    dateFormated += "жовтня ";
                    break;
                case 11:
                    dateFormated += "листопада ";
                    break;
                case 12:
                    dateFormated += "грудня ";
                    break;
            }

            dateFormated += $"{sale.BillDownloadDate.Value.Year} ";

            //if (sale.ChangedToInvoice.HasValue) {
            //    dateFormated += $"{sale.ChangedToInvoice?.Day} ";

            //    switch (sale.ChangedToInvoice?.Month) {
            //        case 1:
            //            dateFormated += "січня ";
            //            break;
            //        case 2:
            //            dateFormated += "лютого ";
            //            break;
            //        case 3:
            //            dateFormated += "березня ";
            //            break;
            //        case 4:
            //            dateFormated += "квітня ";
            //            break;
            //        case 5:
            //            dateFormated += "травня ";
            //            break;
            //        case 6:
            //            dateFormated += "червня ";
            //            break;
            //        case 7:
            //            dateFormated += "липня ";
            //            break;
            //        case 8:
            //            dateFormated += "серпня ";
            //            break;
            //        case 9:
            //            dateFormated += "вересня ";
            //            break;
            //        case 10:
            //            dateFormated += "жовтня ";
            //            break;
            //        case 11:
            //            dateFormated += "листопада ";
            //            break;
            //        case 12:
            //            dateFormated += "грудня ";
            //            break;
            //        default:
            //            break;
            //    }

            //    dateFormated += $"{sale.ChangedToInvoice?.Year} ";
            //} else {
            //    dateFormated += $"{sale.Updated.Day} ";

            //    switch (sale.Updated.Month) {
            //        case 1:
            //            dateFormated += "січня ";
            //            break;
            //        case 2:
            //            dateFormated += "лютого ";
            //            break;
            //        case 3:
            //            dateFormated += "березня ";
            //            break;
            //        case 4:
            //            dateFormated += "квітня ";
            //            break;
            //        case 5:
            //            dateFormated += "травня ";
            //            break;
            //        case 6:
            //            dateFormated += "червня ";
            //            break;
            //        case 7:
            //            dateFormated += "липня ";
            //            break;
            //        case 8:
            //            dateFormated += "серпня ";
            //            break;
            //        case 9:
            //            dateFormated += "вересня ";
            //            break;
            //        case 10:
            //            dateFormated += "жовтня ";
            //            break;
            //        case 11:
            //            dateFormated += "листопада ";
            //            break;
            //        case 12:
            //            dateFormated += "грудня ";
            //            break;
            //        default:
            //            break;
            //    }

            //    dateFormated += $"{sale.Updated.Year} ";
            //}

            using (ExcelRange range = worksheetPayment.Cells[16, 2, 16, 51]) {
                string currentMonth = MonthCodesResourceNames.GetCurrentMonthCode();

                range.Merge = true;
                range.Value =
                    string.Format(
                        "Рахунок на оплату № {0} від {1} р.",
                        sale.SaleNumber.Value,
                        dateFormated
                    );
                //"Рахунок на оплату № 77 від 24 грудня 2018 р.";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 14;
                range.Style.Font.Bold = true;
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Medium;
            }

            using (ExcelRange range = worksheetPayment.Cells[18, 2, 18, 8]) {
                range.Merge = true;
                range.Value = "Постачальник:";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
                range.Style.Font.UnderLine = true;
            }

            using (ExcelRange range = worksheetPayment.Cells[18, 9, 18, 51]) {
                range.Merge = true;
                range.Value = sale.ClientAgreement.Agreement.Organization.FullName;
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
            }

            using (ExcelRange range = worksheetPayment.Cells[19, 10, 19, 51]) {
                range.Merge = true;
                range.Value =
                    string.Format(
                        "П/р {0}, Банк {1} {2},  МФО {3}\r{4}, тел.: {5}\rкод за ДРФО {6}, ІПН {7}",
                        sale.ClientAgreement.Agreement.Organization.MainPaymentRegister?.AccountNumber ?? string.Empty,
                        sale.ClientAgreement.Agreement.Organization.MainPaymentRegister?.BankName ?? string.Empty,
                        sale.ClientAgreement.Agreement.Organization.MainPaymentRegister?.City ?? string.Empty,
                        sale.ClientAgreement.Agreement.Organization.MainPaymentRegister?.SortCode ?? string.Empty,
                        sale.ClientAgreement.Agreement.Organization.Address,
                        sale.ClientAgreement.Agreement.Organization.PhoneNumber,
                        sale.ClientAgreement.Agreement.Organization.USREOU,
                        sale.ClientAgreement.Agreement.Organization.TIN
                    );
                //"П/р 26002190000065, Банк ПАТ «УНІВЕРСАЛ БАНК» м. Київ, МФО 322001\rУкраїна, 29000, Хмельницький, Чорновола, дом № 176, кв.7, тел.: (097) 7013465,\r код за ДРФО 3100401117, ІПН 3100401117";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
            }

            using (ExcelRange range = worksheetPayment.Cells[21, 2, 21, 8]) {
                range.Merge = true;
                range.Value = "Покупець:";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
                range.Style.Font.UnderLine = true;
            }

            using (ExcelRange range = worksheetPayment.Cells[21, 9, 21, 51]) {
                range.Merge = true;
                range.Value = !string.IsNullOrEmpty(sale.ClientAgreement.Client.FullName) ? sale.ClientAgreement.Client.FullName : sale.ClientAgreement.Client.Name;
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
            }

            using (ExcelRange range = worksheetPayment.Cells[22, 10, 22, 51]) {
                range.Merge = true;
                range.Value = $"{sale.ClientAgreement.Client.LegalAddress}";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
            }

            if (!sale.RetailClientId.HasValue) {
                using ExcelRange range = worksheetPayment.Cells[23, 10, 23, 51];
                range.Merge = true;
                range.Value = $"Тел.: {sale.ClientAgreement.Client.MobileNumber}";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
            }

            if (sale.ClientAgreement.Agreement.WithAgreementLine) {
                using (ExcelRange range = worksheetPayment.Cells[25, 2, 25, 7]) {
                    range.Merge = true;
                    range.Value = "Договір:";
                    range.Style.WrapText = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    range.Style.Font.Size = 10;
                }

                using (ExcelRange range = worksheetPayment.Cells[25, 8, 25, 51]) {
                    range.Merge = true;
                    string fromDateStringFormat = string.Empty;

                    if (sale.ClientAgreement.Agreement.FromDate.HasValue)
                        fromDateStringFormat = TimeZoneInfo.ConvertTimeFromUtc(
                            sale.ClientAgreement.Agreement.FromDate.Value,
                            TimeZoneInfo.FindSystemTimeZoneById(
                                CultureInfo.CurrentCulture.TwoLetterISOLanguageName.Equals("uk")
                                    ? "FLE Standard Time"
                                    : "Central European Standard Time"
                            )).ToString("dd.MM.yyyy");

                    range.Value = $"№ {sale.ClientAgreement.Agreement.Number} від {fromDateStringFormat}";
                    range.Style.WrapText = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    range.Style.Font.Size = 10;
                }
            }

            //Table header
            using (ExcelRange range = worksheetPayment.Cells[27, 2, 28, 4]) {
                range.Merge = true;
                range.Value = "№";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                range.Style.Fill.BackgroundColor.SetColor(ColorTranslator.FromHtml("#EEEEEE"));
                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
            }

            using (ExcelRange range = worksheetPayment.Cells[27, 5, 28, 12]) {
                range.Merge = true;
                range.Value = "Артикул";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                range.Style.Fill.BackgroundColor.SetColor(ColorTranslator.FromHtml("#EEEEEE"));
                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
            }

            using (ExcelRange range = worksheetPayment.Cells[27, 13, 28, 36]) {
                range.Merge = true;
                range.Value = "Товари (роботи, послуги)";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                range.Style.Fill.BackgroundColor.SetColor(ColorTranslator.FromHtml("#EEEEEE"));
                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
            }

            using (ExcelRange range = worksheetPayment.Cells[27, 37, 28, 40]) {
                range.Merge = true;
                range.Value = "Кількість";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                range.Style.Fill.BackgroundColor.SetColor(ColorTranslator.FromHtml("#EEEEEE"));
                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
            }

            using (ExcelRange range = worksheetPayment.Cells[27, 41, 28, 46]) {
                range.Merge = true;
                range.Value = "Ціна з ПДВ";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                range.Style.Fill.BackgroundColor.SetColor(ColorTranslator.FromHtml("#EEEEEE"));
                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
            }

            using (ExcelRange range = worksheetPayment.Cells[27, 47, 28, 51]) {
                range.Merge = true;
                range.Value = "Сума з ПДВ";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                range.Style.Fill.BackgroundColor.SetColor(ColorTranslator.FromHtml("#EEEEEE"));
                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
            }

            int rowPayment = 29;

            int index = 1;

            foreach (OrderItem item in sale.Order.OrderItems) {
                using (ExcelRange range = worksheetPayment.Cells[rowPayment, 2, rowPayment, 4]) {
                    range.Merge = true;
                    range.Value = index;
                    range.Style.WrapText = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                    range.Style.Font.Size = 8;
                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                }

                using (ExcelRange range = worksheetPayment.Cells[rowPayment, 5, rowPayment, 12]) {
                    range.Merge = true;
                    range.Value = item.Product.VendorCode;
                    range.Style.WrapText = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                    range.Style.Font.Size = 8;
                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                }

                using (ExcelRange range = worksheetPayment.Cells[rowPayment, 13, rowPayment, 36]) {
                    range.Merge = true;
                    range.Value = $"{item.Product.Name} "; //{item.AssignedSpecification?.SpecificationCode}
                    range.Style.WrapText = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                    range.Style.Font.Size = 8;
                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                }

                using (ExcelRange range = worksheetPayment.Cells[rowPayment, 37, rowPayment, 38]) {
                    range.Merge = true;
                    range.Value = item.Qty;
                    range.Style.WrapText = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                    range.Style.Font.Size = 8;
                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                }

                using (ExcelRange range = worksheetPayment.Cells[rowPayment, 39, rowPayment, 40]) {
                    range.Merge = true;
                    range.Value = item.Product.MeasureUnit?.Name;
                    range.Style.WrapText = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                    range.Style.Font.Size = 8;
                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                }

                using (ExcelRange range = worksheetPayment.Cells[rowPayment, 41, rowPayment, 46]) {
                    range.Merge = true;
                    range.Value = decimal.Round(item.Product.CurrentLocalPrice, 2, MidpointRounding.AwayFromZero);
                    range.Style.WrapText = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                    range.Style.Font.Size = 8;
                    range.Style.Numberformat.Format = "0.00";
                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                }

                using (ExcelRange range = worksheetPayment.Cells[rowPayment, 47, rowPayment, 51]) {
                    range.Merge = true;
                    range.Value = decimal.Round(item.Product.CurrentLocalPrice * Convert.ToDecimal(item.Qty), 2, MidpointRounding.AwayFromZero);
                    range.Style.WrapText = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                    range.Style.Font.Size = 8;
                    range.Style.Numberformat.Format = "0.00";
                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                }

                if (item.Product.Name.Length > 32 || item.Product.VendorCode.Length > 32)
                    worksheetPayment.SetRowHeight(24, rowPayment);
                else
                    worksheetPayment.SetRowHeight(12, rowPayment);

                rowPayment++;
                index++;
            }

            worksheetPayment.SetRowHeight(7.11, rowPayment);
            rowPayment++;

            using (ExcelRange range = worksheetPayment.Cells[rowPayment, 41, rowPayment, 46]) {
                range.Merge = true;
                range.Value = "Разом:";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
            }

            decimal totalAmountPayment = sale.Order.OrderItems.Sum(x => x.Product.CurrentLocalPrice * Convert.ToDecimal(x.Qty));

            using (ExcelRange range = worksheetPayment.Cells[rowPayment, 47, rowPayment, 51]) {
                range.Merge = true;
                range.Value = decimal.Round(totalAmountPayment, 2, MidpointRounding.AwayFromZero);
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Style.Numberformat.Format = "0.00";
            }

            worksheetPayment.SetRowHeight(12.78, rowPayment);
            rowPayment++;

            using (ExcelRange range = worksheetPayment.Cells[rowPayment, 41, rowPayment, 46]) {
                range.Merge = true;
                range.Value = "У тому числі ПДВ:";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
            }

            decimal vatRatePayment =
                sale.ClientAgreement.Agreement.Organization.VatRate != null
                    ? Convert.ToDecimal(sale.ClientAgreement.Agreement.Organization.VatRate.Value) / 100
                    : 0;
            decimal totalVat = decimal.Round(totalAmountPayment * (vatRatePayment / (vatRatePayment + 1)), 2, MidpointRounding.AwayFromZero);

            using (ExcelRange range = worksheetPayment.Cells[rowPayment, 47, rowPayment, 51]) {
                range.Merge = true;

                range.Value = totalVat;
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Style.Numberformat.Format = "0.00";
            }

            worksheetPayment.SetRowHeight(12.78, rowPayment);
            rowPayment++;

            worksheetPayment.SetRowHeight(7.11, rowPayment);
            rowPayment++;

            string vatInString;

            switch (sale.ClientAgreement.Agreement.Currency.Code.ToLower()) {
                case "eur": {
                    using (ExcelRange range = worksheetPayment.Cells[rowPayment, 2, rowPayment, 51]) {
                        range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmountPayment, 2, MidpointRounding.AwayFromZero)} EUR.";
                        range.Style.Font.Size = 8;
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                    }

                    worksheetPayment.SetRowHeight(12.75, ++rowPayment);

                    using (ExcelRange range = worksheetPayment.Cells[rowPayment, 2, rowPayment, 51]) {
                        int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmountPayment, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                        int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                        string endKeyWord;

                        if (fullNumber > 10 && fullNumber < 20)
                            endKeyWord = "центів";
                        else
                            switch (endNumber) {
                                case 1:
                                    endKeyWord = "цент";
                                    break;
                                case 2:
                                case 3:
                                case 4:
                                    endKeyWord = "цента";
                                    break;
                                default:
                                    endKeyWord = "центів";
                                    break;
                            }

                        vatInString = $"У т.ч. ПДВ: {totalVat.ToText(true, true)} євро {(Math.Round(totalVat % 1, 2) * 100).ToText(false, true)} {endKeyWord}";

                        range.Value =
                            $"{decimal.Round(totalAmountPayment, 2, MidpointRounding.AwayFromZero).ToText(true, true)} євро {(Math.Round(decimal.Round(totalAmountPayment, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100).ToText(false, true)} {endKeyWord}\r{vatInString}";
                        range.Style.Font.Size = 9;
                        range.Style.Font.Bold = true;
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                        range.Style.WrapText = true;
                    }

                    break;
                }
                case "usd": {
                    using (ExcelRange range = worksheetPayment.Cells[rowPayment, 2, rowPayment, 51]) {
                        range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmountPayment, 2, MidpointRounding.AwayFromZero)} USD.";
                        range.Style.Font.Size = 8;
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                    }

                    worksheetPayment.SetRowHeight(12.75, ++rowPayment);

                    using (ExcelRange range = worksheetPayment.Cells[rowPayment, 2, rowPayment, 51]) {
                        int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmountPayment, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                        int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                        string endKeyWord;

                        if (fullNumber > 10 && fullNumber < 20)
                            endKeyWord = "центів";
                        else
                            switch (endNumber) {
                                case 1:
                                    endKeyWord = "цент";
                                    break;
                                case 2:
                                case 3:
                                case 4:
                                    endKeyWord = "цента";
                                    break;
                                default:
                                    endKeyWord = "центів";
                                    break;
                            }

                        vatInString = $"У т.ч. ПДВ: {totalVat.ToText(true, true)} доларів {(Math.Round(totalVat % 1, 2) * 100).ToText(false, true)} {endKeyWord}";

                        range.Value =
                            $"{decimal.Round(totalAmountPayment, 2, MidpointRounding.AwayFromZero).ToText(true, true)} доларів {(Math.Round(decimal.Round(totalAmountPayment, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100).ToText(false, true)} {endKeyWord}\r{vatInString}";
                        range.Style.Font.Size = 9;
                        range.Style.Font.Bold = true;
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                        range.Style.WrapText = true;
                    }

                    break;
                }
                case "pln": {
                    using (ExcelRange range = worksheetPayment.Cells[rowPayment, 2, rowPayment, 51]) {
                        range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmountPayment, 2, MidpointRounding.AwayFromZero)} PLN.";
                        range.Style.Font.Size = 8;
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                    }

                    worksheetPayment.SetRowHeight(12.75, ++rowPayment);

                    using (ExcelRange range = worksheetPayment.Cells[rowPayment, 2, rowPayment, 51]) {
                        int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmountPayment, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                        int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                        string endKeyWord;

                        if (fullNumber > 10 && fullNumber < 20)
                            endKeyWord = "грошів";
                        else
                            switch (endNumber) {
                                case 1:
                                    endKeyWord = "грош";
                                    break;
                                case 2:
                                case 3:
                                case 4:
                                    endKeyWord = "гроша";
                                    break;
                                default:
                                    endKeyWord = "грошів";
                                    break;
                            }

                        vatInString = $"У т.ч. ПДВ: {totalVat.ToText(true, true)} злотих {(Math.Round(totalVat % 1, 2) * 100).ToText(false, true)} {endKeyWord}";

                        range.Value =
                            $"{decimal.Round(totalAmountPayment, 2, MidpointRounding.AwayFromZero).ToText(true, true)} злотих {(Math.Round(decimal.Round(totalAmountPayment, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100).ToText(false, true)} {endKeyWord}\r{vatInString}";
                        range.Style.Font.Size = 9;
                        range.Style.Font.Bold = true;
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                        range.Style.WrapText = true;
                    }

                    break;
                }
                default: {
                    using (ExcelRange range = worksheetPayment.Cells[rowPayment, 2, rowPayment, 51]) {
                        range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmountPayment, 2, MidpointRounding.AwayFromZero)} ГРН.";
                        range.Style.Font.Size = 8;
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                    }

                    worksheetPayment.SetRowHeight(12.75, ++rowPayment);

                    using (ExcelRange range = worksheetPayment.Cells[rowPayment, 2, rowPayment, 51]) {
                        int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmountPayment, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                        int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                        string endKeyWord;

                        if (fullNumber > 10 && fullNumber < 20)
                            endKeyWord = "копійок";
                        else
                            switch (endNumber) {
                                case 1:
                                    endKeyWord = "копійка";
                                    break;
                                case 2:
                                case 3:
                                case 4:
                                    endKeyWord = "копійки";
                                    break;
                                default:
                                    endKeyWord = "копійок";
                                    break;
                            }

                        vatInString = $"У т.ч. ПДВ: {totalVat.ToText(true, true)} гривень {(Math.Round(totalVat % 1, 2) * 100).ToText(false, true)} {endKeyWord}";

                        range.Value =
                            $"{decimal.Round(totalAmountPayment, 2, MidpointRounding.AwayFromZero).ToText(true, true)} гривень {(Math.Round(totalAmountPayment % 1, 2) * 100).ToText(false, true, false)} {endKeyWord}\r{vatInString}";

                        range.Style.Font.Size = 9;
                        range.Style.Font.Bold = true;
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                        range.Style.WrapText = true;
                    }

                    break;
                }
            }

            worksheetPayment.SetRowHeight(24.98, rowPayment);
            rowPayment++;

            using (ExcelRange range = worksheetPayment.Cells[rowPayment, 2, rowPayment, 51]) {
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Medium;
            }

            worksheetPayment.SetRowHeight(7.11, rowPayment);
            rowPayment++;

            worksheetPayment.SetRowHeight(11.28, rowPayment);
            rowPayment++;

            using (ExcelRange range = worksheetPayment.Cells[rowPayment, 29, rowPayment, 49]) {
                range.Merge = true;
                range.Value = "Виписав(ла): директор " + sale.ClientAgreement.Agreement.Organization.Manager;
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Thin;
            }

            rowPayment++;
            rowPayment++;

            worksheetPayment.SetRowHeight(16.28, rowPayment);

            using (ExcelRange range = worksheetPayment.Cells[rowPayment, 4, rowPayment, 49]) {
                range.Merge = true;
                range.Value = "Увага! Рахунок дійсний на протязі 3-х робочих днів";
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                range.Style.Font.Size = 11;
                range.Style.Font.Bold = true;
                range.Style.Border.BorderAround(ExcelBorderStyle.Medium);
            }

            using (ExcelRange range = worksheetPayment.Cells[1, 1, worksheetPayment.Dimension.End.Row, worksheetPayment.Dimension.End.Column]) {
                range.Style.Font.Name = "Arial";
            }

            using (ExcelRange range = worksheetPayment.Cells[7, 1, 13, 52]) {
                range.Style.Font.Name = "Times New Roman";
            }

            ExcelWorksheet worksheet = package.Workbook.Worksheets.Add("Накладна");

            worksheet.ApplyPrinterSettings(0.5m, 0.5m, 0.1m, 0.1m, 0.25m, 0.25m, true);

            worksheet.Cells.Style.Font.Name = "Arial";
            worksheet.Cells.Style.Font.Size = 8;
            worksheet.DefaultColWidth = 9.83;
            worksheet.DefaultRowHeight = 11.25;

            //Set Rows
            worksheet.SetRowHeight(3.75, new[] { 1, 3 });
            worksheet.SetRowHeight(3.95, new[] { 15 });
            worksheet.SetRowHeight(12.75, new[] { 9, 10, 13, 6, 7, 8, 11, 12, 5 });
            worksheet.SetRowHeight(31, new[] { 2, 4, 14 });
            worksheet.SetRowHeight(22, 16);

            //Set Columns
            worksheet.SetColumnWidth(0.83, new[] { 1, 34, 37 });
            worksheet.SetColumnWidth(2.33, new[] { 3, 9, 11, 13, 15 });
            worksheet.SetColumnWidth(3, new[] { 8, 10 });
            worksheet.SetColumnWidth(2.5, new[] { 12, 67 });
            worksheet.SetColumnWidth(0.66, new[] { 16, 28, 31 });
            worksheet.SetColumnWidth(0.33, new[] { 18, 23, 58, 60, 62, 64, 66, 68, 70, 72, 74, 76, 78 });
            worksheet.SetColumnWidth(0.5, new[] { 20, 22, 43 });
            worksheet.SetColumnWidth(0.16, new[] { 24, 27, 30, 33, 36, 39, 42, 45, 48 });
            worksheet.SetColumnWidth(1, new[] { 25, 57, 35, 41, 44, 47, 50, 51 });
            worksheet.SetColumnWidth(1.5, new[] { 26, 29, 32, 38, 41, 52, 54, 576, 61 });
            worksheet.SetColumnWidth(1.33, new[] { 40, 55 });
            worksheet.SetColumnWidth(1.83, new[] { 46, 71, 77 });
            worksheet.SetColumnWidth(2.16, new[] { 49, 59 });
            worksheet.SetColumnWidth(2, new[] { 14, 17, 21, 53, 56, 63, 65 });
            worksheet.SetColumnWidth(3, new[] { 69, 73, 75 });
            worksheet.SetColumnWidth(2.42, 19);
            worksheet.SetColumnWidth(2.75, 4);
            worksheet.SetColumnWidth(3, 5);
            worksheet.SetColumnWidth(3, 6);
            worksheet.SetColumnWidth(3.5, 7);
            worksheet.SetColumnWidth(2.9, 2);

            int row = 2;
            int column = 2;

            using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                range.Merge = true;
                range.Value =
                    string.Format(
                        "Видаткова накладна № {0} від {1} р.",
                        sale.SaleNumber.Value,
                        $"{sale.ChangedToInvoice.Value.Day} {months.FirstOrDefault(m => m.Number.Equals(sale.ChangedToInvoice.Value.Month))?.Name.ToLower() ?? string.Empty} {sale.ChangedToInvoice.Value.Year}"
                    );
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Medium;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 14;
            }

            row += 2;

            using (ExcelRange range = worksheet.Cells[row, column, row, column + 4]) {
                range.Merge = true;
                range.Value = "Постачальник:";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.UnderLine = true;
                range.Style.Font.Size = 9;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 6, row, column + 75]) {
                range.Merge = true;
                range.Value = sale.ClientAgreement.Agreement.Organization.FullName;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 14;
                range.Style.WrapText = true;
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column + 6, row, column + 75]) {
                range.Merge = true;
                string val = string.Empty;
                if (sale.ClientAgreement.Agreement.Organization.MainPaymentRegister != null) {
                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.AccountNumber))
                        val += $"П/р {sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.AccountNumber}, ";

                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.BankName))
                        val += $"у банку {sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.BankName}, ";

                    range.Value = val;
                } else {
                    range.Value = val;
                }

                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;

                if (string.IsNullOrEmpty(val))
                    worksheet.SetRowHeight(1, row);
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column + 6, row, column + 75]) {
                range.Merge = true;
                string val = string.Empty;

                if (sale.ClientAgreement.Agreement.Organization.MainPaymentRegister != null) {
                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.City))
                        val += $"м. {sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.City}, ";

                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.SortCode))
                        val += $"МФО {sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.SortCode}, ";

                    range.Value = val;
                } else {
                    range.Value = val;
                }

                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;

                if (string.IsNullOrEmpty(val))
                    worksheet.SetRowHeight(1, row);
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column + 6, row, column + 75]) {
                range.Merge = true;
                string val = string.Empty;

                if (sale.ClientAgreement.Agreement.Organization.MainPaymentRegister != null) {
                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.Address))
                        val += $"{sale.ClientAgreement.Agreement.Organization.Address}, ";
                    range.Value = val;
                } else {
                    range.Value = val;
                }

                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;

                if (string.IsNullOrEmpty(val))
                    worksheet.SetRowHeight(1, row);
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column + 6, row, column + 75]) {
                range.Merge = true;
                string val = string.Empty;

                if (sale.ClientAgreement.Agreement.Organization.MainPaymentRegister != null) {
                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.PhoneNumber))
                        val += $"тел.: {sale.ClientAgreement.Agreement.Organization.PhoneNumber}, ";

                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.USREOU))
                        val += $"код за ЄДРПОУ {sale.ClientAgreement.Agreement.Organization.USREOU}, ";

                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.TIN))
                        val += $"ІПН {sale.ClientAgreement.Agreement.Organization.TIN}";

                    range.Value = val;
                } else {
                    range.Value = val;
                }

                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;

                if (string.IsNullOrEmpty(val))
                    worksheet.SetRowHeight(1, row);
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column + 7, row, column + 75]) {
                range.Merge = true;
                string val = string.Empty;

                switch (sale.ClientAgreement.Agreement.Organization.TypeTaxation) {
                    case TypeTaxation.SingleTax:
                        val = "Є платником єдиного податку";
                        break;
                    case TypeTaxation.SingleTaxAndVat:
                        val = "Є платником єдиного податку та ПДВ";
                        break;
                    case TypeTaxation.IncomeTax:
                        val = "Є платником податку на прибуток";
                        break;
                    case TypeTaxation.IncomeTaxAndVat:
                        val = "Є платником податку на прибуток на загальних підставах";
                        break;
                    case TypeTaxation.NotPaying:
                        val = "Не є платником податку на прибуток на загальних підставах";
                        break;
                }

                range.Value = val;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
            }

            row += 2;
            using (ExcelRange range = worksheet.Cells[row, column, row, column + 4]) {
                range.Merge = true;
                range.Value = "Покупець:";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.UnderLine = true;
                range.Style.Font.Size = 9;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 6, row, column + 75]) {
                range.Merge = true;
                range.Value =
                    string.Format(
                        "{0} ", //{1}
                        !string.IsNullOrEmpty(sale.ClientAgreement.Client.FullName) ? sale.ClientAgreement.Client.FullName : sale.ClientAgreement.Client.Name

                        //, sale.ClientAgreement.Client.RegionCode == null ? "" : "- " + sale.ClientAgreement.Client.RegionCode.Value
                    );
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 11;
                range.Style.WrapText = true;
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column + 7, row, column + 75]) {
                string clientInfo = string.Empty;

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.RegionCode?.City)) clientInfo += $"{sale.ClientAgreement.Client.RegionCode.City}, ";

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.RegionCode?.District)) clientInfo += $"{sale.ClientAgreement.Client.RegionCode.District}, ";

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.ActualAddress)) clientInfo += $"{sale.ClientAgreement.Client.ActualAddress}, ";

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.MobileNumber) && !sale.RetailClientId.HasValue)
                    clientInfo += $"тел.: {sale.ClientAgreement.Client.MobileNumber}";

                range.Merge = true;
                range.Value = clientInfo;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.WrapText = true;

                if (string.IsNullOrEmpty(clientInfo))
                    worksheet.SetRowHeight(1, row);

                if (clientInfo.Length > 80)
                    worksheet.SetRowHeight(24, row);
            }

            row += 2;

            if (sale.ClientAgreement.Agreement.WithAgreementLine) {
                using (ExcelRange range = worksheet.Cells[row, column, row, column + 4]) {
                    range.Merge = true;
                    range.Value = "Договір:";
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    range.Style.Font.UnderLine = true;
                    range.Style.Font.Size = 9;
                }

                using (ExcelRange range = worksheet.Cells[row, column + 6, row, column + 75]) {
                    range.Merge = true;
                    string fromDateStringFormat = string.Empty;

                    if (sale.ClientAgreement.Agreement.FromDate.HasValue)
                        fromDateStringFormat = TimeZoneInfo.ConvertTimeFromUtc(
                            sale.ClientAgreement.Agreement.FromDate.Value,
                            TimeZoneInfo.FindSystemTimeZoneById(
                                CultureInfo.CurrentCulture.TwoLetterISOLanguageName.Equals("uk")
                                    ? "FLE Standard Time"
                                    : "Central European Standard Time"
                            )).ToString("dd.MM.yyyy");

                    range.Value = $"№ {sale.ClientAgreement.Agreement.Number} від {fromDateStringFormat}";

                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    range.Style.Font.Size = 10;
                }
            }

            row += 2;

            if (sale.ClientAgreement.Agreement.WithVATAccounting) {
                using ExcelRange range = worksheet.Cells[row, column, row, column + 75];
                range.Merge = true;
                range.Value = "Видаткова накладна є підставою для оплати";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 10;
            }

            row += 2;

            int tableStartRow = row;

            using (ExcelRange range = worksheet.Cells[row, column, row + 1, column + 1]) {
                range.Value = "№";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 2, row + 1, column + 7]) {
                range.Value = "Артикул";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 8, row + 1, column + 35]) {
                range.Value = "Товар";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 36, row + 1, column + 48]) {
                range.Value = "";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 49, row + 1, column + 60]) {
                range.Value = "Кількість";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheet.Cells[row, column + 61, row + 1, column + 68]) {
                range.Value = "Ціна з ПДВ";
                range.Merge = true;
                range.SetTableHeaderStyle();
                range.Style.WrapText = true;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 69, row + 1, column + 76]) {
                range.Value = "Сума з ПДВ";
                range.Merge = true;
                range.SetTableHeaderStyle();
                range.Style.WrapText = true;
            }

            row += 2;

            int tableRowNumber = 1;

            foreach (OrderItem item in sale.Order.OrderItems) {
                bool specialItem =
                    item.Product.IsForSale || item.Product.IsForZeroSale || item.Product.Top.ToUpper().Equals("X9") || item.Product.Top.ToUpper().Equals("Х9");

                if (specialItem) {
                    if (item.ProductLocations.Any() || item.ProductLocationsHistory.Any()) {
                        foreach (ProductLocation location in item.ProductLocations) {
                            foreach (ProductLocationHistory locationHistory in item.ProductLocationsHistory.Where(x => x.TypeOfMovement == TypeOfMovement.Return))
                                if (location.ProductPlacementId == locationHistory.ProductPlacementId) {
                                    location.Qty += locationHistory.Qty;
                                    locationHistory.Qty = 0;
                                }

                            //Special OrderItem
                            using (ExcelRange range = worksheet.Cells[row, column]) {
                                range.Value = tableRowNumber;
                                range.Style.Font.Size = 9;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            //Special mark * 
                            using (ExcelRange range = worksheet.Cells[row, column + 1]) {
                                range.Value = "*";
                                range.Style.Font.Size = 22;
                                range.Style.Font.Bold = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 7]) {
                                range.Value = item.Product.VendorCode;
                                range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 14;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 8, row, column + 35]) {
                                range.Value = item.Product.Name;
                                range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                range.Merge = true;
                                range.Style.WrapText = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 36, row, column + 48]) {
                                range.Value = item.AssignedSpecification?.SpecificationCode;
                                range.Style.Font.Size = 10;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                range.Value = location.Qty;
                                range.Style.Font.Size = 16;
                                range.Style.Font.Bold = true;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                range.Value = item.Product.MeasureUnit.Name;
                                range.Style.Font.Size = 11;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                //ToDo: local price
                                range.Value = item.Product.CurrentLocalPrice;
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                //ToDo: local price
                                range.Value = decimal.Round(item.Product.CurrentLocalPrice * Convert.ToDecimal(location.Qty), 2, MidpointRounding.AwayFromZero);
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            if (item.Product.Name.Length > 18) {
                                if (item.Product.Name.Length < 35)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);
                            }

                            if (item.Product.VendorCode.Length > 15)
                                worksheet.SetRowHeight(28, row);
                            else
                                worksheet.SetRowHeight(35, row);

                            row++;
                        }

                        if (item.ProductLocationsHistory.Any())
                            foreach (ProductLocationHistory location in item.ProductLocationsHistory.Where(x => x.Qty != 0)) {
                                //Special OrderItem
                                using (ExcelRange range = worksheet.Cells[row, column]) {
                                    range.Value = tableRowNumber;
                                    range.Style.Font.Size = 9;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                //Special mark * 
                                using (ExcelRange range = worksheet.Cells[row, column + 1]) {
                                    range.Value = "*";
                                    range.Style.Font.Size = 22;
                                    range.Style.Font.Bold = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 7]) {
                                    range.Value = item.Product.VendorCode;
                                    range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 14;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 8, row, column + 35]) {
                                    range.Value = item.Product.Name;
                                    range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                    range.Merge = true;
                                    range.Style.WrapText = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 36, row, column + 48]) {
                                    range.Value = item.AssignedSpecification?.SpecificationCode;
                                    range.Style.Font.Size = 10;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                    range.Value = location.Qty;
                                    range.Style.Font.Size = 16;
                                    range.Style.Font.Bold = true;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                    range.Value = item.Product.MeasureUnit.Name;
                                    range.Style.Font.Size = 11;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                    //ToDo: local price
                                    range.Value = item.Product.CurrentLocalPrice;
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                    //ToDo: local price
                                    range.Value = decimal.Round(item.Product.CurrentLocalPrice * Convert.ToDecimal(location.Qty), 2, MidpointRounding.AwayFromZero);
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                if (item.Product.Name.Length > 18) {
                                    if (item.Product.Name.Length < 35)
                                        worksheet.SetRowHeight(28, row);
                                    else
                                        worksheet.SetRowHeight(35, row);
                                }

                                if (item.Product.VendorCode.Length > 15)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);

                                row++;
                            }

                        if (item.ProductLocations.Sum(l => l.Qty) + item.ProductLocationsHistory.Sum(g => g.Qty) < item.Qty) {
                            using (ExcelRange range = worksheet.Cells[row, column]) {
                                range.Value = tableRowNumber;
                                range.Style.Font.Size = 9;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 1]) {
                                range.Value = "*";
                                range.Style.Font.Size = 22;
                                range.Style.Font.Bold = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 7]) {
                                range.Value = item.Product.VendorCode;
                                range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 14;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 8, row, column + 35]) {
                                range.Value = item.Product.Name;
                                range.Merge = true;
                                range.Style.WrapText = true;
                                range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 36, row, column + 48]) {
                                range.Value = item.AssignedSpecification?.SpecificationCode;
                                range.Style.Font.Size = 10;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                                range.Value = item.Qty - (item.ProductLocations.Sum(l => l.Qty) + item.ProductLocationsHistory.Sum(g => g.Qty));
                                range.Style.Font.Size = 16;
                                range.Style.Font.Bold = true;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                                range.Value = item.Product.MeasureUnit.Name;
                                range.Style.Font.Size = 11;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                                //ToDo: local price
                                range.Value = item.Product.CurrentLocalPrice;
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                                //ToDo: local price
                                range.Value =
                                    decimal.Round(
                                        item.Product.CurrentLocalPrice *
                                        Convert.ToDecimal(item.Qty - (item.ProductLocations.Sum(l => l.Qty) + item.ProductLocationsHistory.Sum(g => g.Qty))),
                                        2,
                                        MidpointRounding.AwayFromZero
                                    );
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            if (item.Product.Name.Length > 18) {
                                if (item.Product.Name.Length < 35)
                                    worksheet.SetRowHeight(28, row);
                                else
                                    worksheet.SetRowHeight(35, row);
                            }

                            if (item.Product.VendorCode.Length > 15)
                                worksheet.SetRowHeight(28, row);
                            else
                                worksheet.SetRowHeight(35, row);

                            row++;
                        }
                    } else {
                        using (ExcelRange range = worksheet.Cells[row, column]) {
                            range.Value = tableRowNumber;
                            range.Style.Font.Size = 9;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 1]) {
                            range.Value = "*";
                            range.Style.Font.Size = 22;
                            range.Style.Font.Bold = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 7]) {
                            range.Value = item.Product.VendorCode;
                            range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 14;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 8, row, column + 35]) {
                            range.Value = item.Product.Name;
                            range.Merge = true;
                            range.Style.WrapText = true;
                            range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 36, row, column + 48]) {
                            range.Value = item.AssignedSpecification?.SpecificationCode;
                            range.Style.Font.Size = 10;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                            range.Value = item.Qty;
                            range.Style.Font.Size = 16;
                            range.Style.Font.Bold = true;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                            range.Value = item.Product.MeasureUnit.Name;
                            range.Style.Font.Size = 11;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                            //ToDo: local price
                            range.Value = item.Product.CurrentLocalPrice;
                            range.Style.Font.Size = 11;
                            range.Style.Numberformat.Format = "0.00";
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                            //ToDo: local price
                            range.Value =
                                decimal.Round(
                                    item.Product.CurrentLocalPrice * Convert.ToDecimal(item.Qty),
                                    2,
                                    MidpointRounding.AwayFromZero
                                );
                            range.Style.Font.Size = 11;
                            range.Style.Numberformat.Format = "0.00";
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        if (item.Product.Name.Length > 18) {
                            if (item.Product.Name.Length < 35)
                                worksheet.SetRowHeight(28, row);
                            else
                                worksheet.SetRowHeight(35, row);
                        }

                        if (item.Product.VendorCode.Length > 15)
                            worksheet.SetRowHeight(28, row);
                        else
                            worksheet.SetRowHeight(35, row);

                        row++;
                    }
                } else {
                    using (ExcelRange range = worksheet.Cells[row, column, row, column + 1]) {
                        range.Value = tableRowNumber;
                        range.Style.Font.Size = 9;
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    }

                    using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 7]) {
                        range.Value = item.Product.VendorCode;
                        range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 14;
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    }

                    using (ExcelRange range = worksheet.Cells[row, column + 8, row, column + 35]) {
                        range.Value = item.Product.Name;
                        range.Merge = true;
                        range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                        range.Style.WrapText = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    }

                    using (ExcelRange range = worksheet.Cells[row, column + 36, row, column + 48]) {
                        range.Value = item.AssignedSpecification?.SpecificationCode;
                        range.Style.Font.Size = 10;
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    }

                    using (ExcelRange range = worksheet.Cells[row, column + 49, row, column + 54]) {
                        range.Value = item.Qty;
                        range.Style.Font.Size = 16;
                        range.Style.Font.Bold = true;
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    }

                    using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 60]) {
                        range.Value = item.Product.MeasureUnit?.Name;
                        range.Style.Font.Size = 11;
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    }

                    using (ExcelRange range = worksheet.Cells[row, column + 61, row, column + 68]) {
                        //ToDo: local price
                        range.Value = decimal.Round(
                            item.Product.CurrentLocalPrice,
                            2,
                            MidpointRounding.AwayFromZero
                        );
                        range.Style.Font.Size = 11;
                        range.Style.Numberformat.Format = "0.00";
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    }

                    using (ExcelRange range = worksheet.Cells[row, column + 69, row, column + 76]) {
                        //ToDo: local price
                        range.Value = item.Product.CurrentLocalPrice * Convert.ToDecimal(item.Qty);
                        range.Style.Font.Size = 11;
                        range.Style.Numberformat.Format = "0.00";
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    }

                    if (item.Product.Name.Length > 18) {
                        if (item.Product.Name.Length < 35)
                            worksheet.SetRowHeight(28, row);
                        else
                            worksheet.SetRowHeight(35, row);
                    }

                    if (item.Product.VendorCode.Length > 15)
                        worksheet.SetRowHeight(28, row);
                    else
                        worksheet.SetRowHeight(35, row);

                    row++;
                }

                tableRowNumber++;
            }

            int tableEndRow = row - 1;

            using (ExcelRange range = worksheet.Cells[tableStartRow, column, tableEndRow, column + 76]) {
                range.Style.Border.BorderAround(ExcelBorderStyle.Medium);
            }

            worksheet.SetRowHeight(6.95, row);
            worksheet.SetRowHeight(15, ++row);

            using (ExcelRange range = worksheet.Cells[row, column + 60, row, column + 66]) {
                range.Value = "Разом:";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            decimal totalAmount = sale.Order.OrderItems.Sum(o => o.Product.CurrentLocalPrice * Convert.ToDecimal(o.Qty));

            using (ExcelRange range = worksheet.Cells[row, column + 68, row, column + 75]) {
                range.Value = decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero);
                range.Style.Font.Size = 11;
                range.Style.Numberformat.Format = "0.00";
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column + 52, row, column + 66]) {
                range.Value = "У тому числі ПДВ:";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 68, row, column + 75]) {
                decimal vatRate =
                    sale.ClientAgreement.Agreement.Organization.VatRate != null
                        ? Convert.ToDecimal(sale.ClientAgreement.Agreement.Organization.VatRate.Value) / 100
                        : 0;

                range.Value = decimal.Round(totalAmount * (vatRate / (1 + vatRate)), 2, MidpointRounding.AwayFromZero);
                range.Style.Font.Size = 11;
                range.Style.Numberformat.Format = "0.00";
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            worksheet.SetRowHeight(6.95, ++row);
            worksheet.SetRowHeight(11.25, ++row);

            if (sale.ClientAgreement.Agreement.Currency.Code.ToLower().Equals("eur")) {
                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero)} EUR.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheet.SetRowHeight(12.75, ++row);

                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                    int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                    string endKeyWord;

                    if (fullNumber > 10 && fullNumber < 20)
                        endKeyWord = "центів";
                    else
                        switch (endNumber) {
                            case 1:
                                endKeyWord = "цент";
                                break;
                            case 2:
                            case 3:
                            case 4:
                                endKeyWord = "цента";
                                break;
                            default:
                                endKeyWord = "центів";
                                break;
                        }

                    range.Value =
                        $"{decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero).ToText(true, true)} євро {(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100).ToText(false, true)} {endKeyWord}";
                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            } else if (sale.ClientAgreement.Agreement.Currency.Code.ToLower().Equals("usd")) {
                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero)} USD.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheet.SetRowHeight(12.75, ++row);

                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                    int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                    string endKeyWord;

                    if (fullNumber > 10 && fullNumber < 20)
                        endKeyWord = "центів";
                    else
                        switch (endNumber) {
                            case 1:
                                endKeyWord = "цент";
                                break;
                            case 2:
                            case 3:
                            case 4:
                                endKeyWord = "цента";
                                break;
                            default:
                                endKeyWord = "центів";
                                break;
                        }

                    range.Value =
                        $"{decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero).ToText(true, true)} доларів {(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100).ToText(false, true)} {endKeyWord}";
                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            } else if (sale.ClientAgreement.Agreement.Currency.Code.ToLower().Equals("pln")) {
                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero)} PLN.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheet.SetRowHeight(12.75, ++row);

                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                    int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                    string endKeyWord;

                    if (fullNumber > 10 && fullNumber < 20)
                        endKeyWord = "грошів";
                    else
                        switch (endNumber) {
                            case 1:
                                endKeyWord = "грош";
                                break;
                            case 2:
                            case 3:
                            case 4:
                                endKeyWord = "гроша";
                                break;
                            default:
                                endKeyWord = "грошів";
                                break;
                        }

                    range.Value =
                        $"{decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero).ToText(true, true)} злотих {(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100).ToText(false, true)} {endKeyWord}";
                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            } else {
                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero)} ГРН.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheet.SetRowHeight(12.75, ++row);

                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                    int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                    string endKeyWord;

                    if (fullNumber > 10 && fullNumber < 20)
                        endKeyWord = "копійок";
                    else
                        switch (endNumber) {
                            case 1:
                                endKeyWord = "копійка";
                                break;
                            case 2:
                            case 3:
                            case 4:
                                endKeyWord = "копійки";
                                break;
                            default:
                                endKeyWord = "копійок";
                                break;
                        }

                    range.Value =
                        $"{decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero).ToText(true, true)} гривень {(Math.Round(totalAmount % 1, 2) * 100).ToText(false, true, false)} {endKeyWord}";

                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            }

            worksheet.SetRowHeight(6.95, ++row);
            using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Medium;
            }

            row++;

            worksheet.SetRowHeight(12.75, ++row);

            using (ExcelRange range = worksheet.Cells[row, column, row, column + 5]) {
                range.Value = "Відвантажив(ла):";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 7, row, column + 29]) {
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Thin;
                range.Merge = true;
                range.Value = $" директор {sale.ClientAgreement.Agreement.Organization.Manager}";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 36, row, column + 51]) {
                range.Value = "Отримав(ла):";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 52, row, column + 73]) {
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Thin;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            worksheet.SetRowHeight(14.75, ++row);
            worksheet.SetRowHeight(14.75, row + 1);

            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 29]) {
                range.Value = "* Відповідальний за здійснення господарської операції";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.General;
            }

            using (ExcelRange range = worksheet.Cells[row + 1, column + 2, row + 1, column + 29]) {
                range.Value = "і правильність її оформлення";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.General;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 36, row, column + 51]) {
                range.Value = "За довіреністю";
                range.Style.Font.Size = 9;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 55, row, column + 57]) {
                range.Merge = true;
                range.Value = "№";
                range.Style.Font.Size = 9;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 65, row, column + 70]) {
                range.Merge = true;
                range.Value = "від";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.Font.Size = 9;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            }

            worksheet.SetRowHeight(6.95, ++row);
            worksheet.SetRowHeight(12.75, ++row);

            if (sale.Order.OrderItems.Any(x => x.OneTimeDiscount > 0)) {
                worksheet.SetRowHeight(24, ++row);

                using (ExcelRange range = worksheet.Cells[row, column, row, column + 75]) {
                    range.Value = "* - замовлений або акційний товар поверненню не підлягає";
                    range.Style.Font.Size = 18;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }

                row++;
            }

            worksheet.SetRowHeight(12.75, ++row);

            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 75]) {
                range.Value = "Вимоги до повернень";
                range.Style.Font.Size = 10;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            }

            row++;
            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 75]) {
                range.Value = "1)Товар має бути запакований";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            row++;
            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 75]) {
                range.Value = "2)Коробка даного товару і сам товар мають бути без пошкоджень";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            row++;
            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 75]) {
                range.Value = "3)Повинні бути документи на повернення: від кого і причина повернення в письмовому вигляді";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            row++;
            using (ExcelRange range = worksheet.Cells[row, column + 1, row, column + 75]) {
                range.Value = "4)Товар не буде прийматися, якщо вказане не буде виконано, і в цьому випадку товар буде відправлено назад покупцеві.";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            ExcelWorksheet worksheetSecond = package.Workbook.Worksheets.Add("Накладна_2");

            worksheetSecond.ApplyPrinterSettings(0.5m, 0.5m, 0.1m, 0.1m, 0.25m, 0.25m, true);

            worksheetSecond.Cells.Style.Font.Name = "Arial";
            worksheetSecond.Cells.Style.Font.Size = 8;
            worksheetSecond.DefaultColWidth = 9.83;
            worksheetSecond.DefaultRowHeight = 11.25;

            //Set Rows
            worksheetSecond.SetRowHeight(3.75, new[] { 1, 3 });
            worksheetSecond.SetRowHeight(3.95, new[] { 15 });
            worksheetSecond.SetRowHeight(12.75, new[] { 9, 10, 13, 6, 7, 8, 11, 12, 5 });
            worksheetSecond.SetRowHeight(31, new[] { 2, 4, 14 });
            worksheetSecond.SetRowHeight(22, 16);

            //Set Columns
            worksheetSecond.SetColumnWidth(0.83, new[] { 1, 34, 37 });
            worksheetSecond.SetColumnWidth(2.33, new[] { 3, 9, 11, 13, 15 });
            worksheetSecond.SetColumnWidth(3, new[] { 8, 10 });
            worksheetSecond.SetColumnWidth(2.5, new[] { 12, 67 });
            worksheetSecond.SetColumnWidth(0.66, new[] { 16, 28, 31 });
            worksheetSecond.SetColumnWidth(0.33, new[] { 18, 23, 58, 60, 62, 64, 66, 68, 70, 72, 74, 76, 78 });
            worksheetSecond.SetColumnWidth(0.5, new[] { 20, 22, 43 });
            worksheetSecond.SetColumnWidth(0.16, new[] { 24, 27, 30, 33, 36, 39, 42, 45, 48 });
            worksheetSecond.SetColumnWidth(1, new[] { 25, 57, 35, 41, 44, 47, 50, 51 });
            worksheetSecond.SetColumnWidth(1.5, new[] { 26, 29, 32, 38, 41, 52, 54, 576, 61 });
            worksheetSecond.SetColumnWidth(1.33, new[] { 40, 55 });
            worksheetSecond.SetColumnWidth(1.83, new[] { 46, 71, 77 });
            worksheetSecond.SetColumnWidth(2.16, new[] { 49, 59 });
            worksheetSecond.SetColumnWidth(2, new[] { 14, 17, 21, 53, 56, 63, 65 });
            worksheetSecond.SetColumnWidth(3, new[] { 69, 73, 75 });
            worksheetSecond.SetColumnWidth(2.42, 19);
            worksheetSecond.SetColumnWidth(2.75, 4);
            worksheetSecond.SetColumnWidth(3, 5);
            worksheetSecond.SetColumnWidth(3, 6);
            worksheetSecond.SetColumnWidth(3.5, 7);
            worksheetSecond.SetColumnWidth(2.9, 2);

            row = 2;
            column = 2;

            using (ExcelRange range = worksheetSecond.Cells[row, column, row, column + 75]) {
                range.Merge = true;
                range.Value =
                    string.Format(
                        "Видаткова накладна № {0} від {1} р.",
                        sale.SaleNumber.Value,
                        $"{sale.ChangedToInvoice.Value.Day} {months.FirstOrDefault(m => m.Number.Equals(sale.ChangedToInvoice.Value.Month))?.Name.ToLower() ?? string.Empty} {sale.ChangedToInvoice.Value.Year}"
                    );
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Medium;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 14;
            }

            row += 2;

            using (ExcelRange range = worksheetSecond.Cells[row, column, row, column + 4]) {
                range.Merge = true;
                range.Value = "Постачальник:";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.UnderLine = true;
                range.Style.Font.Size = 9;
            }

            using (ExcelRange range = worksheetSecond.Cells[row, column + 6, row, column + 75]) {
                range.Merge = true;
                range.Value = sale.ClientAgreement.Agreement.Organization.FullName;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 14;
                range.Style.WrapText = true;
            }

            row++;

            using (ExcelRange range = worksheetSecond.Cells[row, column + 6, row, column + 75]) {
                range.Merge = true;
                string val = string.Empty;
                if (sale.ClientAgreement.Agreement.Organization.MainPaymentRegister != null) {
                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.AccountNumber))
                        val += $"П/р {sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.AccountNumber}, ";

                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.BankName))
                        val += $"у банку {sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.BankName}, ";

                    range.Value = val;
                } else {
                    range.Value = val;
                }

                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;

                if (string.IsNullOrEmpty(val))
                    worksheetSecond.SetRowHeight(1, row);
            }

            row++;

            using (ExcelRange range = worksheetSecond.Cells[row, column + 6, row, column + 75]) {
                range.Merge = true;
                string val = string.Empty;

                if (sale.ClientAgreement.Agreement.Organization.MainPaymentRegister != null) {
                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.City))
                        val += $"м. {sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.City}, ";

                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.SortCode))
                        val += $"МФО {sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.SortCode}, ";

                    range.Value = val;
                } else {
                    range.Value = val;
                }

                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;

                if (string.IsNullOrEmpty(val))
                    worksheetSecond.SetRowHeight(1, row);
            }

            row++;

            using (ExcelRange range = worksheetSecond.Cells[row, column + 6, row, column + 75]) {
                range.Merge = true;
                string val = string.Empty;

                if (sale.ClientAgreement.Agreement.Organization.MainPaymentRegister != null) {
                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.Address))
                        val += $"{sale.ClientAgreement.Agreement.Organization.Address}, ";
                    range.Value = val;
                } else {
                    range.Value = val;
                }

                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;

                if (string.IsNullOrEmpty(val))
                    worksheetSecond.SetRowHeight(1, row);
            }

            row++;

            using (ExcelRange range = worksheetSecond.Cells[row, column + 6, row, column + 75]) {
                range.Merge = true;
                string val = string.Empty;

                if (sale.ClientAgreement.Agreement.Organization.MainPaymentRegister != null) {
                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.PhoneNumber))
                        val += $"тел.: {sale.ClientAgreement.Agreement.Organization.PhoneNumber}, ";

                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.USREOU))
                        val += $"код за ЄДРПОУ {sale.ClientAgreement.Agreement.Organization.USREOU}, ";

                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.TIN))
                        val += $"ІПН {sale.ClientAgreement.Agreement.Organization.TIN}";

                    range.Value = val;
                } else {
                    range.Value = val;
                }

                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;

                if (string.IsNullOrEmpty(val))
                    worksheetSecond.SetRowHeight(1, row);
            }

            row++;

            using (ExcelRange range = worksheetSecond.Cells[row, column + 7, row, column + 75]) {
                range.Merge = true;
                string val = string.Empty;

                switch (sale.ClientAgreement.Agreement.Organization.TypeTaxation) {
                    case TypeTaxation.SingleTax:
                        val = "Є платником єдиного податку";
                        break;
                    case TypeTaxation.SingleTaxAndVat:
                        val = "Є платником єдиного податку та ПДВ";
                        break;
                    case TypeTaxation.IncomeTax:
                        val = "Є платником податку на прибуток";
                        break;
                    case TypeTaxation.IncomeTaxAndVat:
                        val = "Є платником податку на прибуток на загальних підставах";
                        break;
                    case TypeTaxation.NotPaying:
                        val = "Не є платником податку на прибуток на загальних підставах";
                        break;
                }

                range.Value = val;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
            }

            row += 2;
            using (ExcelRange range = worksheetSecond.Cells[row, column, row, column + 4]) {
                range.Merge = true;
                range.Value = "Покупець:";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.UnderLine = true;
                range.Style.Font.Size = 9;
            }

            using (ExcelRange range = worksheetSecond.Cells[row, column + 6, row, column + 75]) {
                range.Merge = true;
                range.Value =
                    string.Format(
                        "{0} ", //{1}
                        !string.IsNullOrEmpty(sale.ClientAgreement.Client.FullName) ? sale.ClientAgreement.Client.FullName : sale.ClientAgreement.Client.Name
                        //, sale.ClientAgreement.Client.RegionCode == null ? "" : "- " + sale.ClientAgreement.Client.RegionCode.Value
                    );
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 11;
                range.Style.WrapText = true;
            }

            row++;

            using (ExcelRange range = worksheetSecond.Cells[row, column + 7, row, column + 75]) {
                string clientInfo = string.Empty;

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.RegionCode?.City)) clientInfo += $"{sale.ClientAgreement.Client.RegionCode.City}, ";

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.RegionCode?.District)) clientInfo += $"{sale.ClientAgreement.Client.RegionCode.District}, ";

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.ActualAddress)) clientInfo += $"{sale.ClientAgreement.Client.ActualAddress}, ";

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.MobileNumber) && !sale.RetailClientId.HasValue)
                    clientInfo += $"тел.: {sale.ClientAgreement.Client.MobileNumber}";

                range.Merge = true;
                range.Value = clientInfo;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.WrapText = true;

                if (string.IsNullOrEmpty(clientInfo))
                    worksheetSecond.SetRowHeight(1, row);

                if (clientInfo.Length > 80)
                    worksheetSecond.SetRowHeight(24, row);
            }

            row += 2;

            if (sale.ClientAgreement.Agreement.WithAgreementLine) {
                using (ExcelRange range = worksheetSecond.Cells[row, column, row, column + 4]) {
                    range.Merge = true;
                    range.Value = "Договір:";
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    range.Style.Font.UnderLine = true;
                    range.Style.Font.Size = 9;
                }

                using (ExcelRange range = worksheetSecond.Cells[row, column + 6, row, column + 75]) {
                    range.Merge = true;
                    string fromDateStringFormat = string.Empty;

                    if (sale.ClientAgreement.Agreement.FromDate.HasValue)
                        fromDateStringFormat = TimeZoneInfo.ConvertTimeFromUtc(
                            sale.ClientAgreement.Agreement.FromDate.Value,
                            TimeZoneInfo.FindSystemTimeZoneById(
                                CultureInfo.CurrentCulture.TwoLetterISOLanguageName.Equals("uk")
                                    ? "FLE Standard Time"
                                    : "Central European Standard Time"
                            )).ToString("dd.MM.yyyy");

                    range.Value = $"№ {sale.ClientAgreement.Agreement.Number} від {fromDateStringFormat}";

                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    range.Style.Font.Size = 10;
                }
            }

            row += 2;

            if (sale.ClientAgreement.Agreement.WithVATAccounting) {
                using ExcelRange range = worksheetSecond.Cells[row, column, row, column + 75];
                range.Merge = true;
                range.Value = "Видаткова накладна є підставою для оплати";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 10;
            }

            row += 2;

            tableStartRow = row;

            using (ExcelRange range = worksheetSecond.Cells[row, column, row + 1, column + 1]) {
                range.Value = "№";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheetSecond.Cells[row, column + 2, row + 1, column + 7]) {
                range.Value = "Артикул";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheetSecond.Cells[row, column + 8, row + 1, column + 35]) {
                range.Value = "Товар";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheetSecond.Cells[row, column + 36, row + 1, column + 48]) {
                range.Value = "";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheetSecond.Cells[row, column + 49, row + 1, column + 60]) {
                range.Value = "Кількість";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheetSecond.Cells[row, column + 61, row + 1, column + 68]) {
                range.Value = "Ціна з ПДВ";
                range.Merge = true;
                range.SetTableHeaderStyle();
                range.Style.WrapText = true;
            }

            using (ExcelRange range = worksheetSecond.Cells[row, column + 69, row + 1, column + 76]) {
                range.Value = "Сума з ПДВ";
                range.Merge = true;
                range.SetTableHeaderStyle();
                range.Style.WrapText = true;
            }

            row += 2;

            tableRowNumber = 1;

            foreach (OrderItem item in sale.Order.OrderItems) {
                bool specialItem =
                    item.Product.IsForSale || item.Product.IsForZeroSale || item.Product.Top.ToUpper().Equals("X9") || item.Product.Top.ToUpper().Equals("Х9");

                if (specialItem) {
                    if (item.ProductLocations.Any() || item.ProductLocationsHistory.Any()) {
                        foreach (ProductLocation location in item.ProductLocations) {
                            foreach (ProductLocationHistory locationHistory in item.ProductLocationsHistory.Where(x => x.TypeOfMovement == TypeOfMovement.Return))
                                if (location.ProductPlacementId == locationHistory.ProductPlacementId) {
                                    location.Qty += locationHistory.Qty;
                                    locationHistory.Qty = 0;
                                }

                            //Special OrderItem
                            using (ExcelRange range = worksheetSecond.Cells[row, column]) {
                                range.Value = tableRowNumber;
                                range.Style.Font.Size = 9;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            //Special mark * 
                            using (ExcelRange range = worksheetSecond.Cells[row, column + 1]) {
                                range.Value = "*";
                                range.Style.Font.Size = 22;
                                range.Style.Font.Bold = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetSecond.Cells[row, column + 2, row, column + 7]) {
                                range.Value = item.Product.VendorCode;
                                range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 14;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetSecond.Cells[row, column + 8, row, column + 35]) {
                                range.Value = item.Product.Name;
                                range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                range.Merge = true;
                                range.Style.WrapText = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetSecond.Cells[row, column + 36, row, column + 48]) {
                                range.Value = item.AssignedSpecification?.SpecificationCode;
                                range.Style.Font.Size = 10;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetSecond.Cells[row, column + 49, row, column + 54]) {
                                range.Value = location.Qty;
                                range.Style.Font.Size = 16;
                                range.Style.Font.Bold = true;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetSecond.Cells[row, column + 55, row, column + 60]) {
                                range.Value = item.Product.MeasureUnit.Name;
                                range.Style.Font.Size = 11;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetSecond.Cells[row, column + 61, row, column + 68]) {
                                //ToDo: local price
                                range.Value = item.Product.CurrentLocalPrice;
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetSecond.Cells[row, column + 69, row, column + 76]) {
                                //ToDo: local price
                                range.Value = decimal.Round(item.Product.CurrentLocalPrice * Convert.ToDecimal(location.Qty), 2, MidpointRounding.AwayFromZero);
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            if (item.Product.Name.Length > 18) {
                                if (item.Product.Name.Length < 35)
                                    worksheetSecond.SetRowHeight(28, row);
                                else
                                    worksheetSecond.SetRowHeight(35, row);
                            }

                            if (item.Product.VendorCode.Length > 15)
                                worksheetSecond.SetRowHeight(28, row);
                            else
                                worksheetSecond.SetRowHeight(35, row);

                            row++;
                        }

                        if (item.ProductLocationsHistory.Any())
                            foreach (ProductLocationHistory location in item.ProductLocationsHistory.Where(x => x.Qty != 0)) {
                                //Special OrderItem
                                using (ExcelRange range = worksheetSecond.Cells[row, column]) {
                                    range.Value = tableRowNumber;
                                    range.Style.Font.Size = 9;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                //Special mark * 
                                using (ExcelRange range = worksheetSecond.Cells[row, column + 1]) {
                                    range.Value = "*";
                                    range.Style.Font.Size = 22;
                                    range.Style.Font.Bold = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheetSecond.Cells[row, column + 2, row, column + 7]) {
                                    range.Value = item.Product.VendorCode;
                                    range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 14;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheetSecond.Cells[row, column + 8, row, column + 35]) {
                                    range.Value = item.Product.Name;
                                    range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                    range.Merge = true;
                                    range.Style.WrapText = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheetSecond.Cells[row, column + 36, row, column + 48]) {
                                    range.Value = item.AssignedSpecification?.SpecificationCode;
                                    range.Style.Font.Size = 10;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheetSecond.Cells[row, column + 49, row, column + 54]) {
                                    range.Value = location.Qty;
                                    range.Style.Font.Size = 16;
                                    range.Style.Font.Bold = true;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheetSecond.Cells[row, column + 55, row, column + 60]) {
                                    range.Value = item.Product.MeasureUnit.Name;
                                    range.Style.Font.Size = 11;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheetSecond.Cells[row, column + 61, row, column + 68]) {
                                    //ToDo: local price
                                    range.Value = item.Product.CurrentLocalPrice;
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheetSecond.Cells[row, column + 69, row, column + 76]) {
                                    //ToDo: local price
                                    range.Value = decimal.Round(item.Product.CurrentLocalPrice * Convert.ToDecimal(location.Qty), 2, MidpointRounding.AwayFromZero);
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                if (item.Product.Name.Length > 18) {
                                    if (item.Product.Name.Length < 35)
                                        worksheetSecond.SetRowHeight(28, row);
                                    else
                                        worksheetSecond.SetRowHeight(35, row);
                                }

                                if (item.Product.VendorCode.Length > 15)
                                    worksheetSecond.SetRowHeight(28, row);
                                else
                                    worksheetSecond.SetRowHeight(35, row);

                                row++;
                            }

                        if (item.ProductLocations.Sum(l => l.Qty) + item.ProductLocationsHistory.Sum(g => g.Qty) < item.Qty) {
                            using (ExcelRange range = worksheetSecond.Cells[row, column]) {
                                range.Value = tableRowNumber;
                                range.Style.Font.Size = 9;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetSecond.Cells[row, column + 1]) {
                                range.Value = "*";
                                range.Style.Font.Size = 22;
                                range.Style.Font.Bold = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetSecond.Cells[row, column + 2, row, column + 7]) {
                                range.Value = item.Product.VendorCode;
                                range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 14;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetSecond.Cells[row, column + 8, row, column + 35]) {
                                range.Value = item.Product.Name;
                                range.Merge = true;
                                range.Style.WrapText = true;
                                range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetSecond.Cells[row, column + 36, row, column + 48]) {
                                range.Value = item.AssignedSpecification?.SpecificationCode;
                                range.Style.Font.Size = 10;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetSecond.Cells[row, column + 49, row, column + 54]) {
                                range.Value = item.Qty - (item.ProductLocations.Sum(l => l.Qty) + item.ProductLocationsHistory.Sum(g => g.Qty));
                                range.Style.Font.Size = 16;
                                range.Style.Font.Bold = true;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetSecond.Cells[row, column + 55, row, column + 60]) {
                                range.Value = item.Product.MeasureUnit.Name;
                                range.Style.Font.Size = 11;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetSecond.Cells[row, column + 61, row, column + 68]) {
                                //ToDo: local price
                                range.Value = item.Product.CurrentLocalPrice;
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetSecond.Cells[row, column + 69, row, column + 76]) {
                                //ToDo: local price
                                range.Value =
                                    decimal.Round(
                                        item.Product.CurrentLocalPrice *
                                        Convert.ToDecimal(item.Qty - (item.ProductLocations.Sum(l => l.Qty) + item.ProductLocationsHistory.Sum(g => g.Qty))),
                                        2,
                                        MidpointRounding.AwayFromZero
                                    );
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            if (item.Product.Name.Length > 18) {
                                if (item.Product.Name.Length < 35)
                                    worksheetSecond.SetRowHeight(28, row);
                                else
                                    worksheetSecond.SetRowHeight(35, row);
                            }

                            if (item.Product.VendorCode.Length > 15)
                                worksheetSecond.SetRowHeight(28, row);
                            else
                                worksheetSecond.SetRowHeight(35, row);

                            row++;
                        }
                    } else {
                        using (ExcelRange range = worksheetSecond.Cells[row, column]) {
                            range.Value = tableRowNumber;
                            range.Style.Font.Size = 9;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheetSecond.Cells[row, column + 1]) {
                            range.Value = "*";
                            range.Style.Font.Size = 22;
                            range.Style.Font.Bold = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheetSecond.Cells[row, column + 2, row, column + 7]) {
                            range.Value = item.Product.VendorCode;
                            range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 14;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheetSecond.Cells[row, column + 8, row, column + 35]) {
                            range.Value = item.Product.Name;
                            range.Merge = true;
                            range.Style.WrapText = true;
                            range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheetSecond.Cells[row, column + 36, row, column + 48]) {
                            range.Value = item.AssignedSpecification?.SpecificationCode;
                            range.Style.Font.Size = 10;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheetSecond.Cells[row, column + 49, row, column + 54]) {
                            range.Value = item.Qty;
                            range.Style.Font.Size = 16;
                            range.Style.Font.Bold = true;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheetSecond.Cells[row, column + 55, row, column + 60]) {
                            range.Value = item.Product.MeasureUnit.Name;
                            range.Style.Font.Size = 11;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheetSecond.Cells[row, column + 61, row, column + 68]) {
                            //ToDo: local price
                            range.Value = item.Product.CurrentLocalPrice;
                            range.Style.Font.Size = 11;
                            range.Style.Numberformat.Format = "0.00";
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheetSecond.Cells[row, column + 69, row, column + 76]) {
                            //ToDo: local price
                            range.Value =
                                decimal.Round(
                                    item.Product.CurrentLocalPrice * Convert.ToDecimal(item.Qty),
                                    2,
                                    MidpointRounding.AwayFromZero
                                );
                            range.Style.Font.Size = 11;
                            range.Style.Numberformat.Format = "0.00";
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        if (item.Product.Name.Length > 18) {
                            if (item.Product.Name.Length < 35)
                                worksheetSecond.SetRowHeight(28, row);
                            else
                                worksheetSecond.SetRowHeight(35, row);
                        }

                        if (item.Product.VendorCode.Length > 15)
                            worksheetSecond.SetRowHeight(28, row);
                        else
                            worksheetSecond.SetRowHeight(35, row);

                        row++;
                    }
                } else {
                    using (ExcelRange range = worksheetSecond.Cells[row, column, row, column + 1]) {
                        range.Value = tableRowNumber;
                        range.Style.Font.Size = 9;
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    }

                    using (ExcelRange range = worksheetSecond.Cells[row, column + 2, row, column + 7]) {
                        range.Value = item.Product.VendorCode;
                        range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 14;
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    }

                    using (ExcelRange range = worksheetSecond.Cells[row, column + 8, row, column + 35]) {
                        range.Value = item.Product.Name;
                        range.Merge = true;
                        range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                        range.Style.WrapText = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    }

                    using (ExcelRange range = worksheetSecond.Cells[row, column + 36, row, column + 48]) {
                        range.Value = item.AssignedSpecification?.SpecificationCode;
                        range.Style.Font.Size = 10;
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    }

                    using (ExcelRange range = worksheetSecond.Cells[row, column + 49, row, column + 54]) {
                        range.Value = item.Qty;
                        range.Style.Font.Size = 16;
                        range.Style.Font.Bold = true;
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    }

                    using (ExcelRange range = worksheetSecond.Cells[row, column + 55, row, column + 60]) {
                        range.Value = item.Product.MeasureUnit?.Name;
                        range.Style.Font.Size = 11;
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    }

                    using (ExcelRange range = worksheetSecond.Cells[row, column + 61, row, column + 68]) {
                        //ToDo: local price
                        range.Value = decimal.Round(
                            item.Product.CurrentLocalPrice,
                            2,
                            MidpointRounding.AwayFromZero
                        );
                        range.Style.Font.Size = 11;
                        range.Style.Numberformat.Format = "0.00";
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    }

                    using (ExcelRange range = worksheetSecond.Cells[row, column + 69, row, column + 76]) {
                        //ToDo: local price
                        range.Value = item.Product.CurrentLocalPrice * Convert.ToDecimal(item.Qty);
                        range.Style.Font.Size = 11;
                        range.Style.Numberformat.Format = "0.00";
                        range.Merge = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                    }

                    if (item.Product.Name.Length > 18) {
                        if (item.Product.Name.Length < 35)
                            worksheetSecond.SetRowHeight(28, row);
                        else
                            worksheetSecond.SetRowHeight(35, row);
                    }

                    if (item.Product.VendorCode.Length > 15)
                        worksheetSecond.SetRowHeight(28, row);
                    else
                        worksheetSecond.SetRowHeight(35, row);

                    row++;
                }

                tableRowNumber++;
            }

            tableEndRow = row - 1;

            using (ExcelRange range = worksheetSecond.Cells[tableStartRow, column, tableEndRow, column + 76]) {
                range.Style.Border.BorderAround(ExcelBorderStyle.Medium);
            }

            worksheetSecond.SetRowHeight(6.95, row);
            worksheetSecond.SetRowHeight(15, ++row);

            using (ExcelRange range = worksheetSecond.Cells[row, column + 60, row, column + 66]) {
                range.Value = "Разом:";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            totalAmount = sale.Order.OrderItems.Sum(o => o.Product.CurrentLocalPrice * Convert.ToDecimal(o.Qty));

            using (ExcelRange range = worksheetSecond.Cells[row, column + 68, row, column + 75]) {
                range.Value = decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero);
                range.Style.Font.Size = 11;
                range.Style.Numberformat.Format = "0.00";
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            row++;

            using (ExcelRange range = worksheetSecond.Cells[row, column + 52, row, column + 66]) {
                range.Value = "У тому числі ПДВ:";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            using (ExcelRange range = worksheetSecond.Cells[row, column + 68, row, column + 75]) {
                decimal vatRate =
                    sale.ClientAgreement.Agreement.Organization.VatRate != null
                        ? Convert.ToDecimal(sale.ClientAgreement.Agreement.Organization.VatRate.Value) / 100
                        : 0;

                range.Value = decimal.Round(totalAmount * (vatRate / (1 + vatRate)), 2, MidpointRounding.AwayFromZero);
                range.Style.Font.Size = 11;
                range.Style.Numberformat.Format = "0.00";
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            worksheetSecond.SetRowHeight(6.95, ++row);
            worksheetSecond.SetRowHeight(11.25, ++row);

            if (sale.ClientAgreement.Agreement.Currency.Code.ToLower().Equals("eur")) {
                using (ExcelRange range = worksheetSecond.Cells[row, column, row, column + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero)} EUR.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheetSecond.SetRowHeight(12.75, ++row);

                using (ExcelRange range = worksheetSecond.Cells[row, column, row, column + 75]) {
                    int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                    int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                    string endKeyWord;

                    if (fullNumber > 10 && fullNumber < 20)
                        endKeyWord = "центів";
                    else
                        switch (endNumber) {
                            case 1:
                                endKeyWord = "цент";
                                break;
                            case 2:
                            case 3:
                            case 4:
                                endKeyWord = "цента";
                                break;
                            default:
                                endKeyWord = "центів";
                                break;
                        }

                    range.Value =
                        $"{decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero).ToText(true, true)} євро {(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100).ToText(false, true)} {endKeyWord}";
                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            } else if (sale.ClientAgreement.Agreement.Currency.Code.ToLower().Equals("usd")) {
                using (ExcelRange range = worksheetSecond.Cells[row, column, row, column + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero)} USD.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheetSecond.SetRowHeight(12.75, ++row);

                using (ExcelRange range = worksheetSecond.Cells[row, column, row, column + 75]) {
                    int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                    int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                    string endKeyWord;

                    if (fullNumber > 10 && fullNumber < 20)
                        endKeyWord = "центів";
                    else
                        switch (endNumber) {
                            case 1:
                                endKeyWord = "цент";
                                break;
                            case 2:
                            case 3:
                            case 4:
                                endKeyWord = "цента";
                                break;
                            default:
                                endKeyWord = "центів";
                                break;
                        }

                    range.Value =
                        $"{decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero).ToText(true, true)} доларів {(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100).ToText(false, true)} {endKeyWord}";
                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            } else if (sale.ClientAgreement.Agreement.Currency.Code.ToLower().Equals("pln")) {
                using (ExcelRange range = worksheetSecond.Cells[row, column, row, column + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero)} PLN.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheetSecond.SetRowHeight(12.75, ++row);

                using (ExcelRange range = worksheetSecond.Cells[row, column, row, column + 75]) {
                    int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                    int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                    string endKeyWord;

                    if (fullNumber > 10 && fullNumber < 20)
                        endKeyWord = "грошів";
                    else
                        switch (endNumber) {
                            case 1:
                                endKeyWord = "грош";
                                break;
                            case 2:
                            case 3:
                            case 4:
                                endKeyWord = "гроша";
                                break;
                            default:
                                endKeyWord = "грошів";
                                break;
                        }

                    range.Value =
                        $"{decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero).ToText(true, true)} злотих {(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100).ToText(false, true)} {endKeyWord}";
                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            } else {
                using (ExcelRange range = worksheetSecond.Cells[row, column, row, column + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero)} ГРН.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheetSecond.SetRowHeight(12.75, ++row);

                using (ExcelRange range = worksheetSecond.Cells[row, column, row, column + 75]) {
                    int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                    int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                    string endKeyWord;

                    if (fullNumber > 10 && fullNumber < 20)
                        endKeyWord = "копійок";
                    else
                        switch (endNumber) {
                            case 1:
                                endKeyWord = "копійка";
                                break;
                            case 2:
                            case 3:
                            case 4:
                                endKeyWord = "копійки";
                                break;
                            default:
                                endKeyWord = "копійок";
                                break;
                        }

                    range.Value =
                        $"{decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero).ToText(true, true)} гривень {(Math.Round(totalAmount % 1, 2) * 100).ToText(false, true, false)} {endKeyWord}";

                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            }

            worksheetSecond.SetRowHeight(6.95, ++row);
            using (ExcelRange range = worksheetSecond.Cells[row, column, row, column + 75]) {
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Medium;
            }

            row++;

            worksheetSecond.SetRowHeight(12.75, ++row);

            using (ExcelRange range = worksheetSecond.Cells[row, column, row, column + 5]) {
                range.Value = "Відвантажив(ла):";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            using (ExcelRange range = worksheetSecond.Cells[row, column + 7, row, column + 29]) {
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Thin;
                range.Merge = true;
                range.Value = $" директор {sale.ClientAgreement.Agreement.Organization.Manager}";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            using (ExcelRange range = worksheetSecond.Cells[row, column + 36, row, column + 51]) {
                range.Value = "Отримав(ла):";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            using (ExcelRange range = worksheetSecond.Cells[row, column + 52, row, column + 73]) {
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Thin;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            worksheetSecond.SetRowHeight(14.75, ++row);
            worksheetSecond.SetRowHeight(14.75, row + 1);

            using (ExcelRange range = worksheetSecond.Cells[row, column + 1, row, column + 29]) {
                range.Value = "* Відповідальний за здійснення господарської операції";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.General;
            }

            using (ExcelRange range = worksheetSecond.Cells[row + 1, column + 2, row + 1, column + 29]) {
                range.Value = "і правильність її оформлення";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.General;
            }

            using (ExcelRange range = worksheetSecond.Cells[row, column + 36, row, column + 51]) {
                range.Value = "За довіреністю";
                range.Style.Font.Size = 9;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            }

            using (ExcelRange range = worksheetSecond.Cells[row, column + 55, row, column + 57]) {
                range.Merge = true;
                range.Value = "№";
                range.Style.Font.Size = 9;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            }

            using (ExcelRange range = worksheetSecond.Cells[row, column + 65, row, column + 70]) {
                range.Merge = true;
                range.Value = "від";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.Font.Size = 9;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            }

            worksheetSecond.SetRowHeight(6.95, ++row);
            worksheetSecond.SetRowHeight(12.75, ++row);

            if (sale.Order.OrderItems.Any(x => x.OneTimeDiscount > 0)) {
                worksheetSecond.SetRowHeight(24, ++row);

                using (ExcelRange range = worksheetSecond.Cells[row, column, row, column + 75]) {
                    range.Value = "* - замовлений або акційний товар поверненню не підлягає";
                    range.Style.Font.Size = 18;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }

                row++;
            }

            worksheetSecond.SetRowHeight(12.75, ++row);

            using (ExcelRange range = worksheetSecond.Cells[row, column + 1, row, column + 75]) {
                range.Value = "Вимоги до повернень";
                range.Style.Font.Size = 10;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            }

            row++;
            using (ExcelRange range = worksheetSecond.Cells[row, column + 1, row, column + 75]) {
                range.Value = "1)Товар має бути запакований";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            row++;
            using (ExcelRange range = worksheetSecond.Cells[row, column + 1, row, column + 75]) {
                range.Value = "2)Коробка даного товару і сам товар мають бути без пошкоджень";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            row++;
            using (ExcelRange range = worksheetSecond.Cells[row, column + 1, row, column + 75]) {
                range.Value = "3)Повинні бути документи на повернення: від кого і причина повернення в письмовому вигляді";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            row++;
            using (ExcelRange range = worksheetSecond.Cells[row, column + 1, row, column + 75]) {
                range.Value = "4)Товар не буде прийматися, якщо вказане не буде виконано, і в цьому випадку товар буде відправлено назад покупцеві.";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            decimal totalAmountShipmentList = Math.Round(sale.Order.OrderItems.Sum(x => x.Product.CurrentLocalPrice * Convert.ToDecimal(x.Qty)), 2);

            ExcelWorksheet worksheetShipmentList = package.Workbook.Worksheets.Add("Лист на пакування");

            worksheetShipmentList.ApplyPrinterSettings(0.5m, 0.5m, 0.1m, 0.1m, 0.25m, 0.25m, true);

            worksheetShipmentList.Cells.Style.Font.Name = "Arial";
            worksheetShipmentList.Cells.Style.Font.Size = 8;
            worksheetShipmentList.DefaultColWidth = 9.83;
            worksheetShipmentList.DefaultRowHeight = 11.25;

            //Set Rows
            worksheetShipmentList.SetRowHeight(3.75, new[] { 6, 8, 1, 4, 5 });
            worksheetShipmentList.SetRowHeight(3.95, new[] { 20 });
            worksheetShipmentList.SetRowHeight(12.75, new[] { 14, 15, 18, 11, 12, 13, 16, 18, 11 });
            worksheetShipmentList.SetRowHeight(31, new[] { 7, 9, 19 });
            worksheetShipmentList.SetRowHeight(22, 21);

            worksheetShipmentList.SetRowHeight(45, 2);
            worksheetShipmentList.SetRowHeight(29.5455, 3);

            //Set Columns
            worksheetShipmentList.SetColumnWidth(0.83, new[] { 1, 34, 37 });
            worksheetShipmentList.SetColumnWidth(2.33, new[] { 3, 9, 11, 13, 15 });
            worksheetShipmentList.SetColumnWidth(3, new[] { 8, 10 });
            worksheetShipmentList.SetColumnWidth(2.5, new[] { 12, 67 });
            worksheetShipmentList.SetColumnWidth(0.66, new[] { 16, 28, 31 });
            worksheetShipmentList.SetColumnWidth(0.33, new[] { 18, 23, 58, 60, 62, 64, 66, 68, 70, 72, 74, 76, 78 });
            worksheetShipmentList.SetColumnWidth(0.5, new[] { 20, 22, 43 });
            worksheetShipmentList.SetColumnWidth(0.16, new[] { 24, 27, 30, 33, 36, 39, 42, 45, 48 });
            worksheetShipmentList.SetColumnWidth(1, new[] { 25, 57, 35, 41, 44, 47, 50, 51 });
            worksheetShipmentList.SetColumnWidth(1.5, new[] { 26, 29, 32, 38, 41, 52, 54, 576, 61 });
            worksheetShipmentList.SetColumnWidth(1.33, new[] { 40, 55 });
            worksheetShipmentList.SetColumnWidth(1.83, new[] { 46, 71, 77 });
            worksheetShipmentList.SetColumnWidth(2.16, new[] { 49, 59 });
            worksheetShipmentList.SetColumnWidth(2, new[] { 14, 17, 21, 53, 56, 63, 65 });
            worksheetShipmentList.SetColumnWidth(3, new[] { 69, 73, 75 });
            worksheetShipmentList.SetColumnWidth(2.42, 19);
            worksheetShipmentList.SetColumnWidth(2.75, 4);
            worksheetShipmentList.SetColumnWidth(3, 5);
            worksheetShipmentList.SetColumnWidth(3, 6);
            worksheetShipmentList.SetColumnWidth(3.5, 7);
            worksheetShipmentList.SetColumnWidth(2.9, 2);

            int rowShipmentList = 2;
            int columnShipmentList = 2;

            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList, rowShipmentList, columnShipmentList + 10]) {
                range.Merge = true;
                range.Value = "Перевізник:";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.UnderLine = true;
                range.Style.Font.Size = 14;
            }

            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 11, rowShipmentList, columnShipmentList + 75]) {
                range.Merge = true;

                string value = sale.Transporter.Name;

                if (!string.IsNullOrEmpty(sale.DeliveryRecipientAddress.City))
                    value += ", " + sale.DeliveryRecipientAddress.City;
                if (!string.IsNullOrEmpty(sale.DeliveryRecipientAddress.Value))
                    value += ", " + sale.DeliveryRecipientAddress.Value;
                if (!string.IsNullOrEmpty(sale.DeliveryRecipientAddress.Department))
                    value += ", " + sale.DeliveryRecipientAddress.Department;
                if (!string.IsNullOrEmpty(sale.DeliveryRecipient.FullName))
                    value += ", " + sale.DeliveryRecipient.FullName;
                if (!string.IsNullOrEmpty(sale.DeliveryRecipient.MobilePhone))
                    value += ", " + sale.DeliveryRecipient.MobilePhone;

                range.Value = value;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Bold = true;

                if (value.Length < 150)
                    range.Style.Font.Size = 14;
                else
                    range.Style.Font.Size = 8;
                range.Style.WrapText = true;
                range.Merge = true;
            }

            rowShipmentList++;

            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList, rowShipmentList, columnShipmentList + 75]) {
                string value = "Примітка: ";

                if (sale.IsCashOnDelivery) value += $" накладний платіж: {decimal.Round(sale.CashOnDeliveryAmount, 2, MidpointRounding.AwayFromZero)}. ";

                if (sale.CustomersOwnTtn != null) value += $" власне ТТН: {sale.CustomersOwnTtn.Number}. ";
                if (!string.IsNullOrEmpty(sale.Comment)) value += $" коментар: {sale.Comment}. ";
                range.Value = value;
                range.Merge = true;
                range.Style.WrapText = true;
                range.Style.Font.UnderLine = true;
                range.Style.Font.Size = 10;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            }


            rowShipmentList++;

            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList - 1, rowShipmentList, columnShipmentList + 75]) {
                range.Style.Border.Bottom.Style = ExcelBorderStyle.MediumDashed;
            }

            rowShipmentList += 3;

            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList, rowShipmentList, columnShipmentList + 75]) {
                range.Merge = true;
                string invoice = "Лист на пакування № {0} від {1} р.";
                if (sale.HistoryInvoiceEdit.Any() && sale.IsVatSale) invoice += "                Змінено";
                range.Value =
                    string.Format(
                        invoice,
                        sale.SaleNumber.Value,
                        $"{sale.ChangedToInvoice.Value.Day} {months.FirstOrDefault(m => m.Number.Equals(sale.ChangedToInvoice.Value.Month))?.Name.ToLower() ?? string.Empty} {sale.ChangedToInvoice.Value.Year}"
                    );
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Medium;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 14;
            }

            rowShipmentList += 2;

            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList, rowShipmentList, columnShipmentList + 4]) {
                range.Merge = true;
                range.Value = "Постачальник:";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.UnderLine = true;
                range.Style.Font.Size = 9;
            }

            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 6, rowShipmentList, columnShipmentList + 75]) {
                range.Merge = true;
                range.Value = sale.ClientAgreement.Agreement.Organization.FullName;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 14;
                range.Style.WrapText = true;
            }

            rowShipmentList++;

            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 7, rowShipmentList, columnShipmentList + 75]) {
                range.Merge = true;
                string val = string.Empty;
                if (sale.ClientAgreement.Agreement.Organization.MainPaymentRegister != null) {
                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.AccountNumber))
                        val += $"П/р {sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.AccountNumber}, ";

                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.BankName))
                        val += $"у банку {sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.BankName}, ";

                    range.Value = val;
                } else {
                    range.Value = val;
                }

                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;

                if (string.IsNullOrEmpty(val))
                    worksheetShipmentList.SetRowHeight(1, rowShipmentList);
            }

            rowShipmentList++;

            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 7, rowShipmentList, columnShipmentList + 75]) {
                range.Merge = true;
                string val = string.Empty;

                if (sale.ClientAgreement.Agreement.Organization.MainPaymentRegister != null) {
                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.City))
                        val += $"м. {sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.City}, ";

                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.SortCode))
                        val += $"МФО {sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.SortCode}, ";

                    range.Value = val;
                } else {
                    range.Value = val;
                }

                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;

                if (string.IsNullOrEmpty(val))
                    worksheetShipmentList.SetRowHeight(1, rowShipmentList);
            }

            rowShipmentList++;

            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 7, rowShipmentList, columnShipmentList + 75]) {
                range.Merge = true;
                string val = string.Empty;

                if (sale.ClientAgreement.Agreement.Organization.MainPaymentRegister != null) {
                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.Address))
                        val += $"{sale.ClientAgreement.Agreement.Organization.Address}, ";
                    range.Value = val;
                } else {
                    range.Value = val;
                }

                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;

                if (string.IsNullOrEmpty(val))
                    worksheetShipmentList.SetRowHeight(1, rowShipmentList);
            }

            rowShipmentList++;

            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 7, rowShipmentList, columnShipmentList + 75]) {
                range.Merge = true;
                string val = string.Empty;

                if (sale.ClientAgreement.Agreement.Organization.MainPaymentRegister != null) {
                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.PhoneNumber))
                        val += $"тел.: {sale.ClientAgreement.Agreement.Organization.PhoneNumber}, ";

                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.USREOU))
                        val += $"код за ЄДРПОУ {sale.ClientAgreement.Agreement.Organization.USREOU}, ";

                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.TIN))
                        val += $"ІПН {sale.ClientAgreement.Agreement.Organization.TIN}";

                    range.Value = val;
                } else {
                    range.Value = val;
                }

                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;

                if (string.IsNullOrEmpty(val))
                    worksheetShipmentList.SetRowHeight(1, rowShipmentList);
            }

            rowShipmentList++;

            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 7, rowShipmentList, columnShipmentList + 75]) {
                range.Merge = true;
                string val = string.Empty;

                switch (sale.ClientAgreement.Agreement.Organization.TypeTaxation) {
                    case TypeTaxation.SingleTax:
                        val = "Є платником єдиного податку";
                        break;
                    case TypeTaxation.SingleTaxAndVat:
                        val = "Є платником єдиного податку та ПДВ";
                        break;
                    case TypeTaxation.IncomeTax:
                        val = "Є платником податку на прибуток";
                        break;
                    case TypeTaxation.IncomeTaxAndVat:
                        val = "Є платником податку на прибуток на загальних підставах";
                        break;
                    case TypeTaxation.NotPaying:
                        val = "Не є платником податку на прибуток на загальних підставах";
                        break;
                }

                range.Value = val;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
            }

            rowShipmentList += 2;
            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList, rowShipmentList, columnShipmentList + 4]) {
                range.Merge = true;
                range.Value = "Покупець:";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.UnderLine = true;
                range.Style.Font.Size = 9;
            }

            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 6, rowShipmentList, columnShipmentList + 75]) {
                range.Merge = true;
                range.Value =
                    string.Format(
                        "{0} ", //{1}
                        sale.RetailClient != null
                            ? sale.RetailClient.Name
                            : !string.IsNullOrEmpty(sale.ClientAgreement.Client.FullName)
                                ? sale.ClientAgreement.Client.FullName
                                : sale.ClientAgreement.Client.Name
                        //, sale.RetailClient != null ? "" : "- " + sale.ClientAgreement.Client.RegionCode?.Value ?? ""
                    );
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 11;
                range.Style.WrapText = true;
            }

            rowShipmentList++;

            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 7, rowShipmentList, columnShipmentList + 75]) {
                string clientInfo = string.Empty;

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.RegionCode?.City)) clientInfo += $"{sale.ClientAgreement.Client.RegionCode.City}, ";

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.RegionCode?.District)) clientInfo += $"{sale.ClientAgreement.Client.RegionCode.District}, ";

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.ActualAddress)) clientInfo += $"{sale.ClientAgreement.Client.ActualAddress}, ";

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.MobileNumber)) clientInfo += $"тел.: {sale.ClientAgreement.Client.MobileNumber}";

                range.Merge = true;
                range.Value = clientInfo;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.WrapText = true;

                if (string.IsNullOrEmpty(clientInfo))
                    worksheetShipmentList.SetRowHeight(1, rowShipmentList);

                if (clientInfo.Length > 80)
                    worksheetShipmentList.SetRowHeight(24, rowShipmentList);
            }

            rowShipmentList += 2;

            int tableStartRowShipmentList = rowShipmentList;

            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList, rowShipmentList + 1, columnShipmentList + 1]) {
                range.Value = "№";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 2, rowShipmentList + 1, columnShipmentList + 14]) {
                range.Value = "Артикул";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 15, rowShipmentList + 1, columnShipmentList + 23]) {
                range.Value = "Розм";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 24, rowShipmentList + 1, columnShipmentList + 48]) {
                range.Value = "Товар";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 49, rowShipmentList + 1, columnShipmentList + 60]) {
                range.Value = "Кількість";
                range.Merge = true;
                range.SetTableHeaderStyle();
            }

            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 61, rowShipmentList + 1, columnShipmentList + 68]) {
                range.Value = "Ціна з ПДВ";
                range.Merge = true;
                range.SetTableHeaderStyle();
                range.Style.WrapText = true;
            }

            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 69, rowShipmentList + 1, columnShipmentList + 76]) {
                range.Value = "Сума з ПДВ";
                range.Merge = true;
                range.SetTableHeaderStyle();
                range.Style.WrapText = true;
            }

            rowShipmentList += 2;

            int tableRowNumberShipmentList = 1;

            foreach (OrderItem item in sale.Order.OrderItems) {
                bool specialItem =
                    item.Product.IsForSale || item.Product.IsForZeroSale || item.Product.Top.ToUpper().Equals("X9") || item.Product.Top.ToUpper().Equals("Х9");

                if (specialItem) {
                    if (item.ProductLocations.Any() || item.ProductLocationsHistory.Any()) {
                        foreach (ProductLocation location in item.ProductLocations) {
                            foreach (ProductLocationHistory locationHistory in item.ProductLocationsHistory.Where(x => x.TypeOfMovement == TypeOfMovement.Return))
                                if (location.ProductPlacementId == locationHistory.ProductPlacementId) {
                                    location.Qty += locationHistory.Qty;
                                    locationHistory.Qty = 0;
                                }

                            //Special OrderItem
                            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList]) {
                                range.Value = tableRowNumberShipmentList;
                                range.Style.Font.Size = 9;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            //Special mark * 
                            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 1]) {
                                range.Value = "*";
                                range.Style.Font.Size = 22;
                                range.Style.Font.Bold = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 2, rowShipmentList, columnShipmentList + 14]) {
                                range.Value = item.Product.VendorCode;
                                range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 14;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 15, rowShipmentList, columnShipmentList + 23]) {
                                string locationAddress =
                                    location.ProductPlacement.StorageNumber +
                                    "-" +
                                    (
                                        string.IsNullOrEmpty(location.ProductPlacement.RowNumber)
                                            ? string.Empty
                                            : $"{location.ProductPlacement.RowNumber}-"
                                    ) +
                                    location.ProductPlacement.CellNumber;

                                range.Value = locationAddress;
                                range.Style.Font.Size = 10;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 24, rowShipmentList, columnShipmentList + 48]) {
                                range.Value = item.Product.Name;
                                range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                range.Merge = true;
                                range.Style.WrapText = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 49, rowShipmentList, columnShipmentList + 54]) {
                                range.Value = location.Qty;
                                range.Style.Font.Size = 16;
                                range.Style.Font.Bold = true;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 55, rowShipmentList, columnShipmentList + 60]) {
                                range.Value = item.Product.MeasureUnit?.Name;
                                range.Style.Font.Size = 11;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 61, rowShipmentList, columnShipmentList + 68]) {
                                //ToDo: local price
                                range.Value =
                                    decimal.Round(
                                        item.Product.CurrentLocalPrice,
                                        2,
                                        MidpointRounding.AwayFromZero
                                    );
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 69, rowShipmentList, columnShipmentList + 76]) {
                                //ToDo: local price
                                range.Value =
                                    decimal.Round(
                                        item.Product.CurrentLocalPrice * Convert.ToDecimal(location.Qty),
                                        2,
                                        MidpointRounding.AwayFromZero
                                    );
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            if (item.Product.Name.Length > 18) {
                                if (item.Product.Name.Length < 35)
                                    worksheetShipmentList.SetRowHeight(28, rowShipmentList);
                                else
                                    worksheetShipmentList.SetRowHeight(35, rowShipmentList);
                            }

                            if (item.Product.VendorCode.Length > 10)
                                worksheetShipmentList.SetRowHeight(35, rowShipmentList);
                            else
                                worksheetShipmentList.SetRowHeight(28, rowShipmentList);

                            rowShipmentList++;
                        }

                        if (item.ProductLocationsHistory.Any())
                            foreach (ProductLocationHistory location in item.ProductLocationsHistory.Where(x => x.Qty != 0)) {
                                //Special OrderItem
                                using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList]) {
                                    range.Value = tableRowNumberShipmentList;
                                    range.Style.Font.Size = 9;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                //Special mark * 
                                using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 1]) {
                                    range.Value = "*";
                                    range.Style.Font.Size = 22;
                                    range.Style.Font.Bold = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 2, rowShipmentList, columnShipmentList + 14]) {
                                    range.Value = item.Product.VendorCode;
                                    range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 14;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 15, rowShipmentList, columnShipmentList + 23]) {
                                    string locationAddress =
                                        location.ProductPlacement.StorageNumber +
                                        "-" +
                                        (
                                            string.IsNullOrEmpty(location.ProductPlacement.RowNumber)
                                                ? string.Empty
                                                : $"{location.ProductPlacement.RowNumber}-"
                                        ) +
                                        location.ProductPlacement.CellNumber;

                                    range.Value = locationAddress;
                                    range.Style.Font.Size = 10;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 24, rowShipmentList, columnShipmentList + 48]) {
                                    range.Value = item.Product.Name;
                                    range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                    range.Merge = true;
                                    range.Style.WrapText = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 49, rowShipmentList, columnShipmentList + 54]) {
                                    range.Value = location.Qty;
                                    range.Style.Font.Size = 16;
                                    range.Style.Font.Bold = true;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 55, rowShipmentList, columnShipmentList + 60]) {
                                    range.Value = item.Product.MeasureUnit?.Name;
                                    range.Style.Font.Size = 11;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 61, rowShipmentList, columnShipmentList + 68]) {
                                    //ToDo: local price
                                    range.Value =
                                        decimal.Round(
                                            item.Product.CurrentLocalPrice,
                                            2,
                                            MidpointRounding.AwayFromZero
                                        );
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 69, rowShipmentList, columnShipmentList + 76]) {
                                    //ToDo: local price
                                    range.Value =
                                        decimal.Round(
                                            item.Product.CurrentLocalPrice * Convert.ToDecimal(location.Qty),
                                            2,
                                            MidpointRounding.AwayFromZero
                                        );
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                    range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                if (item.Product.Name.Length > 18) {
                                    if (item.Product.Name.Length < 35)
                                        worksheetShipmentList.SetRowHeight(28, rowShipmentList);
                                    else
                                        worksheetShipmentList.SetRowHeight(35, rowShipmentList);
                                }

                                if (item.Product.VendorCode.Length > 10)
                                    worksheetShipmentList.SetRowHeight(35, rowShipmentList);
                                else
                                    worksheetShipmentList.SetRowHeight(28, rowShipmentList);

                                rowShipmentList++;
                            }

                        if (item.ProductLocations.Sum(l => l.Qty) + item.ProductLocationsHistory.Sum(g => g.Qty) < item.Qty) {
                            //Special OrderItem
                            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList]) {
                                range.Value = tableRowNumberShipmentList;
                                range.Style.Font.Size = 9;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            //Special mark * 
                            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 1]) {
                                range.Value = "*";
                                range.Style.Font.Size = 22;
                                range.Style.Font.Bold = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 2, rowShipmentList, columnShipmentList + 14]) {
                                range.Value = item.Product.VendorCode;
                                range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 14;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 15, rowShipmentList, columnShipmentList + 23]) {
                                range.Value = item.Product.Name;
                                range.Merge = true;
                                range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                range.Style.WrapText = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 24, rowShipmentList, columnShipmentList + 48]) {
                                range.Value = string.Empty;
                                range.Style.Font.Size = 10;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            double totalQty = item.Qty - (item.ProductLocations.Sum(l => l.Qty) + item.ProductLocationsHistory.Sum(g => g.Qty));
                            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 49, rowShipmentList, columnShipmentList + 54]) {
                                range.Value = totalQty;
                                range.Style.Font.Size = 16;
                                range.Style.Font.Bold = true;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 55, rowShipmentList, columnShipmentList + 60]) {
                                range.Value = item.Product.MeasureUnit?.Name;
                                range.Style.Font.Size = 11;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 61, rowShipmentList, columnShipmentList + 68]) {
                                //ToDo: local price
                                range.Value =
                                    decimal.Round(
                                        item.Product.CurrentLocalPrice,
                                        2,
                                        MidpointRounding.AwayFromZero
                                    );
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 69, rowShipmentList, columnShipmentList + 76]) {
                                //ToDo: local price
                                range.Value =
                                    decimal.Round(
                                        item.Product.CurrentLocalPrice * Convert.ToDecimal(totalQty),
                                        2,
                                        MidpointRounding.AwayFromZero
                                    );
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                                range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            if (item.Product.Name.Length > 18) {
                                if (item.Product.Name.Length < 35)
                                    worksheetShipmentList.SetRowHeight(28, rowShipmentList);
                                else
                                    worksheetShipmentList.SetRowHeight(35, rowShipmentList);
                            }

                            if (item.Product.VendorCode.Length > 10)
                                worksheetShipmentList.SetRowHeight(35, rowShipmentList);
                            else
                                worksheetShipmentList.SetRowHeight(28, rowShipmentList);

                            rowShipmentList++;
                        }
                    } else {
                        using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList]) {
                            range.Value = tableRowNumberShipmentList;
                            range.Style.Font.Size = 9;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 1]) {
                            range.Value = "*";
                            range.Style.Font.Size = 22;
                            range.Style.Font.Bold = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 2, rowShipmentList, columnShipmentList + 14]) {
                            range.Value = item.Product.VendorCode;
                            range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 14;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 15, rowShipmentList, columnShipmentList + 23]) {
                            range.Value = string.Empty;
                            range.Style.Font.Size = 10;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 24, rowShipmentList, columnShipmentList + 48]) {
                            range.Value = item.Product.Name;
                            range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                            range.Merge = true;
                            range.Style.WrapText = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 49, rowShipmentList, columnShipmentList + 54]) {
                            range.Value = item.Qty;
                            range.Style.Font.Size = 16;
                            range.Style.Font.Bold = true;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 55, rowShipmentList, columnShipmentList + 60]) {
                            range.Value = item.Product.MeasureUnit?.Name;
                            range.Style.Font.Size = 11;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 61, rowShipmentList, columnShipmentList + 68]) {
                            //ToDo: local price
                            range.Value =
                                decimal.Round(
                                    item.Product.CurrentLocalPrice,
                                    2,
                                    MidpointRounding.AwayFromZero
                                );
                            range.Style.Font.Size = 11;
                            range.Style.Numberformat.Format = "0.00";
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 69, rowShipmentList, columnShipmentList + 76]) {
                            //ToDo: local price
                            range.Value =
                                decimal.Round(
                                    item.Product.CurrentLocalPrice * Convert.ToDecimal(item.Qty),
                                    2,
                                    MidpointRounding.AwayFromZero
                                );
                            range.Style.Font.Size = 11;
                            range.Style.Numberformat.Format = "0.00";
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Fill.PatternType = ExcelFillStyle.Solid;
                            range.Style.Fill.BackgroundColor.SetColor(Color.FromArgb(206, 255, 255));
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        if (item.Product.Name.Length > 18) {
                            if (item.Product.Name.Length < 35)
                                worksheetShipmentList.SetRowHeight(28, rowShipmentList);
                            else
                                worksheetShipmentList.SetRowHeight(35, rowShipmentList);
                        }

                        if (item.Product.VendorCode.Length > 10)
                            worksheetShipmentList.SetRowHeight(35, rowShipmentList);
                        else
                            worksheetShipmentList.SetRowHeight(28, rowShipmentList);

                        rowShipmentList++;
                    }
                } else {
                    if (item.ProductLocations.Any() || item.ProductLocationsHistory.Any()) {
                        foreach (ProductLocation location in item.ProductLocations) {
                            foreach (ProductLocationHistory locationHistory in item.ProductLocationsHistory.Where(x => x.TypeOfMovement == TypeOfMovement.Return))
                                if (location.ProductPlacementId == locationHistory.ProductPlacementId) {
                                    location.Qty += locationHistory.Qty;
                                    locationHistory.Qty = 0;
                                }

                            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList, rowShipmentList, columnShipmentList + 1]) {
                                range.Value = tableRowNumberShipmentList;
                                range.Style.Font.Size = 9;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 2, rowShipmentList, columnShipmentList + 14]) {
                                range.Value = item.Product.VendorCode;
                                range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 14;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 15, rowShipmentList, columnShipmentList + 23]) {
                                string locationAddress =
                                    location.ProductPlacement.StorageNumber +
                                    "-" +
                                    (
                                        string.IsNullOrEmpty(location.ProductPlacement.RowNumber)
                                            ? string.Empty
                                            : $"{location.ProductPlacement.RowNumber}-"
                                    ) +
                                    location.ProductPlacement.CellNumber;

                                range.Value = locationAddress;
                                range.Style.Font.Size = 10;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 24, rowShipmentList, columnShipmentList + 48]) {
                                range.Value = item.Product.Name;
                                range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                range.Merge = true;
                                range.Style.WrapText = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 49, rowShipmentList, columnShipmentList + 54]) {
                                range.Value = location.Qty;
                                range.Style.Font.Size = 16;
                                range.Style.Font.Bold = true;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 55, rowShipmentList, columnShipmentList + 60]) {
                                range.Value = item.Product.MeasureUnit?.Name;
                                range.Style.Font.Size = 11;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 61, rowShipmentList, columnShipmentList + 68]) {
                                //ToDo: local price
                                range.Value =
                                    decimal.Round(
                                        item.Product.CurrentLocalPrice,
                                        2,
                                        MidpointRounding.AwayFromZero
                                    );
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 69, rowShipmentList, columnShipmentList + 76]) {
                                //ToDo: local price
                                range.Value =
                                    decimal.Round(
                                        item.Product.CurrentLocalPrice * Convert.ToDecimal(location.Qty),
                                        2,
                                        MidpointRounding.AwayFromZero
                                    );
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            if (item.Product.Name.Length > 18) {
                                if (item.Product.Name.Length < 35)
                                    worksheetShipmentList.SetRowHeight(28, rowShipmentList);
                                else
                                    worksheetShipmentList.SetRowHeight(35, rowShipmentList);
                            }

                            if (item.Product.VendorCode.Length > 10)
                                worksheetShipmentList.SetRowHeight(35, rowShipmentList);
                            else
                                worksheetShipmentList.SetRowHeight(28, rowShipmentList);

                            rowShipmentList++;
                        }

                        if (item.ProductLocationsHistory.Any())
                            foreach (ProductLocationHistory location in item.ProductLocationsHistory.Where(x => x.Qty != 0)) {
                                //Special OrderItem
                                using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList, rowShipmentList, columnShipmentList + 1]) {
                                    range.Value = tableRowNumberShipmentList;
                                    range.Style.Font.Size = 9;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 2, rowShipmentList, columnShipmentList + 14]) {
                                    range.Value = item.Product.VendorCode;
                                    range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 14;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 15, rowShipmentList, columnShipmentList + 23]) {
                                    string locationAddress =
                                        location.ProductPlacement.StorageNumber +
                                        "-" +
                                        (
                                            string.IsNullOrEmpty(location.ProductPlacement.RowNumber)
                                                ? string.Empty
                                                : $"{location.ProductPlacement.RowNumber}-"
                                        ) +
                                        location.ProductPlacement.CellNumber;

                                    range.Value = locationAddress;
                                    range.Style.Font.Size = 10;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 24, rowShipmentList, columnShipmentList + 48]) {
                                    range.Value = item.Product.Name;
                                    range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                    range.Merge = true;
                                    range.Style.WrapText = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 49, rowShipmentList, columnShipmentList + 54]) {
                                    range.Value = location.Qty;
                                    range.Style.Font.Size = 16;
                                    range.Style.Font.Bold = true;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 55, rowShipmentList, columnShipmentList + 60]) {
                                    range.Value = item.Product.MeasureUnit?.Name;
                                    range.Style.Font.Size = 11;
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 61, rowShipmentList, columnShipmentList + 68]) {
                                    //ToDo: local price
                                    range.Value =
                                        decimal.Round(
                                            item.Product.CurrentLocalPrice,
                                            2,
                                            MidpointRounding.AwayFromZero
                                        );
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 69, rowShipmentList, columnShipmentList + 76]) {
                                    //ToDo: local price
                                    range.Value =
                                        decimal.Round(
                                            item.Product.CurrentLocalPrice * Convert.ToDecimal(location.Qty),
                                            2,
                                            MidpointRounding.AwayFromZero
                                        );
                                    range.Style.Font.Size = 11;
                                    range.Style.Numberformat.Format = "0.00";
                                    range.Merge = true;
                                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                                }

                                if (item.Product.Name.Length > 18) {
                                    if (item.Product.Name.Length < 35)
                                        worksheetShipmentList.SetRowHeight(28, rowShipmentList);
                                    else
                                        worksheetShipmentList.SetRowHeight(35, rowShipmentList);
                                }

                                if (item.Product.VendorCode.Length > 10)
                                    worksheetShipmentList.SetRowHeight(35, rowShipmentList);
                                else
                                    worksheetShipmentList.SetRowHeight(28, rowShipmentList);

                                rowShipmentList++;
                            }

                        if (item.ProductLocations.Sum(l => l.Qty) + item.ProductLocationsHistory.Sum(g => g.Qty) < item.Qty) {
                            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList, rowShipmentList, columnShipmentList + 1]) {
                                range.Value = tableRowNumberShipmentList;
                                range.Style.Font.Size = 9;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 2, rowShipmentList, columnShipmentList + 14]) {
                                range.Value = item.Product.VendorCode;
                                range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 14;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }


                            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 15, rowShipmentList, columnShipmentList + 23]) {
                                range.Value = string.Empty;
                                range.Style.Font.Size = 10;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 24, rowShipmentList, columnShipmentList + 48]) {
                                range.Value = item.Product.Name;
                                range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                                range.Merge = true;
                                range.Style.WrapText = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            double totalQty = item.Qty - (item.ProductLocations.Sum(l => l.Qty) + item.ProductLocationsHistory.Sum(g => g.Qty));
                            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 49, rowShipmentList, columnShipmentList + 54]) {
                                range.Value = totalQty;
                                range.Style.Font.Size = 16;
                                range.Style.Font.Bold = true;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 55, rowShipmentList, columnShipmentList + 60]) {
                                range.Value = item.Product.MeasureUnit?.Name;
                                range.Style.Font.Size = 11;
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 61, rowShipmentList, columnShipmentList + 68]) {
                                //ToDo: local price
                                range.Value =
                                    decimal.Round(
                                        item.Product.CurrentLocalPrice,
                                        2,
                                        MidpointRounding.AwayFromZero
                                    );
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 69, rowShipmentList, columnShipmentList + 76]) {
                                //ToDo: local price
                                range.Value =
                                    decimal.Round(
                                        item.Product.CurrentLocalPrice *
                                        Convert.ToDecimal(item.Qty - (item.ProductLocations.Sum(l => l.Qty) + item.ProductLocationsHistory.Sum(g => g.Qty))),
                                        2,
                                        MidpointRounding.AwayFromZero
                                    );
                                range.Style.Font.Size = 11;
                                range.Style.Numberformat.Format = "0.00";
                                range.Merge = true;
                                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                                range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                            }

                            if (item.Product.Name.Length > 18) {
                                if (item.Product.Name.Length < 35)
                                    worksheetShipmentList.SetRowHeight(28, rowShipmentList);
                                else
                                    worksheetShipmentList.SetRowHeight(35, rowShipmentList);
                            }

                            if (item.Product.VendorCode.Length > 10)
                                worksheetShipmentList.SetRowHeight(35, rowShipmentList);
                            else
                                worksheetShipmentList.SetRowHeight(28, rowShipmentList);

                            rowShipmentList++;
                        }
                    } else {
                        using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList, rowShipmentList, columnShipmentList + 1]) {
                            range.Value = tableRowNumberShipmentList;
                            range.Style.Font.Size = 9;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 2, rowShipmentList, columnShipmentList + 14]) {
                            range.Value = item.Product.VendorCode;
                            range.Style.Font.Size = item.Product.VendorCode.Length > 10 ? 9 : 14;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 15, rowShipmentList, columnShipmentList + 23]) {
                            range.Value = item.AssignedSpecification?.SpecificationCode;
                            range.Style.Font.Size = 10;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 24, rowShipmentList, columnShipmentList + 48]) {
                            range.Value = item.Product.Name;
                            range.Style.Font.Size = item.Product.Name.Length > 10 ? 9 : 11;
                            range.Merge = true;
                            range.Style.WrapText = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 49, rowShipmentList, columnShipmentList + 54]) {
                            range.Value = item.Qty;
                            range.Style.Font.Size = 16;
                            range.Style.Font.Bold = true;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 55, rowShipmentList, columnShipmentList + 60]) {
                            range.Value = item.Product.MeasureUnit?.Name;
                            range.Style.Font.Size = 11;
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 61, rowShipmentList, columnShipmentList + 68]) {
                            //ToDo: local price
                            range.Value =
                                decimal.Round(
                                    item.Product.CurrentLocalPrice,
                                    2,
                                    MidpointRounding.AwayFromZero
                                );
                            range.Style.Font.Size = 11;
                            range.Style.Numberformat.Format = "0.00";
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 69, rowShipmentList, columnShipmentList + 76]) {
                            //ToDo: local price
                            range.Value =
                                decimal.Round(
                                    item.Product.CurrentLocalPrice * Convert.ToDecimal(item.Qty),
                                    2,
                                    MidpointRounding.AwayFromZero
                                );
                            range.Style.Font.Size = 11;
                            range.Style.Numberformat.Format = "0.00";
                            range.Merge = true;
                            range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                            range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                            range.Style.Border.BorderAround(ExcelBorderStyle.Thin);
                        }

                        if (item.Product.Name.Length > 18) {
                            if (item.Product.Name.Length < 35)
                                worksheetShipmentList.SetRowHeight(28, rowShipmentList);
                            else
                                worksheetShipmentList.SetRowHeight(35, rowShipmentList);
                        }

                        if (item.Product.VendorCode.Length > 10)
                            worksheetShipmentList.SetRowHeight(35, rowShipmentList);
                        else
                            worksheetShipmentList.SetRowHeight(28, rowShipmentList);
                        tableStartRowShipmentList++;
                    }
                }

                tableRowNumberShipmentList++;
            }

            rowShipmentList++;
            int tableEndRowShipmentList = rowShipmentList - 1;

            //using (ExcelRange range = worksheetShipmentList.Cells[tableStartRowShipmentList, columnShipmentList, tableEndRowShipmentList, columnShipmentList + 76]) {
            //    range.Style.Border.BorderAround(ExcelBorderStyle.Medium);
            //}

            worksheetShipmentList.SetRowHeight(6.95, rowShipmentList);
            worksheetShipmentList.SetRowHeight(15, ++rowShipmentList);

            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList, rowShipmentList, columnShipmentList + 23]) {
                range.Value = $"{DateTime.Now.ToString("dd.MM.yyyy HH.mm.ss")} {sale.ClientAgreement.Agreement.Organization.Manager}";
                range.Style.Font.Size = 7;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 60, rowShipmentList, columnShipmentList + 66]) {
                range.Value = "Разом:";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 68, rowShipmentList, columnShipmentList + 75]) {
                range.Value = totalAmountShipmentList;
                range.Style.Font.Size = 11;
                range.Style.Numberformat.Format = "0.00";
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            rowShipmentList++;

            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 52, rowShipmentList, columnShipmentList + 66]) {
                range.Value = "У тому числі ПДВ:";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 68, rowShipmentList, columnShipmentList + 75]) {
                decimal vatRate =
                    sale.ClientAgreement.Agreement.Organization.VatRate != null
                        ? Convert.ToDecimal(sale.ClientAgreement.Agreement.Organization.VatRate.Value) / 100
                        : 0;

                range.Value = decimal.Round(totalAmountShipmentList * (vatRate / (1 + vatRate)), 2, MidpointRounding.AwayFromZero);
                range.Style.Font.Size = 11;
                range.Style.Numberformat.Format = "0.00";
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
            }

            worksheetShipmentList.SetRowHeight(6.95, ++rowShipmentList);
            worksheetShipmentList.SetRowHeight(11.25, ++rowShipmentList);

            if (sale.ClientAgreement.Agreement.Currency.Code.ToLower().Equals("eur")) {
                using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList, rowShipmentList, columnShipmentList + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {totalAmountShipmentList} EUR.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheetShipmentList.SetRowHeight(12.75, ++rowShipmentList);

                using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList, rowShipmentList, columnShipmentList + 75]) {
                    int fullNumber = Convert.ToInt32(Math.Round(totalAmountShipmentList % 1, 2) * 100);
                    int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                    string endKeyWord;

                    if (fullNumber > 10 && fullNumber < 20)
                        endKeyWord = "центів";
                    else
                        switch (endNumber) {
                            case 1:
                                endKeyWord = "цент";
                                break;
                            case 2:
                            case 3:
                            case 4:
                                endKeyWord = "цента";
                                break;
                            default:
                                endKeyWord = "центів";
                                break;
                        }

                    range.Value = $"{totalAmountShipmentList.ToText(true, true)} євро {(Math.Round(totalAmountShipmentList % 1, 2) * 100).ToText(false, true)} {endKeyWord}";
                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            } else if (sale.ClientAgreement.Agreement.Currency.Code.ToLower().Equals("usd")) {
                using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, column, rowShipmentList, columnShipmentList + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {totalAmountShipmentList} USD.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheetShipmentList.SetRowHeight(12.75, ++rowShipmentList);

                using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList, rowShipmentList, columnShipmentList + 75]) {
                    int fullNumber = Convert.ToInt32(Math.Round(totalAmountShipmentList % 1, 2) * 100);
                    int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                    string endKeyWord;

                    if (fullNumber > 10 && fullNumber < 20)
                        endKeyWord = "центів";
                    else
                        switch (endNumber) {
                            case 1:
                                endKeyWord = "цент";
                                break;
                            case 2:
                            case 3:
                            case 4:
                                endKeyWord = "цента";
                                break;
                            default:
                                endKeyWord = "центів";
                                break;
                        }

                    range.Value = $"{totalAmountShipmentList.ToText(true, true)} доларів {(Math.Round(totalAmountShipmentList % 1, 2) * 100).ToText(false, true)} {endKeyWord}";
                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            } else if (sale.ClientAgreement.Agreement.Currency.Code.ToLower().Equals("pln")) {
                using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList, rowShipmentList, columnShipmentList + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {decimal.Round(totalAmountShipmentList, 2, MidpointRounding.AwayFromZero)} PLN.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheetShipmentList.SetRowHeight(12.75, ++rowShipmentList);

                using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList, rowShipmentList, columnShipmentList + 75]) {
                    int fullNumber = Convert.ToInt32(Math.Round(decimal.Round(totalAmountShipmentList, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100);
                    int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                    string endKeyWord;

                    if (fullNumber > 10 && fullNumber < 20)
                        endKeyWord = "грошів";
                    else
                        switch (endNumber) {
                            case 1:
                                endKeyWord = "грош";
                                break;
                            case 2:
                            case 3:
                            case 4:
                                endKeyWord = "гроша";
                                break;
                            default:
                                endKeyWord = "грошів";
                                break;
                        }

                    range.Value =
                        $"{decimal.Round(totalAmountShipmentList, 2, MidpointRounding.AwayFromZero).ToText(true, true)} злотих {(Math.Round(decimal.Round(totalAmount, 2, MidpointRounding.AwayFromZero) % 1, 2) * 100).ToText(false, true)} {endKeyWord}";
                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            } else {
                using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList, rowShipmentList, columnShipmentList + 75]) {
                    range.Value = $"Всього найменувань {sale.Order.OrderItems.Count}, на суму {Math.Round(totalAmountShipmentList, 2, MidpointRounding.AwayFromZero)} ГРН.";
                    range.Style.Font.Size = 8;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
                }

                worksheetShipmentList.SetRowHeight(12.75, ++rowShipmentList);

                using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList, rowShipmentList, columnShipmentList + 75]) {
                    int fullNumber = Convert.ToInt32(Math.Round(totalAmountShipmentList % 1, 2) * 100);
                    int endNumber = Convert.ToInt32(fullNumber.ToString().Last().ToString());

                    string endKeyWord;

                    if (fullNumber > 10 && fullNumber < 20)
                        endKeyWord = "копійок";
                    else
                        switch (endNumber) {
                            case 1:
                                endKeyWord = "копійка";
                                break;
                            case 2:
                            case 3:
                            case 4:
                                endKeyWord = "копійки";
                                break;
                            default:
                                endKeyWord = "копійок";
                                break;
                        }

                    range.Value = $"{totalAmountShipmentList.ToText(true, true)} гривень {(Math.Round(totalAmountShipmentList % 1, 2) * 100).ToText(false, true)} {endKeyWord}";
                    range.Style.Font.Size = 9;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }
            }

            worksheetShipmentList.SetRowHeight(6.95, ++rowShipmentList);
            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList, rowShipmentList, columnShipmentList + 75]) {
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Medium;
            }

            rowShipmentList++;

            worksheetShipmentList.SetRowHeight(12.75, ++rowShipmentList);

            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList, rowShipmentList, columnShipmentList + 5]) {
                range.Value = "Відвантажив(ла): ";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 6, rowShipmentList, columnShipmentList + 29]) {
                range.Value = "директор " + sale.ClientAgreement.Agreement.Organization.Manager;
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList + 1, columnShipmentList + 6, rowShipmentList + 1, columnShipmentList + 29]) {
                range.Style.Border.Top.Style = ExcelBorderStyle.Thin;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 36, rowShipmentList, columnShipmentList + 51]) {
                range.Value = "Отримав(ла):";
                range.Style.Font.Size = 9;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 52, rowShipmentList, columnShipmentList + 73]) {
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Thin;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            worksheetShipmentList.SetRowHeight(14.75, ++rowShipmentList);
            worksheetShipmentList.SetRowHeight(14.75, rowShipmentList + 1);

            worksheetShipmentList.SetRowHeight(6.95, ++rowShipmentList);
            worksheetShipmentList.SetRowHeight(12.75, ++rowShipmentList);

            if (sale.Order.OrderItems.Any(x => x.OneTimeDiscount > 0)) {
                worksheetShipmentList.SetRowHeight(24, ++rowShipmentList);

                using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList, rowShipmentList, columnShipmentList + 75]) {
                    range.Value = "* - замовлений або акційний товар поверненню не підлягає";
                    range.Style.Font.Size = 18;
                    range.Style.Font.Bold = true;
                    range.Merge = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Top;
                }

                rowShipmentList++;
            }

            worksheetShipmentList.SetRowHeight(12.75, ++rowShipmentList);

            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 1, rowShipmentList, columnShipmentList + 75]) {
                range.Value = "Вимоги до повернень";
                range.Style.Font.Size = 10;
                range.Style.Font.Bold = true;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            }

            rowShipmentList++;
            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 1, rowShipmentList, columnShipmentList + 75]) {
                range.Value = "1)Товар має бути запакований";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            rowShipmentList++;
            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 1, rowShipmentList, columnShipmentList + 75]) {
                range.Value = "2)Коробка даного товару і сам товар мають бути без пошкоджень";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            rowShipmentList++;
            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 1, rowShipmentList, columnShipmentList + 75]) {
                range.Value = "3)Повинні бути документи на повернення: від кого і причина повернення в письмовому вигляді";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }

            rowShipmentList++;
            using (ExcelRange range = worksheetShipmentList.Cells[rowShipmentList, columnShipmentList + 1, rowShipmentList, columnShipmentList + 75]) {
                range.Value = "4)Товар не буде прийматися, якщо вказане не буде виконано, і в цьому випадку товар буде відправлено назад покупцеві.";
                range.Style.Font.Size = 8;
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Bottom;
            }


            package.Save();
        }

        return SaveFiles(fileName);
    }

    public (string xlsxFile, string pdfFile) ExportUkSaleByNetIdWithShiftedItemsToXlsx(string path, Sale sale, IEnumerable<DocumentMonth> months) {
        string fileName = Path.Combine(path, $"ShipmentList_{DateTime.Now.ToString("MM.yyyy")}_{Guid.NewGuid().ToString()}.xlsx");

        using (ExcelPackage package = NewExcelPackage(fileName)) {
            ExcelWorksheet worksheet = package.Workbook.Worksheets.Add("ShipmentList Document");

            worksheet.ApplyPrinterSettings(0.3m, 0.3m, 0.1m, 0.1m, 0.3m, 0.3m, true);

            int row = 2;
            int column = 1;
            using (ExcelRange range = worksheet.Cells[row, column, row, column + 10]) {
                range.Merge = true;
                range.Value = "Акт редагування";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 14;
                range.Style.Font.Bold = true;
            }

            row += 2;

            using (ExcelRange range = worksheet.Cells[row, column, row, column + 10]) {
                range.Merge = true;
                string invoice = "Видаткова накладна № {0} від {1} р.";
                range.Value = string.Format(
                    invoice,
                    sale.SaleNumber.Value,
                    $"{sale.ChangedToInvoice.Value.Day} {months.FirstOrDefault(m => m.Number.Equals(sale.ChangedToInvoice.Value.Month))?.Name.ToLower()} {sale.ChangedToInvoice.Value.Year}"
                );
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Border.Bottom.Style = ExcelBorderStyle.Medium;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 14;
            }

            row += 2;
            //worksheet.Column(column).Width = 10;

            using (ExcelRange range = worksheet.Cells[row, column, row, column + 1]) {
                range.Merge = true;
                range.Value = "Постачальник:";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.UnderLine = true;
                range.Style.Font.Size = 9;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 10]) {
                range.Merge = true;
                range.Value = sale.ClientAgreement.Agreement.Organization.FullName;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                //range.Style.Font.Bold = true;
                range.Style.Font.Size = 10;
                //range.Style.WrapText = true;
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 10]) {
                range.Merge = true;
                string val = string.Empty;
                if (sale.ClientAgreement.Agreement.Organization.MainPaymentRegister != null) {
                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.AccountNumber))
                        val += $"П/р {sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.AccountNumber}, ";

                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.BankName))
                        val += $"у банку {sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.BankName}, ";

                    range.Value = val;
                } else {
                    range.Value = val;
                }

                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;

                if (string.IsNullOrEmpty(val))
                    worksheet.SetRowHeight(1, row);
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 10]) {
                range.Merge = true;
                string val = string.Empty;

                if (sale.ClientAgreement.Agreement.Organization.MainPaymentRegister != null) {
                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.City))
                        val += $"м. {sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.City}, ";

                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.SortCode))
                        val += $"МФО {sale.ClientAgreement.Agreement.Organization.MainPaymentRegister.SortCode}, ";

                    range.Value = val;
                } else {
                    range.Value = val;
                }

                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;

                if (string.IsNullOrEmpty(val))
                    worksheet.SetRowHeight(1, row);
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 10]) {
                range.Merge = true;
                string val = string.Empty;

                if (sale.ClientAgreement.Agreement.Organization.MainPaymentRegister != null) {
                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.Address))
                        val += $"{sale.ClientAgreement.Agreement.Organization.Address}, ";
                    range.Value = val;
                } else {
                    range.Value = val;
                }

                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;

                if (string.IsNullOrEmpty(val))
                    worksheet.SetRowHeight(1, row);
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 10]) {
                range.Merge = true;
                string val = string.Empty;

                if (sale.ClientAgreement.Agreement.Organization.MainPaymentRegister != null) {
                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.PhoneNumber))
                        val += $"тел.: {sale.ClientAgreement.Agreement.Organization.PhoneNumber}, ";

                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.USREOU))
                        val += $"код за ЄДРПОУ {sale.ClientAgreement.Agreement.Organization.USREOU}, ";

                    if (!string.IsNullOrEmpty(sale.ClientAgreement.Agreement.Organization.TIN))
                        val += $"ІПН {sale.ClientAgreement.Agreement.Organization.TIN}";

                    range.Value = val;
                } else {
                    range.Value = val;
                }

                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;

                if (string.IsNullOrEmpty(val))
                    worksheet.SetRowHeight(1, row);
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 10]) {
                range.Merge = true;
                string val = string.Empty;

                switch (sale.ClientAgreement.Agreement.Organization.TypeTaxation) {
                    case TypeTaxation.SingleTax:
                        val = "Є платником єдиного податку";
                        break;
                    case TypeTaxation.SingleTaxAndVat:
                        val = "Є платником єдиного податку та ПДВ";
                        break;
                    case TypeTaxation.IncomeTax:
                        val = "Є платником податку на прибуток";
                        break;
                    case TypeTaxation.IncomeTaxAndVat:
                        val = "Є платником податку на прибуток на загальних підставах";
                        break;
                    case TypeTaxation.NotPaying:
                        val = "Не є платником податку на прибуток на загальних підставах";
                        break;
                }

                range.Value = val;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
            }

            row += 2;
            //worksheet.Column(column).Width = 10;
            using (ExcelRange range = worksheet.Cells[row, column, row, column + 1]) {
                range.Merge = true;
                range.Value = "Покупець:";
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.UnderLine = true;
                range.Style.Font.Size = 9;
            }

            using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 10]) {
                range.Merge = true;
                range.Value =
                    string.Format(
                        "{0} {1}",
                        !string.IsNullOrEmpty(sale.ClientAgreement.Client.FullName) ? sale.ClientAgreement.Client.FullName : sale.ClientAgreement.Client.Name,
                        sale.ClientAgreement.Client.RegionCode == null ? "" : "- " + sale.ClientAgreement.Client.RegionCode.Value
                    );
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Bold = true;
                range.Style.Font.Size = 11;
            }

            row++;

            using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 10]) {
                string clientInfo = string.Empty;

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.RegionCode?.City)) clientInfo += $"{sale.ClientAgreement.Client.RegionCode.City}, ";

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.RegionCode?.District)) clientInfo += $"{sale.ClientAgreement.Client.RegionCode.District}, ";

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.ActualAddress)) clientInfo += $"{sale.ClientAgreement.Client.ActualAddress}, ";

                if (!string.IsNullOrEmpty(sale.ClientAgreement.Client.MobileNumber) && !sale.RetailClientId.HasValue)
                    clientInfo += $"тел.: {sale.ClientAgreement.Client.MobileNumber}";

                range.Merge = true;
                range.Value = clientInfo;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Style.Font.Size = 10;
                range.Style.WrapText = true;

                if (string.IsNullOrEmpty(clientInfo))
                    worksheet.SetRowHeight(1, row);

                if (clientInfo.Length > 80)
                    worksheet.SetRowHeight(24, row);
            }

            row += 2;

            if (sale.ClientAgreement.Agreement.WithAgreementLine && !sale.ClientAgreement.Client.ClientInRole.ClientTypeRole.Name.ToLower().Equals("shopclient")) {
                using (ExcelRange range = worksheet.Cells[row, column, row, column + 1]) {
                    range.Merge = true;
                    range.Value = "Договір:";
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    range.Style.Font.UnderLine = true;
                    range.Style.Font.Size = 9;
                }

                using (ExcelRange range = worksheet.Cells[row, column + 2, row, column + 10]) {
                    range.Merge = true;
                    string fromDateStringFormat = string.Empty;

                    if (sale.ClientAgreement.Agreement.FromDate.HasValue)
                        fromDateStringFormat = TimeZoneInfo.ConvertTimeFromUtc(
                            sale.ClientAgreement.Agreement.FromDate.Value,
                            TimeZoneInfo.FindSystemTimeZoneById(
                                CultureInfo.CurrentCulture.TwoLetterISOLanguageName.Equals("uk")
                                    ? "FLE Standard Time"
                                    : "Central European Standard Time"
                            )).ToString("dd.MM.yyyy");

                    range.Value = $"№ {sale.ClientAgreement.Agreement.Number} від {fromDateStringFormat}";

                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    range.Style.Font.Size = 10;
                }
            }

            row += 2;

            //row++;
            using (ExcelRange range = worksheet.Cells[row, column, row, column]) {
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Value = "№";
                range.Style.Border.BorderAround(ExcelBorderStyle.Thin, Color.FromArgb(0, 0, 0));
            }

            worksheet.Column(column).Width = 2;
            column++;

            using (ExcelRange range = worksheet.Cells[row, column, row, column]) {
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Value = "Артикул";
                range.Style.Border.BorderAround(ExcelBorderStyle.Thin, Color.FromArgb(0, 0, 0));
            }

            worksheet.Column(column).Width = 15;
            column++;


            //using (ExcelRange range = worksheet.Cells[row, column, row, column]) {
            //    range.Merge = true;
            //    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
            //    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            //    range.Value = "Розміщення";
            //    range.Style.WrapText = true;
            //    range.Style.Border.BorderAround(ExcelBorderStyle.Thin, Color.FromArgb(0, 0, 0));
            //}
            //column++;

            using (ExcelRange range = worksheet.Cells[row, column, row, column]) {
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Value = "Товар";
                range.Style.WrapText = true;
                range.Style.Border.BorderAround(ExcelBorderStyle.Thin, Color.FromArgb(0, 0, 0));
            }

            worksheet.Column(column).Width = 30;
            column++;


            using (ExcelRange range = worksheet.Cells[row, column, row, column]) {
                range.Merge = true;
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Value = "Розміщення";
                range.Style.Border.BorderAround(ExcelBorderStyle.Thin, Color.FromArgb(0, 0, 0));
            }

            column++;


            using (ExcelRange range = worksheet.Cells[row, column, row, column]) {
                range.Merge = true;
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Value = "К-ть стара";
                range.Style.Border.BorderAround(ExcelBorderStyle.Thin, Color.FromArgb(0, 0, 0));
            }

            column++;

            using (ExcelRange range = worksheet.Cells[row, column, row, column]) {
                range.Merge = true;
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Value = "К-ть нова";
                range.Style.Border.BorderAround(ExcelBorderStyle.Thin, Color.FromArgb(0, 0, 0));
            }

            column++;
            using (ExcelRange range = worksheet.Cells[row, column, row, column]) {
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Value = "Різниця";
                range.Style.Border.BorderAround(ExcelBorderStyle.Thin, Color.FromArgb(0, 0, 0));
            }

            column++;
            //using (ExcelRange range = worksheet.Cells[row, column, row, column]) {
            //    range.Merge = true;
            //    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
            //    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            //    range.Value = "Місце зберігання";
            //    range.Style.WrapText = true;
            //    range.Style.Border.BorderAround(ExcelBorderStyle.Thin, Color.FromArgb(0, 0, 0));
            //}
            //worksheet.Column(column).Width = 10;


            //using (ExcelRange range = worksheet.Cells[row, column, row, column]) {
            //    range.Merge = true;
            //    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
            //    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            //    range.Value = "Сума стара";
            //    range.Style.WrapText = true;
            //    range.Style.Border.BorderAround(ExcelBorderStyle.Thin, Color.FromArgb(0, 0, 0));
            //}
            //worksheet.Column(column).Width = 10;
            //column++;

            //using (ExcelRange range = worksheet.Cells[row, column, row, column]) {
            //    range.Merge = true;
            //    range.Style.WrapText = true;
            //    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
            //    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            //    range.Value = "Сума нова";
            //    range.Style.Border.BorderAround(ExcelBorderStyle.Thin, Color.FromArgb(0, 0, 0));
            //}
            //worksheet.Column(column).Width = 10;
            //column++;

            using (ExcelRange range = worksheet.Cells[row, column, row, column]) {
                range.Merge = true;
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Value = "Відповід. за зміну";
                range.Style.Border.BorderAround(ExcelBorderStyle.Thin, Color.FromArgb(0, 0, 0));
            }

            worksheet.Column(column).Width = 15;
            column++;

            using (ExcelRange range = worksheet.Cells[row, column, row, column]) {
                range.Merge = true;
                range.Style.WrapText = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Value = "Дата/час зміни";
                range.Style.Border.BorderAround(ExcelBorderStyle.Thin, Color.FromArgb(0, 0, 0));
            }

            worksheet.Column(column).Width = 20;
            column++;
            row++;

            int count = 1;
            foreach (OrderItem orderItem in sale.Order.OrderItems) {
                double qtyOld = orderItem.Qty + orderItem.ProductLocationsHistory.Where(x => x.TypeOfMovement != TypeOfMovement.Return).Sum(y => y.Qty);
                double qtyNew = orderItem.Qty + orderItem.ProductLocationsHistory.Where(x => x.TypeOfMovement != TypeOfMovement.Return).Sum(y => y.Qty);
                foreach (ProductLocationHistory productLocation in orderItem.ProductLocationsHistory.Where(x => x.TypeOfMovement != TypeOfMovement.Return)) {
                    column = 1;
                    using (ExcelRange range = worksheet.Cells[row, column, row, column]) {
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Font.Size = 8;
                        range.Style.Font.Name = "Arial";
                        range.Value = count;
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin, Color.FromArgb(0, 0, 0));
                    }

                    column++;

                    using (ExcelRange range = worksheet.Cells[row, column, row, column]) {
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Font.Size = 8;
                        range.Style.Font.Name = "Arial";
                        range.Value = orderItem.Product.VendorCode;
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin, Color.FromArgb(0, 0, 0));
                    }

                    column++;

                    //using (ExcelRange range = worksheet.Cells[row, column, row, column]) {
                    //    range.Style.WrapText = true;
                    //    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    //    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    //    range.Style.Font.Size = 8;
                    //    range.Style.Font.Name = "Arial";
                    //    if (shiftStatus.ShiftStatus == GBA.Common.Helpers.OrderItemShiftStatus.Store) {
                    //        range.Value = "Склад";
                    //    } else {
                    //        range.Value = "Рахунок";
                    //    }
                    //    range.Style.Border.BorderAround(ExcelBorderStyle.Thin, Color.FromArgb(0, 0, 0));
                    //}
                    //column++;

                    using (ExcelRange range = worksheet.Cells[row, column, row, column]) {
                        range.Style.WrapText = true;
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Font.Size = 8;
                        range.Style.Font.Name = "Arial";
                        range.Value = orderItem.Product.Name;
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin, Color.FromArgb(0, 0, 0));
                    }

                    column++;

                    using (ExcelRange range = worksheet.Cells[row, column, row, column]) {
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Font.Size = 8;
                        range.Style.Font.Name = "Arial";
                        range.Value = productLocation.ProductPlacement.StorageNumber + "-" + productLocation.ProductPlacement.RowNumber + "-" +
                                      productLocation.ProductPlacement.CellNumber + " ";
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin, Color.FromArgb(0, 0, 0));
                    }

                    column++;


                    //qtyNew = qtyNew - shiftStatus.Qty;
                    using (ExcelRange range = worksheet.Cells[row, column, row, column]) {
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Font.Size = 8;
                        range.Style.Font.Name = "Arial";
                        range.Value = qtyOld;
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin, Color.FromArgb(0, 0, 0));
                    }

                    column++;
                    qtyNew = qtyNew - productLocation.Qty;
                    using (ExcelRange range = worksheet.Cells[row, column, row, column]) {
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Font.Size = 8;
                        range.Style.Font.Name = "Arial";
                        range.Value = qtyNew;
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin, Color.FromArgb(0, 0, 0));
                    }

                    column++;
                    using (ExcelRange range = worksheet.Cells[row, column, row, column]) {
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Font.Size = 8;
                        range.Style.Font.Name = "Arial";
                        range.Value = productLocation.Qty;
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin, Color.FromArgb(0, 0, 0));
                    }

                    column++;
                    qtyOld = qtyOld - productLocation.Qty;
                    //using (ExcelRange range = worksheet.Cells[row, column, row, column]) {
                    //    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    //    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    //    range.Style.Font.Size = 8;
                    //    range.Style.Font.Name = "Arial";
                    //    range.Value = decimal.Round((orderItem.Product.CurrentLocalPrice),
                    //                    2,
                    //                    MidpointRounding.AwayFromZero);
                    //    range.Style.Border.BorderAround(ExcelBorderStyle.Thin, Color.FromArgb(0, 0, 0));
                    //}
                    //column++;

                    //using (ExcelRange range = worksheet.Cells[row, column, row, column]) {
                    //    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    //    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    //    range.Style.Font.Size = 8;
                    //    range.Style.Font.Name = "Arial";
                    //    range.Value = decimal.Round((orderItem.Product.CurrentLocalPrice * Convert.ToDecimal(qtyOld)),
                    //                    2,
                    //                    MidpointRounding.AwayFromZero);
                    //    range.Style.Border.BorderAround(ExcelBorderStyle.Thin, Color.FromArgb(0, 0, 0));
                    //}
                    //column++;


                    //using (ExcelRange range = worksheet.Cells[row, column, row, column]) {
                    //    range.Style.WrapText = true;
                    //    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    //    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    //    range.Style.Font.Size = 8;
                    //    range.Style.Font.Name = "Arial";
                    //    range.Value = decimal.Round((orderItem.Product.CurrentLocalPrice * Convert.ToDecimal(qtyNew)),
                    //                    2,
                    //                    MidpointRounding.AwayFromZero); ;
                    //    range.Style.Border.BorderAround(ExcelBorderStyle.Thin, Color.FromArgb(0, 0, 0));
                    //}
                    //column++;

                    using (ExcelRange range = worksheet.Cells[row, column, row, column]) {
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Font.Size = 8;
                        range.Style.Font.Name = "Arial";
                        range.Value = orderItem.User.FirstName + " " + orderItem.User.LastName;
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin, Color.FromArgb(0, 0, 0));
                    }

                    column++;
                    DateTime time = TimeZoneInfo.ConvertTimeFromUtc(
                        productLocation.Created,
                        TimeZoneInfo.FindSystemTimeZoneById(
                            CultureInfo.CurrentCulture.TwoLetterISOLanguageName.Equals("uk")
                                ? "FLE Standard Time"
                                : "Central European Standard Time"
                        ));
                    using (ExcelRange range = worksheet.Cells[row, column, row, column]) {
                        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Right;
                        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                        range.Style.Font.Size = 8;
                        range.Style.Font.Name = "Arial";
                        range.Value = time.ToString("yyyy-MM-dd HH:mm");
                        range.Style.Border.BorderAround(ExcelBorderStyle.Thin, Color.FromArgb(0, 0, 0));
                    }

                    row++;
                    count++;
                }

                package.Save();
            }

            return SaveFilesPages(fileName);
        }
    }

    public (string xlsxFile, string pdfFile) ExportUkRegisterInvoiceSaleToXlsx(string path, List<Sale> sales, DateTime to, IEnumerable<DocumentMonth> months) {
        string fileName = Path.Combine(path, $"HistoryProduct_{DateTime.Now.ToString("MM.yyyy")}_{Guid.NewGuid().ToString()}.xlsx");

        using (ExcelPackage package = NewExcelPackage(fileName)) {
            ExcelWorksheet worksheet = package.Workbook.Worksheets.Add("HistoryProduct Document");


            worksheet.SetColumnWidth(5.4286, 1);
            worksheet.SetColumnWidth(30, 2);
            worksheet.SetColumnWidth(20, 3);
            worksheet.SetColumnWidth(5.4286, 4);
            worksheet.SetColumnWidth(5, 5);
            worksheet.SetColumnWidth(15, 6);
            worksheet.SetColumnWidth(30, 7);

            using (ExcelRange range = worksheet.Cells[1, 2, 1, 2]) {
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Value = $"Дата : {to:dd.MM.yyyy}";
                range.Style.Border.BorderAround(ExcelBorderStyle.Thin, Color.FromArgb(180, 168, 144));
            }

            using (ExcelRange range = worksheet.Cells[2, 1, 3, 1]) {
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Value = "№";
                range.Style.Border.BorderAround(ExcelBorderStyle.Thin, Color.FromArgb(180, 168, 144));
            }

            using (ExcelRange range = worksheet.Cells[2, 2, 3, 2]) {
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Value = "Номер видаткової накладної";
                range.Style.Border.BorderAround(ExcelBorderStyle.Thin, Color.FromArgb(180, 168, 144));
            }

            using (ExcelRange range = worksheet.Cells[2, 3, 3, 3]) {
                range.Merge = true;
                range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                range.Value = "Код Клієнта";
                range.Style.WrapText = true;
                range.Style.Border.BorderAround(ExcelBorderStyle.Thin, Color.FromArgb(180, 168, 144));
            }

            int row = 4;
            int count = 1;
            foreach (Sale sale in sales) {
                worksheet.SetRowHeight(10.7, row);

                using (ExcelRange range = worksheet.Cells[row, 1, row, 1]) {
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    range.Style.Font.Size = 8;
                    range.Style.Font.Name = "Arial";
                    range.Value = count;
                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin, Color.FromArgb(180, 168, 144));
                }

                using (ExcelRange range = worksheet.Cells[row, 2, row, 2]) {
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    range.Style.Font.Size = 8;
                    range.Style.Font.Name = "Arial";
                    range.Value = sale.SaleNumber.Value;
                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin, Color.FromArgb(180, 168, 144));
                }


                using (ExcelRange range = worksheet.Cells[row, 3, row, 3]) {
                    range.Style.WrapText = true;
                    range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Left;
                    range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
                    range.Style.Font.Size = 8;
                    range.Style.Font.Name = "Arial";
                    range.Value = sale.ClientAgreement.Client.OriginalRegionCode;
                    range.Style.Border.BorderAround(ExcelBorderStyle.Thin, Color.FromArgb(180, 168, 144));
                }

                row++;
                count++;
            }

            //worksheet.Cells.AutoFitColumns();

            package.Save();
        }

        return SaveFilesPages(fileName);
    }
}